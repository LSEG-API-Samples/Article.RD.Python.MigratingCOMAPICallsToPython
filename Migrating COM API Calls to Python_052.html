{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "9ad7ee14-aee7-4384-a158-a39ac24677f2",
   "metadata": {},
   "source": [
    "# Migrating COM API calls (usually used in Excel & VBA) to Python"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1d0999ba-631d-43fa-b67e-827ad4028669",
   "metadata": {},
   "source": [
    "### What are the COM APIs\n",
    "\n",
    "The COM APIs are older APIs that were initially delivered with 3000 Xtra Terminals and then Eikon. They provided access to a broad set of content and capabilities in Eikon.\n",
    "\n",
    "The COM API covers a large range of functionalities, as shown in [this article](https://developers.refinitiv.com/en/article-catalog/article/event-driven-financial-calculation-with-eikon-excel-visual-basic). Below we will show you how to migrate the following COM Component and API calls/functions: \n",
    "\n",
    "\n",
    "\n",
    "* AdfinXRtLib (rtx.dll)\n",
    "    * AdxRtSourceList \n",
    "    * AdxRtList (including 'RtGet Real Time')\n",
    "    * AdxRtChain\n",
    "    * AdxRtHistory (both inter- and intra-day) - Only available in Excel\n",
    "    * Streaming News\n",
    "\n",
    "\n",
    "* dex2.dll \n",
    "    * Rdata List\n",
    "    * DEX2 (including Symbology Conversion, Time Series, Fundamental and Reference data) \n",
    "\n",
    "\n",
    "* RSearch.dll\n",
    "    * RSearch \n",
    "\n",
    "\n",
    "* RHistoryAPI.dll\n",
    "    * RHistory\n",
    "\n",
    "\n",
    "* RtContribute.dll\n",
    "    * RtContribute \n",
    "\n",
    "\n",
    "----The APIs below do not currently have replacements in Workspace---------------\n",
    "\n",
    "\n",
    "* Adxfo.dll\n",
    "    * AdfinX Analytics 2.0 Module\n",
    "\n",
    "\n",
    "* Adxfoo.dll\n",
    "    * AdfinX Analytics 3.0 Module\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "### Reasons you might need or want to migrate away from COM APIs:\n",
    "\n",
    "### Need to operate in 64-bit environment\n",
    "   \n",
    "The COM APIs were designed to be used on 32-bit environments. Many teams are stil migrating to 64-bit environments where these will not work correctly and are not supported environments.\n",
    "\n",
    "### You want access to new datasets and improved capabilties offered on Refinitiv Data Platform\n",
    "\n",
    "The COM APIs are feature-complete and no new development work is being done on them. This means that new datasets    and capabilities will not be available to users of these APIs.\n",
    "\n",
    "### You want to upgrade from Eikon to Workspace\n",
    "\n",
    "The COM APIs will not be available in Workspace - so to take advantage of the best desktop experience you would need to migrate to our more modern web-based APIs - which are much better and work with modern scripting environments such as Python - one of the most popular language ecosystems used in finance. \n",
    "\n",
    "\n",
    "All the Python code below works in [Codebook](cpurl://apps.cp./Apps/code-book/) too! You can try it out as outlined in this [Tutorial Video](https://developers.refinitiv.com/en/video-catalog/from-developer-articles-to-codebook). We will use the Refinitiv Data Library (RD Library). To learn more about the Refinitiv Data Library for Python please join the Refinitiv Developer Community. By [registering](https://developers.refinitiv.com/iam/register) and [logging](https://developers.refinitiv.com/content/devportal/en_us/initCookie.html) into the Refinitiv Developer Community portal you will have free access to a number of learning materials like\n",
    "- [Quick Start guides](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python/quick-start), \n",
    "- [Tutorials](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python/learning), \n",
    "- [Documentation](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python/docs)\n",
    "\n",
    "and much more."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "af2786c3-b014-4a57-b490-8cb33b0ab0eb",
   "metadata": {},
   "source": [
    "## Prerequisits\n",
    "\n",
    "### COM Prerequisits\n",
    "\n",
    "To use the COM API in the Microsoft Office suite, I would advise anyone to read through the [COM APIs for Microsoft Office](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials). A resume of the prerequisits in question can be found in the index of this article.\n",
    "\n",
    "### Python Prerequisits\n",
    "\n",
    "If you are new to [Python](https://www.python.org/), don't hesitate to install it on your machine and try it out yourslef as outlined in this 3rd party [tutorial](https://pythonprogramming.net/introduction-learn-python-3-tutorials/). Elsehow, you can simply use [Codebook](cpurl://apps.cp./Apps/code-book/) as outlined in this [Tutorial Video](https://developers.refinitiv.com/en/video-catalog/from-developer-articles-to-codebook).\n",
    "\n",
    "Python works with libraries that one can import to use functionalities that are not natively supported but the coding language. In the cell below, we import the Python library `os`, then we use it to point to the path where our Refinitiv Credentials are; we need this file in order to auithenticate ourselves to the Refinitiv data services and collect data. You can find out more on this [here](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python/quick-start), and a copy of the Configuration file [here](https://github.com/Refinitiv-API-Samples/Example.DataLibrary.Python/blob/main/Configuration/refinitiv-data.config.json)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "c3daea3b-7ccd-4c82-9e2a-f1f224566cab",
   "metadata": {},
   "outputs": [],
   "source": [
    "import refinitiv.data as rd  # pip install httpx==0.21.3 # !pip install refinitiv.data --upgrade\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import os"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "5916a732-ef90-4481-83f4-d6a29c6543aa",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<refinitiv.data.session.Definition object at 0x238da5ed430 {name='workspace'}>"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 1st we need to point to the configuration file on our machine:\n",
    "#rd.open_session(config_name=\"C:\\\\Example.DataLibrary.Python-main\\\\Example.DataLibrary.Python-main\\\\Configuration\\\\refinitiv-data.config.json\")\n",
    "# Now we can choose the session type we would like. You can use `rd.open_session(\"desktop.workspace\")` if running this code outside CodeBook. You can also try \"platform.rdp\" or even `rd.open_session(\"\")`.\n",
    "rd.open_session(\"desktop.workspace\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "collectible-wednesday",
   "metadata": {},
   "source": [
    "# <span style=\"color:red\">then offer some comparison where there are differences eg what about CF_ fields are they available? </span>\n",
    "# <span style=\"color:blue\">I moved the part about available fields below </span>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1de9566c-a7b8-436a-bc32-66431e1c09e7",
   "metadata": {},
   "source": [
    "## AdfinX RealTime AdxRtSourceList\n",
    "### What does 'AdfinX RealTime AdxRtSourceList' do?\n",
    "The functionality in Office was used to get the real-time field list for the selected Source Name, such as an instrument (e.g.: VOD.L) (using AdxRtSourceList Class of AdfinXRtLib, the AdfinX Real Time 6.0 Library, rtx.dll). It was best exemplified in the [Tutorial 1 - Real-time Source List, Fields - AdxRtSourceList](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-1-real-time-source-list-fields-adx-rt-source-list)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/adxrtsourcelist.zip):\n",
    "\n",
    "<img src=\"imgs/AdxRtSourceList.PNG\">\n",
    "\n",
    "### VBA\n",
    "\n",
    "The VBA for AdxRtSourceList is very simple, and consists simply in creating an instance of an AdxRtSourceList object using the PLVbaApis function:\n",
    "\n",
    "> Set myAdxRtSrcLst = CreateAdxRtSourceList()\n",
    "\n",
    "### New Method\n",
    "This is a functionality for which there is now an interface available called the [Data Item Browswer (DIB) that you can  find on workspace](https://emea1-apps.platform.refinitiv.com/web/Apps/DataItemBrowser/), and for which there is a [video tutorial](https://developers.refinitiv.com/en/video-catalog/data-item-browser)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6a0020f2-8b88-4f2d-8408-de3cafdbf112",
   "metadata": {},
   "source": [
    "#### Real-Time Fields Available With The COM API\n",
    "\n",
    "There is a limited number of fields available on the COM API in 'AdxRtSourceList', you can lookup fields available in the Quote app for any instrument in question:\n",
    "\n",
    "<img src=\"imgs/COM Real Time Fields1.PNG\">\n",
    "\n",
    "<img src=\"imgs/COM Real Time Fields2.PNG\">\n",
    "\n",
    "More are available on the DIB and via the code available below in the 'Real-Time Fields Available In Python' section."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9e6096df-6c50-42d4-a5ff-afbf9af2c6d5",
   "metadata": {},
   "source": [
    "Note that available fields for each instrument type difffers on the type.\n",
    "\n",
    "#### Real-Time Fields Available In Python\n",
    "\n",
    "You can get a collection of all the Real-Time fields available via:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "2d70ef71-51ac-48f6-a047-23d9037a181b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['Instrument', 'PROD_PERM', 'RDNDISPLAY', 'DSPLY_NAME', 'TIMACT', 'NETCHNG_1', 'HIGH_1', 'LOW_1', 'CURRENCY', 'ACTIV_DATE', 'OPEN_PRC', 'HST_CLOSE', 'BID', 'BID_1', 'BID_2', 'ASK', 'ASK_1', 'ASK_2', 'ACVOL_1', 'TRD_UNITS', 'PCTCHNG', 'OPEN_BID', 'OPEN_ASK', 'CLOSE_BID', 'CLOSE_ASK', 'NUM_MOVES', 'OFFCL_CODE', 'HSTCLSDATE', 'YRHIGH', 'YRLOW', 'BCKGRNDPAG', 'BID_NET_CH', 'BID_TICK_1', 'MID_PRICE', 'MID_NET_CH', 'MID_CLOSE', 'HIGHTP_1', 'LOWTP_1', 'BID_HIGH_1', 'BID_LOW_1', 'YRBIDHIGH', 'YRBIDLOW', 'HST_CLSBID', 'HSTCLBDDAT', 'NUM_BIDS', 'RECORDTYPE', 'ACT_TP_1', 'ACT_TP_2', 'ACT_TP_3', 'SEC_ACT_1', 'SEC_ACT_2', 'SEC_ACT_3', 'SC_ACT_TP1', 'SC_ACT_TP2', 'SC_ACT_TP3', 'OPEN_TIME', 'HIGH_TIME', 'LOW_TIME', 'YRHIGHDAT', 'YRLOWDAT', 'IRGPRC', 'TIMCOR', 'PRIMACT_1', 'PRIMACT_2', 'PRIMACT_3', 'BASE_CCY', 'BCAST_REF', 'CROSS_SC', 'DLG_CODE1', 'DLG_CODE2', 'DLG_CODE3', 'CTBTR_1', 'CTBTR_2', 'CTBTR_3', 'CTB_LOC1', 'CTB_LOC2', 'CTB_LOC3', 'CTB_PAGE1', 'CTB_PAGE2', 'CTB_PAGE3', 'VALUE_DT1', 'VALUE_DT2', 'VALUE_DT3', 'SEC_HIGH', 'SEC_HI_TP', 'SEC_LOW', 'SEC_LO_TP', 'OPEN_TYPE', 'CLOSE_TYPE', 'BKGD_REF', 'GEN_TEXT16', 'GEN_VAL3', 'GEN_VAL4', 'GV1_TEXT', 'GV2_TEXT', 'GV4_TEXT', 'VALUE_TS1', 'VALUE_TS2', 'VALUE_TS3', 'QUOTIM', 'GEN_VAL5', 'GEN_VAL6', 'GEN_VAL7', 'GEN_VAL8', 'GEN_VAL9', 'GEN_VAL10', 'GV5_TEXT', 'GV6_TEXT', 'GV7_TEXT', 'GV8_TEXT', 'GV9_TEXT', 'GV10_TEXT', 'GN_TXT16_2', 'GV1_TIME', 'PREF_DISP', 'GN_TXT24_1', 'DSO_ID', 'RDN_EXCHD2', 'PREV_DISP', 'ASIA_CL_DT', 'ASIA_CLOSE', 'ASIA_HI_TM', 'ASIA_HIGH', 'ASIA_LOW', 'ASIA_LW_TM', 'ASIA_NETCH', 'ASIA_OP_TM', 'ASIA_OPEN', 'EURO_CL_DT', 'EURO_CLOSE', 'EURO_HI_TM', 'EURO_HIGH', 'EURO_LOW', 'EURO_LW_TM', 'EURO_NETCH', 'EURO_OP_TM', 'EURO_OPEN', 'US_CL_DT', 'US_CLOSE', 'US_HI_TM', 'US_HIGH', 'US_LOW', 'US_LW_TM', 'US_NETCH', 'US_OP_TM', 'US_OPEN', 'ASK_SPREAD', 'BID_SPREAD', 'MID_SPREAD', 'MONTH_HIGH', 'MONTH_LOW', 'PCTCHG_3M', 'PCTCHG_6M', 'PCTCHG_MTD', 'PCTCHG_YTD', 'QUOTE_DATE', 'WEEK_HIGH', 'WEEK_LOW', 'ASK_HIGH_1', 'ASK_HI_TME', 'ASK_LOW_1', 'ASK_LO_TME', 'BID_ASK_DT', 'HIGH_2', 'HIGH_3', 'HIGH_4', 'HIGH_5', 'HIGH_TIME2', 'HIGH_TIME3', 'HIGH_TIME4', 'HIGH_TIME5', 'LOW_2', 'LOW_3', 'LOW_4', 'LOW_5', 'LOW_TIME2', 'LOW_TIME3', 'LOW_TIME4', 'LOW_TIME5', 'SCALING', 'START_DT', 'WKHI_DT', 'WKLO_DT', 'MTHHI_DT', 'MTHLO_DT', 'QUOTIM_MS', 'MID_HIGH', 'MID_LOW', 'MID_HTIM', 'MID_LTIM', 'MID_OPEN', 'CONTEXT_ID', 'CF_ASK', 'CF_BID', 'CF_CLOSE', 'CF_DATE', 'CF_EXCHNG', 'CF_HIGH', 'CF_LAST', 'CF_LOW', 'CF_NETCHNG', 'CF_SOURCE', 'CF_TICK', 'CF_TIME', 'CF_VOLUME', 'BID_HIGH_2', 'BID_HIGH_3', 'BID_HIGH_4', 'BID_HIGH_5', 'BID_LOW_2', 'BID_LOW_3', 'BID_LOW_4', 'BID_LOW_5', 'ASK_HIGH_2', 'ASK_HIGH_3', 'ASK_HIGH_4', 'ASK_HIGH_5', 'ASK_LOW_2', 'ASK_LOW_3', 'ASK_LOW_4', 'ASK_LOW_5', 'PRV_BID_H', 'PRV_ASK_H', 'PRV_BID_L', 'PRV_ASK_L', 'CF_NAME', 'DDS_DSO_ID', 'BR_LINK1', 'BR_LINK2', 'BR_LINK3', 'CF_CURR', 'SPS_SP_RIC', 'QUOTIM_2', 'QUOTIM_3', 'QUOTE_DT2', 'QUOTE_DT3', 'ASKYRHIDAT', 'ASKYRLODAT', 'BIDYRHIDAT', 'BIDYRLODAT', 'ASIABAC_DT', 'EUBAC_DT', 'USBAC_DT', 'HST_NUMBID', 'ASK_FWDOR', 'BID_FWDOR', 'AMERCL_ASK', 'AMERCL_BID', 'AMERHI_ASK', 'AMERHI_BID', 'AMERLO_ASK', 'AMERLO_BID', 'AMEROP_ASK', 'AMEROP_BID', 'ASIACL_ASK', 'ASIACL_BID', 'ASIAHI_ASK', 'ASIAHI_BID', 'ASIALO_ASK', 'ASIALO_BID', 'ASIAOP_ASK', 'ASIAOP_BID', 'BIDPCTCHNG', 'EURCL_ASK', 'EURCL_BID', 'EURHI_ASK', 'EURHI_BID', 'EURLO_ASK', 'EURLO_BID', 'EUROP_ASK', 'EUROP_BID', 'HST_HIMID', 'HST_LOMID', 'HST_OPNASK', 'HST_OPNBID', 'YRASKHIGH', 'YRASKLOW', 'ASIA_BNC', 'EURO_BNC', 'MTH_ASK_LO', 'MTH_BID_HI', 'US_BNC', 'WK_ASK_LO', 'WK_BID_HI', 'BID_HOURLY', 'RCS_AS_CL2', 'MTH_ALO_DT', 'MTH_BHI_DT', 'WK_ALO_DT', 'WK_BHI_DT', 'FXMM_TYPE', 'ASIA_AH_MS', 'ASIA_AL_MS', 'ASIA_AO_MS', 'ASIA_BH_MS', 'ASIA_BL_MS', 'ASIA_BO_MS', 'EURO_AH_MS', 'EURO_AL_MS', 'EURO_AO_MS', 'EURO_BH_MS', 'EURO_BL_MS', 'EURO_BO_MS', 'US_AH_MS', 'US_AL_MS', 'US_AO_MS', 'US_BH_MS', 'US_BL_MS', 'US_BO_MS', 'OPN_BID_MS', 'ASKHI1_MS', 'ASKHI2_MS', 'ASKHI3_MS', 'ASKHI4_MS', 'ASKHI5_MS', 'ASKLO1_MS', 'ASKLO2_MS', 'ASKLO3_MS', 'ASKLO4_MS', 'ASKLO5_MS', 'BIDHI1_MS', 'BIDHI2_MS', 'BIDHI3_MS', 'BIDHI4_MS', 'BIDHI5_MS', 'BIDLO1_MS', 'BIDLO2_MS', 'BIDLO3_MS', 'BIDLO4_MS', 'BIDLO5_MS', 'MIDHI1_MS', 'MIDLO1_MS', 'BID_HR_MS']\n"
     ]
    }
   ],
   "source": [
    "RTCurrDf = rd.get_data(['GBP='])\n",
    "print(list(RTCurrDf.columns))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cf397050-0bb9-4781-a301-a5dc3c9b567c",
   "metadata": {},
   "source": [
    "Note that available fields for each instrument type difffers on the type, e.g.:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "96cacf51-da4c-4cd3-ad82-3ee7727930fa",
   "metadata": {},
   "outputs": [],
   "source": [
    "ATMIVDf = rd.get_data(['AAPLATMIV.U'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "b1e674e6-71ab-43d4-90ce-6144ef31ec0f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['Instrument', 'PROD_PERM', 'RDNDISPLAY', 'DSPLY_NAME', 'RDN_EXCHID', 'TIMACT', 'CURRENCY', 'TRADE_DATE', 'TRDTIM_1', 'TRD_UNITS', 'RECORDTYPE', 'SALTIM', 'BEST_BID1', 'BEST_BID2', 'BEST_BID3', 'BEST_ASK1', 'BEST_ASK2', 'BEST_ASK3', 'BCAST_REF', 'BEST_BSIZ1', 'BEST_BSIZ2', 'BEST_BSIZ3', 'BEST_ASIZ1', 'BEST_ASIZ2', 'BEST_ASIZ3', 'LONGLINK1', 'GV1_TEXT', 'GV2_TEXT', 'GV4_TEXT', 'PREF_DISP', 'PREF_LINK', 'DSPLY_NMLL', 'DSO_ID', 'RDN_EXCHD2', 'PREV_DISP', 'UNDERLYING', 'TIMACT_MS', 'OPTIONS', '30D_A_IM_C', '30D_A_IM_P', '60D_A_IM_C', '60D_A_IM_P', '90D_A_IM_C', '90D_A_IM_P', 'CONTEXT_ID', 'CF_DATE', 'CF_EXCHNG', 'CF_SOURCE', 'CF_TIME', 'CF_NAME', 'DDS_DSO_ID', 'CF_CURR', 'SPS_SP_RIC']\n"
     ]
    }
   ],
   "source": [
    "print(list(ATMIVDf.columns))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6340c505-c3e8-41ab-bfe7-3f3677b29fe9",
   "metadata": {
    "tags": []
   },
   "source": [
    "## AdfinX RealTime AdxRtList\n",
    "\n",
    "### What does AdxRtList do?\n",
    "\n",
    "Returns real-time data for multiple (or single) instrument and fields. Data is returned initially as ONIMAGE - which is a snapshot of data for the requested fields, followed by a series of ONUPDATE messages - which are received whenever a data item changes or gets updated. You can also request ONTIME returns which would give an ONIMAGE snapshot at periodic intervals (say every hour for example). All the following functions rely on AdxRtList API calls - RtGet(), RData() and TR() for real-time data. Typically we would need to write callback handlers to deal with the returns from the API."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "17b768f7-21c6-49ae-a6f5-e5f5c839797f",
   "metadata": {
    "tags": []
   },
   "source": [
    "### RtGet Real-Time\n",
    "\n",
    "When using the old COM API to get `RtGet Real Time` data, one may be greeted with an Excel sheet that looks like the below, as per [Tutorial 2 - Real-time Data Retrieval - AdxRtList](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-2-real-time-data-retrieval-adx-rt-list)'s [Excel workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/adxrtlist.zip):\n",
    "\n",
    "<img src=\"imgs/1. RtGet Real Time Excel Front End Eg.PNG\">\n",
    "\n",
    "The functionalities shown here are easily recreated using the RD Library: \n",
    "\n",
    "1. Real Time FX rates snapshot - 'Real-Time ONIMAGE' \n",
    "2. 'Real Time Update', which updates real time, as soon as an update for the instrument and field is received \n",
    "3. A periodic ONTIME snapshot\n",
    "\n",
    "#### Real-Time ONIMAGE\n",
    "\n",
    "When collecting data ONIMAGE, we are collecting a current snapshot of the data we're after. This could not be simpler in RD in Python!\n",
    "\n",
    "##### VBA\n",
    "\n",
    "In VBA, you'd create an instance of an AdxRtList object using the PLVbaApis function CreateAdxRtList.\n",
    "\n",
    "> Set myRtGet = CreateAdxRtList() ' The code will replicate RtGet(), one instrument, one field.'\n",
    "> \n",
    "> Set myAdxRtList = CreateAdxRtList() ' The code will replicate RData(), multiple items & fields.'\n",
    "\n",
    "Then create your function `cmdGetRealTimeONIMAGE_Click`:\n",
    "\n",
    ">         Private Sub cmdGetRealTimeONIMAGE_Click()\n",
    ">         Dim strRICs As String  ' Can have one or more items\n",
    ">         Dim varFIDs As Variant ' Field can be numeric as well as a string, e.g. BID is field 22\n",
    ">         \n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         If Not myRtGet Is Nothing Then Set myRtGet = Nothing\n",
    ">         Set myRtGet = CreateAdxRtList()\n",
    ">         \n",
    ">         With myRtGet\n",
    ">             .ErrorMode = DialogBox\n",
    ">             .Source = [Source].Value\n",
    ">             strRICs = [RIC].Value\n",
    ">             varFIDs = [FID].Value\n",
    "> \n",
    ">             .RegisterItems strRICs, varFIDs\n",
    ">     '       'Different methods shown below.\n",
    ">     '        strRICs = \"EUR=\"\n",
    ">     '        varFIDs = \"BID\"\n",
    ">     '        .RegisterItems strRICs, varFIDs\n",
    ">     '        .RegisterItems \"EUR=,GBP=,JPY=\", \"BID,ASK\"\n",
    "> \n",
    ">             .StartUpdates RT_MODE_IMAGE ' 4\n",
    ">             '.StartUpdates RT_MODE_ONUPDATE ' 3\n",
    ">             '.StartUpdates RT_MODE_NOT_SET ' 5\n",
    ">             '.StartUpdates RT_MODE_ONTIME ' 2\n",
    ">             '.StartUpdates RT_MODE_ONTIME_IF_UPDATED ' 1\n",
    ">         End With ' For the With myRtGet\n",
    ">     End Sub\n",
    "\n",
    "This would allow, in this example, for the 'Get Real Time ONIMAGE' buttons to work. For updates, the below could be used:\n",
    "\n",
    ">     ' Returns the initial image for the instrument. NOTE - .StartUpdates RT_MODE_IMAGE\n",
    ">     Private Sub myRtGet_OnImage(ByVal DataStatus As AdfinXRtLib.RT_DataStatus)\n",
    ">         Dim arrRICs As Variant, arrFields As Variant\n",
    ">         Dim lngRICFidVal As Single\n",
    ">         Dim a As Integer\n",
    "> \n",
    ">         If DataStatus = RT_DS_FULL Then\n",
    ">             With myRtGet\n",
    ">                 ' Array of the list of instruments - only one in this case.\n",
    ">                 arrRICs = .ListItems(RT_IRV_ALL, RT_ICV_USERTAG)\n",
    ">                 ' Array of the list of Fields for the ath item in the arrRics (base 0)\n",
    ">                 a = 0\n",
    ">                 arrFields = .ListFields(arrRICs(a, 0), RT_FRV_ALL, RT_FCV_VALUE)\n",
    ">             End With\n",
    "> \n",
    ">             ' And a specific value for a specific instrument, specific field.\n",
    ">             'lngRICFidVal = myRtGet.Value(\"EUR=\", \"BID\")\n",
    ">             lngRICFidVal = myRtGet.Value([RIC].Value, [FID].Value)\n",
    ">             [F7].Value = lngRICFidVal\n",
    ">         End If\n",
    ">     End Sub\n",
    "\n",
    "##### Python\n",
    "\n",
    "In python, things could not be easier as most of the equivalent code about is abstracted to the library and you just use a one-line function! You can go ahead and try it all out in [Codebook](cpurl://apps.cp./Apps/code-book/):"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "7713c56d-e495-46e3-8779-72d5219267f5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>BID</th>\n",
       "      <th>ASK</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>GBP=</td>\n",
       "      <td>1.1738</td>\n",
       "      <td>1.1739</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>EUR=</td>\n",
       "      <td>1.034</td>\n",
       "      <td>1.0344</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>JPY=</td>\n",
       "      <td>140.33</td>\n",
       "      <td>140.36</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument     BID     ASK\n",
       "0       GBP=  1.1738  1.1739\n",
       "1       EUR=   1.034  1.0344\n",
       "2       JPY=  140.33  140.36"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rd.get_data(\n",
    "    ['GBP=', 'EUR=', 'JPY='],\n",
    "    ['BID', 'ASK'])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7acbe99b-13bb-4404-b28c-62b7548f81c8",
   "metadata": {},
   "source": [
    "You can easily assign this info to an object too."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "fc5583d3-11eb-4d35-a70a-e84e3606d23a",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Yield to Call Date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>GBP=</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>EUR=</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>JPY=</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument Yield to Call Date\n",
       "0       GBP=                NaT\n",
       "1       EUR=                NaT\n",
       "2       JPY=                NaT"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rd.get_data(\n",
    "    ['GBP=', 'EUR=', 'JPY='],\n",
    "    ['TR.YieldtoCallDateAnalytics'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8448e838-51a7-42d8-afbc-697669bad3df",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>BID</th>\n",
       "      <th>ASK</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>GBP=</td>\n",
       "      <td>1.1734</td>\n",
       "      <td>1.1738</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>EUR=</td>\n",
       "      <td>1.0338</td>\n",
       "      <td>1.0342</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>JPY=</td>\n",
       "      <td>140.34</td>\n",
       "      <td>140.37</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument     BID     ASK\n",
       "0       GBP=  1.1734  1.1738\n",
       "1       EUR=  1.0338  1.0342\n",
       "2       JPY=  140.34  140.37"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "realTimeImage = rd.get_data(\n",
    "    ['GBP=', 'EUR=', 'JPY='],\n",
    "    ['BID', 'ASK'])\n",
    "realTimeImage"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e1d30602-4344-46a8-a878-2b2bff543cb7",
   "metadata": {},
   "source": [
    "#### Real-Time ONUPDATE\n",
    "\n",
    "##### VBA\n",
    "\n",
    "<img src=\"imgs/1. RtGet Real Time Excel Front End Eg.PNG\">\n",
    "\n",
    "The 'Real Time ONUPDATE' buttons in the example pictured above was coded with VBA code for `cmdGetRealTimeONUPDATE_Click`:\n",
    "\n",
    ">     Private Sub cmdGetRealTimeONUPDATE_Click()\n",
    ">         Dim strRICs As Variant, varFIDs As Variant\n",
    ">     \n",
    ">          ActiveCell.Select\n",
    ">         \n",
    ">         Set myRtGet2 = CreateAdxRtList\n",
    ">     \n",
    ">         With myRtGet2\n",
    ">             .ErrorMode = DialogBox\n",
    ">             .Source = [Source].Value\n",
    ">             strRICs = [RIC].Value\n",
    ">             varFIDs = [FID].Value\n",
    ">     \n",
    ">             .RegisterItems strRICs, varFIDs\n",
    ">             .StartUpdates RT_MODE_ONUPDATE\n",
    ">         End With ' For the With myRtGet2\n",
    ">     End Sub\n",
    ">     \n",
    ">     \n",
    ">     ' Returns the data for updates - NOTE .StartUpdates RT_MODE_ONUPDATE.\n",
    ">     Private Sub myRtGet2_OnUpdate(ByVal a_itemName As String, ByVal a_userTag As Variant, ByVal a_itemStatus As AdfinXRtLib.RT_ItemStatus)\n",
    ">         Dim arrFields As Variant\n",
    ">         Dim lngRICFidVal As Long\n",
    ">     \n",
    ">         If a_itemStatus = RT_ITEM_OK Then\n",
    ">             arrFields = myRtGet2.ListFields(a_itemName, RT_FRV_ALL, RT_FCV_VALUE)\n",
    ">     \n",
    ">             ' And a specific value for a specific instrument, specific field.\n",
    ">             'If a_itemName = \"EUR=\" Then lngRICFidVal = myRtGet2.Value(\"EUR=\", \"BID\"): [F12].Value = arrFields(0, 1)\n",
    ">             If a_itemName = [RIC].Value Then lngRICFidVal = myRtGet2.Value([RIC].Value, [FID].Value): [F12].Value = arrFields(0, 1)\n",
    ">         End If\n",
    ">     End Sub\n",
    "\n",
    "Then, on VBA, you'd have to have a buttons to stop the stream with `cmdSwitchRealTimeOFF_Click`, which, in python, is `stream.close()`:\n",
    "\n",
    "##### Python\n",
    "\n",
    "Some Python Library Imports to start with"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "213f41fc-06c8-4dec-883c-4a351e91983e",
   "metadata": {},
   "outputs": [],
   "source": [
    "import datetime  # `datetime` allows us to manipulate time as we would data-points.\n",
    "from IPython.display import display, clear_output  # `IPython` here will allow us to plot grahs and the likes."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "956821c9-4c93-4529-9460-730e17e70b5e",
   "metadata": {},
   "source": [
    "For us to start using pricing streams with events, we need to define a callback to receive data events:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "6ebeec4d-925f-47f2-809c-0dc222965f91",
   "metadata": {},
   "outputs": [],
   "source": [
    "def display_data(data, instrument, stream):\n",
    "    clear_output(wait=True)\n",
    "    current_time = datetime.datetime.now().time()\n",
    "    print(current_time, \"- Data received for\", instrument)\n",
    "    display(data)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "95f6cb99-9c69-42df-81e0-acc47883c9e5",
   "metadata": {},
   "source": [
    "Open the stream and register the callback"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "b5fdd264-19c4-4b87-8716-29e06cb0edfd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "17:18:05.466320 - Data received for EUR=\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>BID</th>\n",
       "      <th>ASK</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>EUR=</th>\n",
       "      <td>1.0338</td>\n",
       "      <td>1.0342</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         BID     ASK\n",
       "EUR=  1.0338  1.0342"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "stream = rd.open_pricing_stream(\n",
    "    universe=['GBP=', 'EUR=', 'JPY='],\n",
    "    fields=['BID', 'ASK'],\n",
    "    on_data=display_data\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9cd38d75-7a32-4032-bf7c-49c6bfebfaad",
   "metadata": {},
   "source": [
    "Close the stream"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "725b05ff-a32c-4a3b-8dad-ada4f0e3ed71",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<OpenState.Closed: 'Closed'>"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.close()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "07246932-6944-4011-b841-282b3f6b7bed",
   "metadata": {},
   "source": [
    "More related RD capabilities can be found [here](https://github.com/Refinitiv-API-Samples/Example.DataLibrary.Python/blob/main/Examples/1-Access/EX-1.01.03-PricingStream.ipynb)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "22522aae-29ce-4948-a8cb-8678d95bb258",
   "metadata": {
    "tags": []
   },
   "source": [
    "#### Real-Time ONTIME\n",
    "\n",
    "With Real-Time ONTIME, you can get snapshot updates at a specific frequency:\n",
    "\n",
    "<img src=\"imgs/1. RtGet Real Time Excel Front End Eg.PNG\">\n",
    "\n",
    "We can use a Python loop with `sleep` to recreate that simply:\n",
    "\n",
    "The cell below gets an update for instruments 'GBP=', 'EUR=' and 'JPY=' and fields 'BID' and 'ASK' every 5 seconds:\n",
    "\n",
    "# <span style=\"color:red\">Change this with a single dataframe that updates once a second</span>\n",
    "# <span style=\"color:blue\">Done</span>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "99df2588-78f0-424f-9d47-9d6bc26f0c9f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>BID</th>\n",
       "      <th>ASK</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>GBP=</td>\n",
       "      <td>1.1735</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>EUR=</td>\n",
       "      <td>1.0338</td>\n",
       "      <td>1.0342</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>JPY=</td>\n",
       "      <td>140.35</td>\n",
       "      <td>140.36</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument     BID     ASK\n",
       "0       GBP=  1.1735  1.1736\n",
       "1       EUR=  1.0338  1.0342\n",
       "2       JPY=  140.35  140.36"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "import time  # the `time` library will allow us to make sure that this cell doesn't run in an infinite loop\n",
    "now = time.perf_counter()  # We create a time stamp for 'now'\n",
    "while time.perf_counter() < now + 10:  # This loop will only run for the 10 seconde following `now`.\n",
    "    time.sleep(1)\n",
    "    clear_output(wait=True)\n",
    "    df = stream.get_snapshot(\n",
    "        universe=['GBP=', 'EUR=', 'JPY='],\n",
    "        fields=['BID', 'ASK'])\n",
    "    display(df)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ebc9a4c9-8ecc-4fdf-bbbd-f468cf9c0d4e",
   "metadata": {
    "tags": []
   },
   "source": [
    "##### Real Time ONTIME Note on chains used in `ek.get_data`:\n",
    "\n",
    "It has to be pointed out that when getting this kind of data for each constituent of a chain (e.g.: `0#.FSTE` for the FTSE Equity index, or the commodities chain `0#LCO:` for  ICE Brent Crude Oil Chain Future Contract) on the COM API in Excel:\n",
    "\n",
    "<img src=\"imgs/2. RData Excel Front End Eg.PNG\">\n",
    "\n",
    "you would not need the starting `0#`, but this is needed for our Python API:\n",
    "\n",
    "# <span style=\"color:red\">for commodity chains we need to use EDAPI, what does the symbology service? Jason to speak to Olivier tmr</span>\n",
    "# <span style=\"color:blue\">I sent Olivier an email, here is his answer:</span>\n",
    "\n",
    "It will be included in RDL 1.0.0b27\n",
    "\n",
    "<img src=\"imgs/RDL 1.0.0b27.PNG\">"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "be8881d9-07a2-45d0-bb0a-f56b0ba88af6",
   "metadata": {},
   "outputs": [],
   "source": [
    "import refinitiv.data.eikon as ek\n",
    "\n",
    "## Outside CodeBook:\n",
    "ek_key = open(\"eikon.txt\", \"r\")  # The key is placed in a text file so that it may be used in this code without showing it itself.\n",
    "ek.set_app_key(str(ek_key.read()))  # `'DEFAULT_CODE_BOOK_APP_KEY'` in CodeBook\n",
    "ek_key.close()  # It is best to close the files we opened in order to make sure that we don't stop any other services/programs from accessing them if they need to."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "fd713e6d-ed96-4422-83b2-2351bb98fbd4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>CF_NAME</th>\n",
       "      <th>CF_TIME</th>\n",
       "      <th>HST_VOL</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>LCOTOT</td>\n",
       "      <td>BRENT CRUDE VOLS</td>\n",
       "      <td>17:18:34</td>\n",
       "      <td>730081</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>LCOF3</td>\n",
       "      <td>BRENT CRUDE JAN3</td>\n",
       "      <td>17:18:33</td>\n",
       "      <td>238066</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>LCOG3</td>\n",
       "      <td>BRENT CRUDE FEB3</td>\n",
       "      <td>17:18:32</td>\n",
       "      <td>168059</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>LCOH3</td>\n",
       "      <td>BRENT CRUDE MAR3</td>\n",
       "      <td>17:18:28</td>\n",
       "      <td>108648</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>LCOJ3</td>\n",
       "      <td>BRENT CRUDE APR3</td>\n",
       "      <td>17:18:20</td>\n",
       "      <td>48987</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>71</th>\n",
       "      <td>LCOX8</td>\n",
       "      <td>BRENT CRUDE NOV8</td>\n",
       "      <td>23:00:00</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>72</th>\n",
       "      <td>LCOZ8</td>\n",
       "      <td>BRENT CRUDE DEC8</td>\n",
       "      <td>17:18:37</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>73</th>\n",
       "      <td>LCOF9</td>\n",
       "      <td>BRENT CRUDE JAN9</td>\n",
       "      <td>23:00:00</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74</th>\n",
       "      <td>LCOG9</td>\n",
       "      <td>BRENT CRUDE FEB9</td>\n",
       "      <td>23:00:00</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75</th>\n",
       "      <td>LCOH9</td>\n",
       "      <td>BRENT CRUDE MAR9</td>\n",
       "      <td>23:00:00</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>76 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Instrument           CF_NAME   CF_TIME  HST_VOL\n",
       "0      LCOTOT  BRENT CRUDE VOLS  17:18:34   730081\n",
       "1       LCOF3  BRENT CRUDE JAN3  17:18:33   238066\n",
       "2       LCOG3  BRENT CRUDE FEB3  17:18:32   168059\n",
       "3       LCOH3  BRENT CRUDE MAR3  17:18:28   108648\n",
       "4       LCOJ3  BRENT CRUDE APR3  17:18:20    48987\n",
       "..        ...               ...       ...      ...\n",
       "71      LCOX8  BRENT CRUDE NOV8  23:00:00     <NA>\n",
       "72      LCOZ8  BRENT CRUDE DEC8  17:18:37     <NA>\n",
       "73      LCOF9  BRENT CRUDE JAN9  23:00:00     <NA>\n",
       "74      LCOG9  BRENT CRUDE FEB9  23:00:00     <NA>\n",
       "75      LCOH9  BRENT CRUDE MAR9  23:00:00     <NA>\n",
       "\n",
       "[76 rows x 4 columns]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df, err = ek.get_data(\n",
    "    instruments=['0#LCO:'],  # other e.g.: PSKc1  # in Office COM API, you do not need the 0#, but it is requiered on our Python API calls\n",
    "    fields=['CF_NAME', 'CF_TIME', 'HST_VOL'])\n",
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f414cb7b-642a-4a51-9c6b-8dd8c9c04064",
   "metadata": {
    "tags": []
   },
   "source": [
    "### NEW FUNCTIONALITY: Record ticks\n",
    "\n",
    "With the RD library we now have the ability to record a pricing stream. Here's how:\n",
    "\n",
    "Create and open a Pricing stream"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "27642e8b-7224-46d8-8ac7-666652dd58b7",
   "metadata": {},
   "outputs": [],
   "source": [
    "stream = rd.open_pricing_stream(\n",
    "    universe=['GBP=', 'EUR=', 'JPY='],\n",
    "    fields=['BID']\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e10fe8f8-dfde-4a0c-9083-9501dee9fc49",
   "metadata": {},
   "source": [
    "Start recording"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "bc7c353d-4149-4e79-9719-bd36a39ade91",
   "metadata": {},
   "outputs": [],
   "source": [
    "stream.recorder.record(frequency='tick')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "87142a4b-dc83-46d1-8149-beca7e07f82f",
   "metadata": {},
   "source": [
    "... Wait for a little while (5 seconds) ..."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "bd07ca45-c91e-4052-b433-80a143c3bdaa",
   "metadata": {},
   "outputs": [],
   "source": [
    "time.sleep(5)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0bdac869-1659-4549-b46d-a66a050b795d",
   "metadata": {},
   "source": [
    "Stop recording and display the recorded history"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "ac1ec1a0-77b6-499b-8767-c31a19d02168",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>EUR=</th>\n",
       "      <th>JPY=</th>\n",
       "      <th>GBP=</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>BID</th>\n",
       "      <th>BID</th>\n",
       "      <th>BID</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Timestamp</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:44.202954</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:44.503595</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.34</td>\n",
       "      <td>1.1734</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:44.804585</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1735</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45.219656</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45.320590</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.34</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45.487897</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1734</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45.755214</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45.922527</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:46.319860</th>\n",
       "      <td>1.0339</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:46.353385</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.34</td>\n",
       "      <td>1.1734</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:46.619346</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1735</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:46.637938</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:46.914065</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>1.1733</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:47.187073</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1735</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:47.354857</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:47.488169</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:48.315953</th>\n",
       "      <td>1.0339</td>\n",
       "      <td>140.35</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:48.585402</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>140.35</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:48.849193</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                              EUR=    JPY=    GBP=\n",
       "                               BID     BID     BID\n",
       "Timestamp                                         \n",
       "2022-11-14 17:18:44.202954    <NA>  140.35  1.1736\n",
       "2022-11-14 17:18:44.503595    <NA>  140.34  1.1734\n",
       "2022-11-14 17:18:44.804585    <NA>    <NA>  1.1735\n",
       "2022-11-14 17:18:45.219656    <NA>    <NA>  1.1736\n",
       "2022-11-14 17:18:45.320590    <NA>  140.34    <NA>\n",
       "2022-11-14 17:18:45.487897    <NA>    <NA>  1.1734\n",
       "2022-11-14 17:18:45.755214    <NA>    <NA>  1.1736\n",
       "2022-11-14 17:18:45.922527    <NA>  140.35    <NA>\n",
       "2022-11-14 17:18:46.319860  1.0339    <NA>    <NA>\n",
       "2022-11-14 17:18:46.353385    <NA>  140.34  1.1734\n",
       "2022-11-14 17:18:46.619346    <NA>    <NA>  1.1735\n",
       "2022-11-14 17:18:46.637938    <NA>  140.35    <NA>\n",
       "2022-11-14 17:18:46.914065    <NA>  140.35  1.1733\n",
       "2022-11-14 17:18:47.187073    <NA>    <NA>  1.1735\n",
       "2022-11-14 17:18:47.354857    <NA>  140.35    <NA>\n",
       "2022-11-14 17:18:47.488169    <NA>    <NA>  1.1736\n",
       "2022-11-14 17:18:48.315953  1.0339  140.35    <NA>\n",
       "2022-11-14 17:18:48.585402    <NA>  140.35    <NA>\n",
       "2022-11-14 17:18:48.849193    <NA>    <NA>  1.1736"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "stream.recorder.stop()\n",
    "tick_history = stream.recorder.get_history()\n",
    "display(tick_history)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "156f6235-36be-4a6c-b96f-027021287713",
   "metadata": {},
   "source": [
    "Resample the tick history to 5 seconds bars"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "9bcaea41-407a-4520-92a1-6c995ee3bab9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th colspan=\"4\" halign=\"left\">EUR=</th>\n",
       "      <th colspan=\"4\" halign=\"left\">JPY=</th>\n",
       "      <th colspan=\"4\" halign=\"left\">GBP=</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th colspan=\"4\" halign=\"left\">BID</th>\n",
       "      <th colspan=\"4\" halign=\"left\">BID</th>\n",
       "      <th colspan=\"4\" halign=\"left\">BID</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>open</th>\n",
       "      <th>high</th>\n",
       "      <th>low</th>\n",
       "      <th>close</th>\n",
       "      <th>open</th>\n",
       "      <th>high</th>\n",
       "      <th>low</th>\n",
       "      <th>close</th>\n",
       "      <th>open</th>\n",
       "      <th>high</th>\n",
       "      <th>low</th>\n",
       "      <th>close</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Timestamp</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:40</th>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>140.35</td>\n",
       "      <td>140.35</td>\n",
       "      <td>140.34</td>\n",
       "      <td>140.34</td>\n",
       "      <td>1.1736</td>\n",
       "      <td>1.1736</td>\n",
       "      <td>1.1734</td>\n",
       "      <td>1.1735</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-11-14 17:18:45</th>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>140.34</td>\n",
       "      <td>140.35</td>\n",
       "      <td>140.34</td>\n",
       "      <td>140.35</td>\n",
       "      <td>1.1736</td>\n",
       "      <td>1.1736</td>\n",
       "      <td>1.1733</td>\n",
       "      <td>1.1736</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                       EUR=                            JPY=                  \\\n",
       "                        BID                             BID                   \n",
       "                       open    high     low   close    open    high     low   \n",
       "Timestamp                                                                     \n",
       "2022-11-14 17:18:40  1.0339  1.0339  1.0339  1.0339  140.35  140.35  140.34   \n",
       "2022-11-14 17:18:45  1.0339  1.0339  1.0339  1.0339  140.34  140.35  140.34   \n",
       "\n",
       "                               GBP=                          \n",
       "                                BID                          \n",
       "                      close    open    high     low   close  \n",
       "Timestamp                                                    \n",
       "2022-11-14 17:18:40  140.34  1.1736  1.1736  1.1734  1.1735  \n",
       "2022-11-14 17:18:45  140.35  1.1736  1.1736  1.1733  1.1736  "
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "tick_history.ohlc(\"5s\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "14a3aa73-87d7-4350-a0e4-44fbe490958e",
   "metadata": {},
   "source": [
    "Close the stream"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "6ad6da9d-98d6-430a-bb06-9bc39383f5f5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<OpenState.Closed: 'Closed'>"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.close()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5343eaa0-1a62-4236-9bbc-8dee9f7b8361",
   "metadata": {},
   "source": [
    "As you can see, we get the data sought after. If you are after several fields for any one instrument (e.g.: an FX Pair), it couldn't be any simpler:\n",
    "\n",
    "### Rdata List Realtime\n",
    "\n",
    "When using the old COM API to get `Rdata List` data, one may be greeted with an Excel sheet that looks like this:\n",
    "\n",
    "<img src=\"imgs/2. RData Excel Front End Eg.PNG\">\n",
    "\n",
    "#### VBA\n",
    "\n",
    "In VBA, this was done with a function akin to `.StartUpdates RT_MODE_ONUPDATE` & `myRTList = CreateAdxRtList()`, e.g.:\n",
    "\n",
    "\n",
    ">     With myRTList\n",
    ">         .ErrorMode = EXCEPTION\n",
    ">         ' N.B.! Source name may need to be changed if not named as below!\n",
    ">         .Source = \"IDN\" '_SELECTFEED\"\n",
    ">         ' Register the items and fields\n",
    ">         .RegisterItems ItemArray, FieldArray\n",
    "> \n",
    ">         ' Set the user tag on each item. This helps indexing the results\n",
    ">         ' table for displaying the data in the callback\n",
    ">         For m = LBound(ItemArray) To UBound(ItemArray)\n",
    ">             .UserTag(ItemArray(m), \"*\") = m\n",
    ">             For n = LBound(FieldArray) To UBound(FieldArray)\n",
    ">                 .UserTag(ItemArray(m), FieldArray(n)) = n\n",
    ">             Next n\n",
    ">         Next m\n",
    "> \n",
    ">         .Mode = \"TIMEOUT:5\"\n",
    ">         ' If timed basis desired, then FRQ setting and RT_MODE_ONTIME or RT_MODE_ONTIME_IF_UPDATED required,\n",
    ">         ' which will trigger the OnUpdate event, shown below.\n",
    ">         '.Mode = \"FRQ:2S\"\n",
    ">         ' And, finally, request the data!\n",
    ">         Select Case Range(\"dcUpdateType\").Value\n",
    ">             Case \"RT_MODE_IMAGE\"\n",
    ">                 .StartUpdates RT_MODE_IMAGE\n",
    ">             Case \"RT_MODE_ONUPDATE\"\n",
    ">                 .StartUpdates RT_MODE_ONUPDATE\n",
    ">         End Select\n",
    "> \n",
    ">         '.StartUpdates RT_MODE_ONUPDATE\n",
    ">         '.StartUpdates RT_MODE_IMAGE\n",
    ">         'Other modes shown below; different events will be fired.\n",
    ">         '.StartUpdates RT_MODE_ONTIME, RT_MODE_ONTIME_IF_UPDATED, RT_MODE_ONTIME,\n",
    ">         ' RT_MODE_ONUPDATE, RT_MODE_IMAGE , RT_MODE_NOT_SET\n",
    ">     End With\n",
    "\n",
    "To stop this update, you would have to create some VBA code to (e.g.: `Sub cmdStop_Click()`), but that is simpler in Python with `stream.close()`:\n",
    "\n",
    "However - many developers also used the RData worksheet function object directly in VBA. \n",
    "\n",
    "#### Python\n",
    "\n",
    "Here we have a data-frame of instruments and fields updating live every `x` seconds, let's say (for the sake of the use-case example) every 3 seconds. This is simple to recreate in Python:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "65ca0e9a-ad4b-4468-b9d9-d2949e112b18",
   "metadata": {},
   "outputs": [],
   "source": [
    "stream = rd.open_pricing_stream(\n",
    "    universe=['GBP=', 'EUR=', 'JPY=', '.DIB', '.FTSE', '.NDX', 'TRI.TO', 'EURGBP=R'],\n",
    "    fields=['CF_TIME', 'CF_LAST', 'BID', 'ASK', 'TRDTIM_1'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "referenced-print",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[MixedStreams id=6 universe=['GBP=', 'EUR=', 'JPY=', '.DIB', '.FTSE', '.NDX', 'TRI.TO', 'EURGBP=R']] can’t open, state=StreamState.Opened\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<OpenState.Opened: 'Opened'>"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.open()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "c22908c4-95b4-43d7-b812-69b374969555",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>CF_TIME</th>\n",
       "      <th>CF_LAST</th>\n",
       "      <th>BID</th>\n",
       "      <th>ASK</th>\n",
       "      <th>TRDTIM_1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>GBP=</td>\n",
       "      <td>17:19:22</td>\n",
       "      <td>1.1734</td>\n",
       "      <td>1.1734</td>\n",
       "      <td>1.1738</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>EUR=</td>\n",
       "      <td>17:19:22</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0339</td>\n",
       "      <td>1.0343</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>JPY=</td>\n",
       "      <td>17:19:22</td>\n",
       "      <td>140.33</td>\n",
       "      <td>140.33</td>\n",
       "      <td>140.36</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>.DIB</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>.FTSE</td>\n",
       "      <td>16:35:00</td>\n",
       "      <td>7385.17</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>16:35:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>.NDX</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>TRI.TO</td>\n",
       "      <td>17:19:00</td>\n",
       "      <td>145.48</td>\n",
       "      <td>145.43</td>\n",
       "      <td>145.52</td>\n",
       "      <td>17:19:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>EURGBP=R</td>\n",
       "      <td>17:19:22</td>\n",
       "      <td>0.881</td>\n",
       "      <td>0.881</td>\n",
       "      <td>0.8814</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument   CF_TIME  CF_LAST     BID     ASK  TRDTIM_1\n",
       "0       GBP=  17:19:22   1.1734  1.1734  1.1738      <NA>\n",
       "1       EUR=  17:19:22   1.0339  1.0339  1.0343      <NA>\n",
       "2       JPY=  17:19:22   140.33  140.33  140.36      <NA>\n",
       "3       .DIB      <NA>     <NA>    <NA>    <NA>      <NA>\n",
       "4      .FTSE  16:35:00  7385.17    <NA>    <NA>  16:35:00\n",
       "5       .NDX      <NA>     <NA>    <NA>    <NA>      <NA>\n",
       "6     TRI.TO  17:19:00   145.48  145.43  145.52  17:19:00\n",
       "7   EURGBP=R  17:19:22    0.881   0.881  0.8814      <NA>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "now = time.perf_counter()\n",
    "while time.perf_counter() < now + 30:\n",
    "    time.sleep(1)\n",
    "    clear_output(wait=True)\n",
    "    df = stream.get_snapshot(\n",
    "        universe = ['GBP=', 'EUR=', 'JPY=', '.DIB', '.FTSE', '.NDX', 'TRI.TO', 'EURGBP=R'], \n",
    "        fields = ['CF_TIME', 'CF_LAST', 'BID', 'ASK', 'TRDTIM_1'])\n",
    "    display(df)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b2a6a261-70bc-43a8-b1e0-664a377797b8",
   "metadata": {},
   "source": [
    "Close the stream"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "9b3eeb1f-95c0-4273-9739-885527e4be95",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<OpenState.Closed: 'Closed'>"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.close()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d7eb31e7-b595-46dc-ae0a-9ebd6f9b9779",
   "metadata": {
    "tags": []
   },
   "source": [
    "#### Create a Streaming Price and register event callbacks using RDP\n",
    "\n",
    "You can build upon the example above, using the [RDP](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-platform-apis) Example notebook present in [Codebook](cpurl://apps.cp./Apps/code-book/) that demonstrates how to use a StreamingPrice with events to update a Pandas DataFrame with real-time streaming data. Using a StreamingPrices object that way allows your application to have at its own in memory representation (a Pandas DataFrame in this example) that is kept updated with the latest streaming values received from Eikon or Refinitiv Workspace. Here we're putting ourselves in the shoes of a Foreign eXchange (FX) trader looking at Emerging Market (EM) currency exchange rates; e.g: the Nigerian Nairas (NGN) and Indonesian Rupiah (IDR).\n",
    "\n",
    "You can find the code for this on GitHub [here](https://gist.github.com/johnukfr/25935ae4a0928c400e706dee7eb6a79a)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b42ebf06-e925-454a-99ca-6f042c1a84e0",
   "metadata": {},
   "source": [
    "### RData Function\n",
    "\n",
    "#### What does RData do?\n",
    "RData is a flexible excel worksheet function allowing access to realtime and fundamental & reference data content. It can also be used programatcally in VBA and the results then dumped to an excel range for example. \n",
    "\n",
    "#### VBA\n",
    "\n",
    "For VBA related to Fundamental data, please see the 'DEX2 Fundamental and Reference' section below.\n",
    "\n",
    "#### Python\n",
    "\n",
    "We have separated getting current fundamental snapshots - using a rd.get_data function. For historical fundamental timeseries histories we have created a rd.content.fundamental_and_reference.Definition.\n",
    "\n",
    "\n",
    "Such data can be found in Python with [RD](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python) (and `rd.get_data` or `rd.content.fundamental_and_reference.Definition`) or [EDAPI](https://developers.refinitiv.com/en/api-catalog/eikon/eikon-data-api).\n",
    "\n",
    "##### Snapshot requests\n",
    "\n",
    "# <span style=\"color:red\">We need to possibly add the ffill code potentially to get_data - for the get_history we need to add they fundamental temporal frequencies such as FY, FQ, FS, FI, CM, ... Olivier</span>\n",
    "# <span style=\"color:blue\">I sent an email to Olivier and he said you discussed it and decided to leave as is</span>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "6763dacd-fdba-473f-a0a3-b5bc90baa5c3",
   "metadata": {},
   "outputs": [],
   "source": [
    "df1 = rd.get_data(\n",
    "    ['BARC.L', 'TRI.N'],  # PSKc1, '92857WAZ3=1M'\n",
    "    fields=[\n",
    "        'TR.IR.RatingSourceDescription', 'TR.IR.RatingSourceType', 'TR.IR.Rating',\n",
    "        'TR.TRBCEconomicSector', 'TR.TRBCEconSectorCode', 'TR.TRBCBusinessSector',\n",
    "        'TR.TRBCBusinessSectorCode', 'TR.TRBCIndustryGroup', 'TR.TRBCIndustryGroupCode',\n",
    "        'TR.TRBCIndustry', 'TR.TRBCIndustryCode', 'TR.IR.RatingSourceDescription.date'],\n",
    "    parameters={'SDate': 0, 'EDate': -3, 'FRQ': 'FY'})  # This will look for a data-point every Fianancial Year for the past 3 Financial Years"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "b7bc16c1-6232-4fa6-86cc-dfea62a82488",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Issuer Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Economic Sector Code</th>\n",
       "      <th>TRBC Business Sector Name</th>\n",
       "      <th>TRBC Business Sector Code</th>\n",
       "      <th>TRBC Industry Group Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "      <th>TRBC Industry Name</th>\n",
       "      <th>TRBC Industry Code</th>\n",
       "      <th>Date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2021-11-26</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>2020-11-18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>2019-11-27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Moody's Senior Unsecured</td>\n",
       "      <td>MSU</td>\n",
       "      <td>Baa2</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>2020-05-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>2019-12-02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument    Rating Source Description Rating Source Type Issuer Rating  \\\n",
       "0     BARC.L  R&I Long-term Issuer Rating                RII             A   \n",
       "1     BARC.L  R&I Long-term Issuer Rating                RII            A-   \n",
       "2     BARC.L  R&I Long-term Issuer Rating                RII            A-   \n",
       "3     BARC.L                                                                 \n",
       "4      TRI.N                                                                 \n",
       "5      TRI.N     Moody's Senior Unsecured                MSU          Baa2   \n",
       "6      TRI.N  Egan-Jones Senior Unsecured                EJU          BBB-   \n",
       "7      TRI.N                                                                 \n",
       "\n",
       "  TRBC Economic Sector Name TRBC Economic Sector Code  \\\n",
       "0                Financials                        55   \n",
       "1                                                       \n",
       "2                                                       \n",
       "3                                                       \n",
       "4               Industrials                        52   \n",
       "5                                                       \n",
       "6                                                       \n",
       "7                                                       \n",
       "\n",
       "          TRBC Business Sector Name TRBC Business Sector Code  \\\n",
       "0     Banking & Investment Services                      5510   \n",
       "1                                                               \n",
       "2                                                               \n",
       "3                                                               \n",
       "4  Industrial & Commercial Services                      5220   \n",
       "5                                                               \n",
       "6                                                               \n",
       "7                                                               \n",
       "\n",
       "             TRBC Industry Group Name TRBC Industry Group Code  \\\n",
       "0                    Banking Services                   551010   \n",
       "1                                                                \n",
       "2                                                                \n",
       "3                                                                \n",
       "4  Professional & Commercial Services                   522030   \n",
       "5                                                                \n",
       "6                                                                \n",
       "7                                                                \n",
       "\n",
       "                  TRBC Industry Name TRBC Industry Code       Date  \n",
       "0                              Banks           55101010 2021-11-26  \n",
       "1                                                       2020-11-18  \n",
       "2                                                       2019-11-27  \n",
       "3                                                              NaT  \n",
       "4  Professional Information Services           52203070        NaT  \n",
       "5                                                       2020-05-11  \n",
       "6                                                       2019-12-02  \n",
       "7                                                              NaT  "
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "2359c1b3-47e1-43a2-9ab8-120de6043700",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Issuer Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Economic Sector Code</th>\n",
       "      <th>TRBC Business Sector Name</th>\n",
       "      <th>TRBC Business Sector Code</th>\n",
       "      <th>TRBC Industry Group Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "      <th>TRBC Industry Name</th>\n",
       "      <th>TRBC Industry Code</th>\n",
       "      <th>Date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2021-11-26</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2020-11-18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2019-11-27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2019-11-27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Moody's Senior Unsecured</td>\n",
       "      <td>MSU</td>\n",
       "      <td>Baa2</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2020-05-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2019-12-02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2019-12-02</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  Instrument    Rating Source Description Rating Source Type Issuer Rating  \\\n",
       "0     BARC.L  R&I Long-term Issuer Rating                RII             A   \n",
       "1     BARC.L  R&I Long-term Issuer Rating                RII            A-   \n",
       "2     BARC.L  R&I Long-term Issuer Rating                RII            A-   \n",
       "3     BARC.L  R&I Long-term Issuer Rating                RII            A-   \n",
       "4      TRI.N                          NaN                NaN           NaN   \n",
       "5      TRI.N     Moody's Senior Unsecured                MSU          Baa2   \n",
       "6      TRI.N  Egan-Jones Senior Unsecured                EJU          BBB-   \n",
       "7      TRI.N  Egan-Jones Senior Unsecured                EJU          BBB-   \n",
       "\n",
       "  TRBC Economic Sector Name TRBC Economic Sector Code  \\\n",
       "0                Financials                        55   \n",
       "1                Financials                        55   \n",
       "2                Financials                        55   \n",
       "3                Financials                        55   \n",
       "4               Industrials                        52   \n",
       "5               Industrials                        52   \n",
       "6               Industrials                        52   \n",
       "7               Industrials                        52   \n",
       "\n",
       "          TRBC Business Sector Name TRBC Business Sector Code  \\\n",
       "0     Banking & Investment Services                      5510   \n",
       "1     Banking & Investment Services                      5510   \n",
       "2     Banking & Investment Services                      5510   \n",
       "3     Banking & Investment Services                      5510   \n",
       "4  Industrial & Commercial Services                      5220   \n",
       "5  Industrial & Commercial Services                      5220   \n",
       "6  Industrial & Commercial Services                      5220   \n",
       "7  Industrial & Commercial Services                      5220   \n",
       "\n",
       "             TRBC Industry Group Name TRBC Industry Group Code  \\\n",
       "0                    Banking Services                   551010   \n",
       "1                    Banking Services                   551010   \n",
       "2                    Banking Services                   551010   \n",
       "3                    Banking Services                   551010   \n",
       "4  Professional & Commercial Services                   522030   \n",
       "5  Professional & Commercial Services                   522030   \n",
       "6  Professional & Commercial Services                   522030   \n",
       "7  Professional & Commercial Services                   522030   \n",
       "\n",
       "                  TRBC Industry Name TRBC Industry Code       Date  \n",
       "0                              Banks           55101010 2021-11-26  \n",
       "1                              Banks           55101010 2020-11-18  \n",
       "2                              Banks           55101010 2019-11-27  \n",
       "3                              Banks           55101010 2019-11-27  \n",
       "4  Professional Information Services           52203070        NaT  \n",
       "5  Professional Information Services           52203070 2020-05-11  \n",
       "6  Professional Information Services           52203070 2019-12-02  \n",
       "7  Professional Information Services           52203070 2019-12-02  "
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# The below in this cell is needed to forward fill our dataframe correctly:\n",
    "df1.replace({'': np.nan}, inplace=True)\n",
    "df1.where(pd.notnull(df1), np.nan, inplace=True)\n",
    "\n",
    "for i in df1.groupby(by=[\"Instrument\"]):\n",
    "    if i[0] == df1[\"Instrument\"][0]: _df1 = i[1].ffill()\n",
    "    else: _df1 = _df1.append(i[1].ffill())\n",
    "_df1"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9361c65e-b20e-4de1-917a-db1654f400e6",
   "metadata": {},
   "source": [
    "# <span style=\"color:red\"> check why these fields are not returning - Olivier</span>\n",
    "# <span style=\"color:blue\">I sent an email to Olivier and I am waiting for an answer</span>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "7318d4ec-8a33-4589-a2e4-6db781627cc0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<refinitiv.data.session.Definition object at 0x238da73ddf0 {name='workspace'}>"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rd.open_session(\"desktop.workspace\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "6a76b45e-5a56-4e8c-b114-5c12e5ddba68",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>VOD.L</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Issuer Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2015-12-17</th>\n",
       "      <td>Egan-Jones Commercial Paper</td>\n",
       "      <td>EJC</td>\n",
       "      <td>A1</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2015-12-17</th>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB+</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016-07-06</th>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018-10-04</th>\n",
       "      <td>Fitch Subordinated</td>\n",
       "      <td>FBD</td>\n",
       "      <td>BBB-</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-11-26</th>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-07-29</th>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>F2</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "VOD.L         Rating Source Description Rating Source Type Issuer Rating  \\\n",
       "Date                                                                       \n",
       "2015-12-17  Egan-Jones Commercial Paper                EJC            A1   \n",
       "2015-12-17  Egan-Jones Senior Unsecured                EJU          BBB+   \n",
       "2016-07-06  Egan-Jones Senior Unsecured                EJU           BBB   \n",
       "2018-10-04           Fitch Subordinated                FBD          BBB-   \n",
       "2019-11-26  Egan-Jones Senior Unsecured                EJU          BBB-   \n",
       "2021-07-29       Fitch Commercial Paper                FCP            F2   \n",
       "\n",
       "VOD.L      TRBC Economic Sector Name TRBC Industry Group Code  \n",
       "Date                                                           \n",
       "2015-12-17                                                     \n",
       "2015-12-17                                                     \n",
       "2016-07-06                                                     \n",
       "2018-10-04                                                     \n",
       "2019-11-26                                                     \n",
       "2021-07-29                                                     "
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df2 = rd.get_history(\n",
    "    universe=['VOD.L'],\n",
    "    fields=['TR.IR.RatingSourceDescription', 'TR.IR.RatingSourceType',\n",
    "            'TR.IR.Rating','TR.TRBCEconomicSector','TR.TRBCIndustryGroupCode'],  \n",
    "    interval=\"1Y\",\n",
    "    start=\"2015-01-25\",#T10-06\",\n",
    "    end=\"2022-02-01\")\n",
    "\n",
    "df2"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "abc26717-8240-496f-af44-0d84f9df2277",
   "metadata": {
    "tags": []
   },
   "source": [
    "##### Fundamental and Reference with EDAPI\n",
    "\n",
    "You could do the same with the [EDAPI](https://developers.refinitiv.com/en/api-catalog/eikon/eikon-data-api), but as you can see, the dataframe returned is set to a format that may return many empty cells:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "e17fe81b-e8bc-49e2-99db-7586d4c2390b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<refinitiv.data.session.Definition object at 0x238da706340 {name='workspace'}>"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rd.open_session(\"desktop.workspace\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "e753a7c5-85ef-4751-8364-c20451d4e528",
   "metadata": {},
   "outputs": [],
   "source": [
    "df3, err = ek.get_data(\n",
    "    ['92857WAZ3=', 'BARC.L', 'TRI.N'],  # PSKc1\n",
    "    fields=[\n",
    "        'TR.IR.RatingSourceDescription', 'TR.IR.RatingSourceType', 'TR.GR.Rating',\n",
    "        'TR.TRBCEconomicSector', 'TR.TRBCEconSectorCode', 'TR.TRBCBusinessSector',\n",
    "        'TR.TRBCBusinessSectorCode', 'TR.TRBCIndustryGroup', 'TR.TRBCIndustryGroupCode',\n",
    "        'TR.TRBCIndustry', 'TR.TRBCIndustryCode'],\n",
    "    parameters={'SDate': 0, 'EDate': -3, 'FRQ': 'FY'})  # This will look for a data-point every Fianancial Year for the past 3 Financial Years"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "id": "c8bc2a84-68a7-4a5b-9c0f-17daea399168",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Economic Sector Code</th>\n",
       "      <th>TRBC Business Sector Name</th>\n",
       "      <th>TRBC Business Sector Code</th>\n",
       "      <th>TRBC Industry Group Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "      <th>TRBC Industry Name</th>\n",
       "      <th>TRBC Industry Code</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>Baa2</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Moody's Senior Unsecured</td>\n",
       "      <td>MSU</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    Instrument    Rating Source Description Rating Source Type Rating  \\\n",
       "0   92857WAZ3=       Fitch Commercial Paper                FCP   Baa2   \n",
       "1   92857WAZ3=                                                          \n",
       "2   92857WAZ3=  Egan-Jones Senior Unsecured                EJU    BBB   \n",
       "3   92857WAZ3=                                                          \n",
       "4       BARC.L  R&I Long-term Issuer Rating                RII   <NA>   \n",
       "5       BARC.L  R&I Long-term Issuer Rating                RII   <NA>   \n",
       "6       BARC.L  R&I Long-term Issuer Rating                RII   <NA>   \n",
       "7       BARC.L                                                   <NA>   \n",
       "8        TRI.N                                                   <NA>   \n",
       "9        TRI.N     Moody's Senior Unsecured                MSU   <NA>   \n",
       "10       TRI.N  Egan-Jones Senior Unsecured                EJU   <NA>   \n",
       "11       TRI.N                                                   <NA>   \n",
       "\n",
       "   TRBC Economic Sector Name  TRBC Economic Sector Code  \\\n",
       "0                 Technology                         57   \n",
       "1                                                  <NA>   \n",
       "2                                                  <NA>   \n",
       "3                                                  <NA>   \n",
       "4                 Financials                         55   \n",
       "5                                                  <NA>   \n",
       "6                                                  <NA>   \n",
       "7                                                  <NA>   \n",
       "8                Industrials                         52   \n",
       "9                                                  <NA>   \n",
       "10                                                 <NA>   \n",
       "11                                                 <NA>   \n",
       "\n",
       "           TRBC Business Sector Name  TRBC Business Sector Code  \\\n",
       "0        Telecommunications Services                       5740   \n",
       "1                                                          <NA>   \n",
       "2                                                          <NA>   \n",
       "3                                                          <NA>   \n",
       "4      Banking & Investment Services                       5510   \n",
       "5                                                          <NA>   \n",
       "6                                                          <NA>   \n",
       "7                                                          <NA>   \n",
       "8   Industrial & Commercial Services                       5220   \n",
       "9                                                          <NA>   \n",
       "10                                                         <NA>   \n",
       "11                                                         <NA>   \n",
       "\n",
       "              TRBC Industry Group Name  TRBC Industry Group Code  \\\n",
       "0          Telecommunications Services                    574010   \n",
       "1                                                           <NA>   \n",
       "2                                                           <NA>   \n",
       "3                                                           <NA>   \n",
       "4                     Banking Services                    551010   \n",
       "5                                                           <NA>   \n",
       "6                                                           <NA>   \n",
       "7                                                           <NA>   \n",
       "8   Professional & Commercial Services                    522030   \n",
       "9                                                           <NA>   \n",
       "10                                                          <NA>   \n",
       "11                                                          <NA>   \n",
       "\n",
       "                      TRBC Industry Name  TRBC Industry Code  \n",
       "0   Wireless Telecommunications Services            57401020  \n",
       "1                                                       <NA>  \n",
       "2                                                       <NA>  \n",
       "3                                                       <NA>  \n",
       "4                                  Banks            55101010  \n",
       "5                                                       <NA>  \n",
       "6                                                       <NA>  \n",
       "7                                                       <NA>  \n",
       "8      Professional Information Services            52203070  \n",
       "9                                                       <NA>  \n",
       "10                                                      <NA>  \n",
       "11                                                      <NA>  "
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df3"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "638d6058-778c-412c-b3ca-7605af760daf",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Economic Sector Code</th>\n",
       "      <th>TRBC Business Sector Name</th>\n",
       "      <th>TRBC Business Sector Code</th>\n",
       "      <th>TRBC Industry Group Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "      <th>TRBC Industry Name</th>\n",
       "      <th>TRBC Industry Code</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>Baa2</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>Baa2</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>92857WAZ3=</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Moody's Senior Unsecured</td>\n",
       "      <td>MSU</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    Instrument    Rating Source Description Rating Source Type Rating  \\\n",
       "0   92857WAZ3=       Fitch Commercial Paper                FCP   Baa2   \n",
       "1   92857WAZ3=       Fitch Commercial Paper                FCP   Baa2   \n",
       "2   92857WAZ3=  Egan-Jones Senior Unsecured                EJU    BBB   \n",
       "3   92857WAZ3=  Egan-Jones Senior Unsecured                EJU    BBB   \n",
       "4       BARC.L  R&I Long-term Issuer Rating                RII    NaN   \n",
       "5       BARC.L  R&I Long-term Issuer Rating                RII    NaN   \n",
       "6       BARC.L  R&I Long-term Issuer Rating                RII    NaN   \n",
       "7       BARC.L  R&I Long-term Issuer Rating                RII    NaN   \n",
       "8        TRI.N                          NaN                NaN    NaN   \n",
       "9        TRI.N     Moody's Senior Unsecured                MSU    NaN   \n",
       "10       TRI.N  Egan-Jones Senior Unsecured                EJU    NaN   \n",
       "11       TRI.N  Egan-Jones Senior Unsecured                EJU    NaN   \n",
       "\n",
       "   TRBC Economic Sector Name  TRBC Economic Sector Code  \\\n",
       "0                 Technology                         57   \n",
       "1                 Technology                         57   \n",
       "2                 Technology                         57   \n",
       "3                 Technology                         57   \n",
       "4                 Financials                         55   \n",
       "5                 Financials                         55   \n",
       "6                 Financials                         55   \n",
       "7                 Financials                         55   \n",
       "8                Industrials                         52   \n",
       "9                Industrials                         52   \n",
       "10               Industrials                         52   \n",
       "11               Industrials                         52   \n",
       "\n",
       "           TRBC Business Sector Name  TRBC Business Sector Code  \\\n",
       "0        Telecommunications Services                       5740   \n",
       "1        Telecommunications Services                       5740   \n",
       "2        Telecommunications Services                       5740   \n",
       "3        Telecommunications Services                       5740   \n",
       "4      Banking & Investment Services                       5510   \n",
       "5      Banking & Investment Services                       5510   \n",
       "6      Banking & Investment Services                       5510   \n",
       "7      Banking & Investment Services                       5510   \n",
       "8   Industrial & Commercial Services                       5220   \n",
       "9   Industrial & Commercial Services                       5220   \n",
       "10  Industrial & Commercial Services                       5220   \n",
       "11  Industrial & Commercial Services                       5220   \n",
       "\n",
       "              TRBC Industry Group Name  TRBC Industry Group Code  \\\n",
       "0          Telecommunications Services                    574010   \n",
       "1          Telecommunications Services                    574010   \n",
       "2          Telecommunications Services                    574010   \n",
       "3          Telecommunications Services                    574010   \n",
       "4                     Banking Services                    551010   \n",
       "5                     Banking Services                    551010   \n",
       "6                     Banking Services                    551010   \n",
       "7                     Banking Services                    551010   \n",
       "8   Professional & Commercial Services                    522030   \n",
       "9   Professional & Commercial Services                    522030   \n",
       "10  Professional & Commercial Services                    522030   \n",
       "11  Professional & Commercial Services                    522030   \n",
       "\n",
       "                      TRBC Industry Name  TRBC Industry Code  \n",
       "0   Wireless Telecommunications Services            57401020  \n",
       "1   Wireless Telecommunications Services            57401020  \n",
       "2   Wireless Telecommunications Services            57401020  \n",
       "3   Wireless Telecommunications Services            57401020  \n",
       "4                                  Banks            55101010  \n",
       "5                                  Banks            55101010  \n",
       "6                                  Banks            55101010  \n",
       "7                                  Banks            55101010  \n",
       "8      Professional Information Services            52203070  \n",
       "9      Professional Information Services            52203070  \n",
       "10     Professional Information Services            52203070  \n",
       "11     Professional Information Services            52203070  "
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# The below in this cell is needed to forward fill our dataframe correctly:\n",
    "df3.replace({'': np.nan}, inplace=True)\n",
    "df3.where(pd.notnull(df3), np.nan, inplace=True)\n",
    "\n",
    "for i in df3.groupby(by=[\"Instrument\"]):\n",
    "    if i[0] == df3[\"Instrument\"][0]: _df3 = i[1].ffill()\n",
    "    else: _df3 = _df3.append(i[1].ffill())\n",
    "_df3"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d44f4e66-d0ca-47ed-b341-79cd3da5d170",
   "metadata": {
    "tags": []
   },
   "source": [
    "## AdfinX RealTime - AdxRtChain\n",
    "\n",
    "### What does AdxRtChain do?\n",
    "\n",
    "As per [Tutorial 3 - Real-time Chain Retrieval - AdxRtChain](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-3-real-time-chain-retrieval-adx-rt-chain)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/adxrtchain.zip), Adfin X RealTime Chain (AdxRtChain) returns a list of the constituent instrument codes for any chain such as 0#.FTSE (the FTSE 100 instruments). Data is returned as OnUpdate event, the only other event is OnStatusChange:\n",
    "\n",
    "<img src=\"imgs/AdxRtChain.PNG\">\n",
    "\n",
    "### VBA\n",
    "\n",
    "In VBA, we went through with the creation of `cmdGetChain_Click`:\n",
    "\n",
    ">     Private Sub cmdGetChain_Click()\n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         If myAdxRtChain Is Nothing Then Set myAdxRtChain = CreateAdxRtChain()\n",
    ">         \n",
    ">         With myAdxRtChain\n",
    ">             .Source = \"IDN\"\n",
    ">             .ItemName = Range(\"G6\").Value\n",
    ">             .RequestChain\n",
    ">         End With\n",
    ">     End Sub\n",
    "\n",
    "then `myAdxRtChain_OnUpdate`:\n",
    "\n",
    ">     Private Sub myAdxRtChain_OnUpdate(ByVal DataStatus As AdfinXRtLib.RT_DataStatus)\n",
    ">         Dim i As Integer\n",
    ">         \n",
    ">         If DataStatus = RT_DS_FULL Then\n",
    ">             For i = 1 To UBound(myAdxRtChain.Data)\n",
    ">                 Range(\"G8\").Offset(i - 1, 0).Value = myAdxRtChain.Data(i)\n",
    ">             Next i\n",
    ">         End If\n",
    ">     End Sub\n",
    "\n",
    "then we ought to make sure we can close the connection with `cmdClearChain_Click`, which is done simply in Python with `rd.close_session()`.\n",
    "\n",
    "We can replicate this easily in Python with the Pricing snapshots and Fundamental & Reference data function `get_data()`:\n",
    "\n",
    "### Python"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a4745e04-1280-4c52-951e-149611c6cb34",
   "metadata": {},
   "source": [
    "For Equity indecies, you can use the RD library with `rd.get_data`, and Comodity indecies with `ek.get_data` as oer the below"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "id": "7c34b324-b3d3-47d2-a446-66ecb0f144d0",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Timestamp</th>\n",
       "      <th>Turnover</th>\n",
       "      <th>Enterprise Value To Sales (Daily Time Series Ratio)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>STAN.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>2.544400e+09</td>\n",
       "      <td>-1.160937</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>CRDA.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>1.749269e+09</td>\n",
       "      <td>4.899545</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ANTO.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>2.755175e+09</td>\n",
       "      <td>3.112088</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>BNZL.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>1.365848e+09</td>\n",
       "      <td>1.057789</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>SGE.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>2.418051e+09</td>\n",
       "      <td>4.535283</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>95</th>\n",
       "      <td>EDV.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>8.375011e+08</td>\n",
       "      <td>2.117672</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>96</th>\n",
       "      <td>OCDO.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>4.444120e+09</td>\n",
       "      <td>3.106968</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>97</th>\n",
       "      <td>LSEG.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>6.636446e+09</td>\n",
       "      <td>6.678556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>98</th>\n",
       "      <td>TSCO.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>2.512736e+09</td>\n",
       "      <td>0.435511</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>99</th>\n",
       "      <td>LGEN.L</td>\n",
       "      <td>2022-11-14T00:00:00Z</td>\n",
       "      <td>3.167601e+09</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>100 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Instrument             Timestamp      Turnover  \\\n",
       "0      STAN.L  2022-11-14T00:00:00Z  2.544400e+09   \n",
       "1      CRDA.L  2022-11-14T00:00:00Z  1.749269e+09   \n",
       "2      ANTO.L  2022-11-14T00:00:00Z  2.755175e+09   \n",
       "3      BNZL.L  2022-11-14T00:00:00Z  1.365848e+09   \n",
       "4       SGE.L  2022-11-14T00:00:00Z  2.418051e+09   \n",
       "..        ...                   ...           ...   \n",
       "95      EDV.L  2022-11-14T00:00:00Z  8.375011e+08   \n",
       "96     OCDO.L  2022-11-14T00:00:00Z  4.444120e+09   \n",
       "97     LSEG.L  2022-11-14T00:00:00Z  6.636446e+09   \n",
       "98     TSCO.L  2022-11-14T00:00:00Z  2.512736e+09   \n",
       "99     LGEN.L  2022-11-14T00:00:00Z  3.167601e+09   \n",
       "\n",
       "   Enterprise Value To Sales (Daily Time Series Ratio)  \n",
       "0                                           -1.160937   \n",
       "1                                            4.899545   \n",
       "2                                            3.112088   \n",
       "3                                            1.057789   \n",
       "4                                            4.535283   \n",
       "..                                                ...   \n",
       "95                                           2.117672   \n",
       "96                                           3.106968   \n",
       "97                                           6.678556   \n",
       "98                                           0.435511   \n",
       "99                                                      \n",
       "\n",
       "[100 rows x 4 columns]"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "FTSEConstituentDf1 = rd.get_data(\n",
    "    universe=['0#.FTSE'], # in Office COM API, you do not need the 0#, but it is requiered on our Python API calls\n",
    "    fields=['TR.TURNOVER.timestamp', 'TR.TURNOVER', 'TR.EVToSales'])\n",
    "FTSEConstituentDf1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "id": "e8b4212e-de94-4bd2-98bd-2e6c15fa70e6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>CF_ASK</th>\n",
       "      <th>CF_BID</th>\n",
       "      <th>CF_LAST</th>\n",
       "      <th>SETTLE</th>\n",
       "      <th>OPINT_1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>LCOTOT</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>2285639</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>LCOF3</td>\n",
       "      <td>93.2</td>\n",
       "      <td>93.19</td>\n",
       "      <td>93.19</td>\n",
       "      <td>95.99</td>\n",
       "      <td>347843</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>LCOG3</td>\n",
       "      <td>91.88</td>\n",
       "      <td>91.86</td>\n",
       "      <td>91.87</td>\n",
       "      <td>94.41</td>\n",
       "      <td>363978</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>LCOH3</td>\n",
       "      <td>90.67</td>\n",
       "      <td>90.65</td>\n",
       "      <td>90.67</td>\n",
       "      <td>92.98</td>\n",
       "      <td>219106</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>LCOJ3</td>\n",
       "      <td>89.55</td>\n",
       "      <td>89.53</td>\n",
       "      <td>89.55</td>\n",
       "      <td>91.68</td>\n",
       "      <td>100688</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>71</th>\n",
       "      <td>LCOX8</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>69.55</td>\n",
       "      <td>69.55</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>72</th>\n",
       "      <td>LCOZ8</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>69.17</td>\n",
       "      <td>69.44</td>\n",
       "      <td>69.44</td>\n",
       "      <td>124</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>73</th>\n",
       "      <td>LCOF9</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>69.37</td>\n",
       "      <td>69.37</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74</th>\n",
       "      <td>LCOG9</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>69.3</td>\n",
       "      <td>69.3</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75</th>\n",
       "      <td>LCOH9</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>69.23</td>\n",
       "      <td>69.23</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>76 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Instrument  CF_ASK  CF_BID  CF_LAST  SETTLE  OPINT_1\n",
       "0      LCOTOT    <NA>    <NA>     <NA>    <NA>  2285639\n",
       "1       LCOF3    93.2   93.19    93.19   95.99   347843\n",
       "2       LCOG3   91.88   91.86    91.87   94.41   363978\n",
       "3       LCOH3   90.67   90.65    90.67   92.98   219106\n",
       "4       LCOJ3   89.55   89.53    89.55   91.68   100688\n",
       "..        ...     ...     ...      ...     ...      ...\n",
       "71      LCOX8    <NA>    <NA>    69.55   69.55     <NA>\n",
       "72      LCOZ8    <NA>   69.17    69.44   69.44      124\n",
       "73      LCOF9    <NA>    <NA>    69.37   69.37     <NA>\n",
       "74      LCOG9    <NA>    <NA>     69.3    69.3     <NA>\n",
       "75      LCOH9    <NA>    <NA>    69.23   69.23     <NA>\n",
       "\n",
       "[76 rows x 6 columns]"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "LCOConstituentDf, err = ek.get_data(\n",
    "    ['0#LCO:'],  # PSKc1\n",
    "    fields=['CF_ASK', 'CF_BID','CF_LAST','SETTLE','OPINT_1'])\n",
    "LCOConstituentDf"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31bf01a9-3a7b-4c96-b6ae-da8f6e1455b0",
   "metadata": {
    "tags": []
   },
   "source": [
    "## AdfinX RealTime - AdxRtHistory - Interday Time Series History\n",
    "\n",
    "### What does AdxRtHistory do?\n",
    "\n",
    "Adfin RealTime History (AdxRtHistory) is used to retrieve time series (historic) data for an instrument or instruments except for intraday data. This was best exemplified in [Tutorial 5 - Time Series History - AdxRtHistory](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-5-time-series-history-adx-rt-history)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/adxrthistory.zip):\n",
    "\n",
    "\n",
    "<img src=\"imgs/AdxRtHistory Interday Time Series History Eg.PNG\">\n",
    "\n",
    "### VBA\n",
    "\n",
    "In VBA, we used `AdfinXRtLib`:\n",
    "\n",
    ">     ' Note the use of CreateReutersObject - function in the PLVbaApis module.\n",
    ">         If myAdxRtHist Is Nothing Then Set myAdxRtHist = CreateReutersObject(\"AdfinXRtLib.AdxRtHistory\")\n",
    ">         \n",
    ">         On Error GoTo errHndlr\n",
    ">         With myAdxRtHist\n",
    ">             .FlushData\n",
    ">             .ErrorMode = EXCEPTION ' EXCEPTION, DialogBox, NO_EXCEPTION\n",
    ">             .Source = \"IDN\"\n",
    ">             .ItemName = [C7].Value\n",
    ">             .Mode = [H8].Value\n",
    ">             .RequestHistory (\"DATE,CLOSE,VOLUME\") 'NOTE USE OF OLD FIELD NAMES, NOT (\"TRDPRC_1.TIMESTAMP,TRDPRC_1.CLOSE,TRDPRC_1.VOLUME\")\n",
    ">             \n",
    ">             'arrFlds = Array(\"DATE\",\"CLOSE\",\"VOLUME\")\n",
    ">             '.RequestHistory ()arrFlds\n",
    ">             '.RequestHistory (\"*\") ' \"*\" requests all fields.\n",
    ">         End With\n",
    "\n",
    "before the `Private Sub` '`myAdxRtHist_OnUpdate(ByVal DataStatus As AdfinXRtLib.RT_DataStatus)`'.\n",
    "\n",
    "Things are simpler in Python:\n",
    "\n",
    "### Python\n",
    "\n",
    "As aforementioned, AdxRtHistory is used to retrieve time series (historic) data for an instrument or instruments except for intraday data. This is exactly what the instruments `get_history` is for!"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "id": "65925094-f48a-41a8-ab23-859c1fb78b40",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['STAN.L', 'CRDA.L', 'ANTO.L', 'BNZL.L', 'SGE.L', 'SVT.L', 'BLND.L', 'ICAG.L', 'REL.L', 'SMIN.L', 'HSV.L', 'AZN.L', 'HSBA.L', 'CTEC.L', 'WPP.L', 'FRES.L', 'AAF.L', 'SGRO.L', 'SJP.L', 'TW.L', 'AHT.L', 'HLMA.L', 'III.L', 'CNA.L', 'MNG.L', 'BKGH.L', 'SMDS.L', 'NG.L', 'RKT.L', 'SKG.L', 'MRON.L', 'CPG.L', 'AUTOA.L', 'HBR.L', 'AV.L', 'ENT.L', 'DGE.L', 'INF.L', 'UU.L', 'PSHP.L', 'HLN.L', 'WTB.L', 'PRU.L', 'IMB.L', 'EXPN.L', 'BRBY.L', 'RS1R.L', 'GSK.L', 'LAND.L', 'BP.L', 'JD.L', 'ABF.L', 'AAL.L', 'ADML.L', 'RTO.L', 'RMV.L', 'SBRY.L', 'PHNX.L', 'FLTRF.L', 'IHG.L', 'BT.L', 'MNDI.L', 'BATS.L', 'PSON.L', 'CRH.L', 'SPX.L', 'PSN.L', 'RIO.L', 'CCH.L', 'DPH.L', 'RR.L', 'SN.L', 'BMEB.L', 'SSE.L', 'SMT.L', 'FRAS.L', 'HRGV.L', 'KGF.L', 'LLOY.L', 'NWG.L', 'SDR.L', 'NXT.L', 'ITRK.L', 'BDEV.L', 'SHEL.L', 'GLEN.L', 'VOD.L', 'AVV.L', 'BARC.L', 'FCIT.L', 'UTG.L', 'ICP.L', 'BAES.L', 'DCC.L', 'ULVR.L', 'EDV.L', 'OCDO.L', 'LSEG.L', 'TSCO.L', 'LGEN.L']\n"
     ]
    }
   ],
   "source": [
    "FTSEConstituents = list(FTSEConstituentDf1['Instrument'])\n",
    "print(FTSEConstituents)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "urban-bankruptcy",
   "metadata": {},
   "source": [
    "### <span style=\"color:red\">This is all wrong - entries are not correct - could be fault with version of library - use wheel from Olivier</span>\n",
    "\n",
    "### <span style=\"color:blue\">You will need to re-inquire as stilll not correct in new RD lib</span>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "id": "264c30dd-93a8-4df3-8cef-6ebf34b872ba",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['CRDA.L', 'ANTO.L', 'BNZL.L', 'SGE.L', 'SVT.L']"
      ]
     },
     "execution_count": 41,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "FTSEConstituents[1:6]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "id": "575580d8-91cc-43e8-b077-ee8e1c61fb15",
   "metadata": {},
   "outputs": [],
   "source": [
    "TimeSeriesDf = rd.get_history(\n",
    "    universe=FTSEConstituents[1:6],\n",
    "    fields=['TR.RevenueMean', 'TR.PriceClose'],  # 'TR' fields are usually historic ones.\n",
    "    interval=\"1D\",\n",
    "    start=\"2022-01-25\",\n",
    "    end=\"2022-02-01\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "78c6dcb5-aa38-4003-b97a-f95d2eae6697",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th colspan=\"2\" halign=\"left\">CRDA.L</th>\n",
       "      <th colspan=\"2\" halign=\"left\">ANTO.L</th>\n",
       "      <th colspan=\"2\" halign=\"left\">BNZL.L</th>\n",
       "      <th colspan=\"2\" halign=\"left\">SGE.L</th>\n",
       "      <th colspan=\"2\" halign=\"left\">SVT.L</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>Revenue - Mean</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Revenue - Mean</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Revenue - Mean</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Revenue - Mean</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Revenue - Mean</th>\n",
       "      <th>Price Close</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-18</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1945522400</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-24</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>7417035810</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-24</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>7417035810</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-24</th>\n",
       "      <td>1836164220</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-24</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>7417035810</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-24</th>\n",
       "      <td>1836164220</td>\n",
       "      <td></td>\n",
       "      <td>7417035810</td>\n",
       "      <td></td>\n",
       "      <td>10199194160</td>\n",
       "      <td></td>\n",
       "      <td>1921980430</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-25</th>\n",
       "      <td></td>\n",
       "      <td>7666</td>\n",
       "      <td></td>\n",
       "      <td>1379</td>\n",
       "      <td></td>\n",
       "      <td>2721</td>\n",
       "      <td></td>\n",
       "      <td>762.4</td>\n",
       "      <td></td>\n",
       "      <td>2858</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-26</th>\n",
       "      <td></td>\n",
       "      <td>7830</td>\n",
       "      <td></td>\n",
       "      <td>1411.5</td>\n",
       "      <td>10220804680</td>\n",
       "      <td>2754</td>\n",
       "      <td>1925405860</td>\n",
       "      <td>713</td>\n",
       "      <td></td>\n",
       "      <td>2871</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-26</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>10220804680</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-26</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>10220804680</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-26</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>10220804680</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-26</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>10220804680</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1924686140</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1924686140</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>1836409180</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>1836409180</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>1836409180</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>1836409180</td>\n",
       "      <td>7880</td>\n",
       "      <td></td>\n",
       "      <td>1391.5</td>\n",
       "      <td></td>\n",
       "      <td>2776</td>\n",
       "      <td>1924686140</td>\n",
       "      <td>701</td>\n",
       "      <td></td>\n",
       "      <td>2914</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-27</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1924686140</td>\n",
       "      <td></td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-28</th>\n",
       "      <td></td>\n",
       "      <td>7774</td>\n",
       "      <td></td>\n",
       "      <td>1337.5</td>\n",
       "      <td></td>\n",
       "      <td>2786</td>\n",
       "      <td></td>\n",
       "      <td>711.2</td>\n",
       "      <td></td>\n",
       "      <td>2893</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-01-31</th>\n",
       "      <td></td>\n",
       "      <td>7972</td>\n",
       "      <td>7417848310</td>\n",
       "      <td>1332.5</td>\n",
       "      <td></td>\n",
       "      <td>2767</td>\n",
       "      <td></td>\n",
       "      <td>720.8</td>\n",
       "      <td></td>\n",
       "      <td>2873</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-02-01</th>\n",
       "      <td></td>\n",
       "      <td>8008</td>\n",
       "      <td>7424067690</td>\n",
       "      <td>1361.5</td>\n",
       "      <td></td>\n",
       "      <td>2775</td>\n",
       "      <td></td>\n",
       "      <td>718.6</td>\n",
       "      <td></td>\n",
       "      <td>2903</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   CRDA.L                     ANTO.L              \\\n",
       "           Revenue - Mean Price Close Revenue - Mean Price Close   \n",
       "Date                                                               \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>     7417035810               \n",
       "2022-01-24           <NA>        <NA>     7417035810               \n",
       "2022-01-24     1836164220                       <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>     7417035810               \n",
       "2022-01-24     1836164220                 7417035810               \n",
       "2022-01-25                       7666                       1379   \n",
       "2022-01-26                       7830                     1411.5   \n",
       "2022-01-26           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-26           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-26           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-26           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27     1836409180                       <NA>        <NA>   \n",
       "2022-01-27     1836409180                       <NA>        <NA>   \n",
       "2022-01-27     1836409180                       <NA>        <NA>   \n",
       "2022-01-27     1836409180        7880                     1391.5   \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-28                       7774                     1337.5   \n",
       "2022-01-31                       7972     7417848310      1332.5   \n",
       "2022-02-01                       8008     7424067690      1361.5   \n",
       "\n",
       "                   BNZL.L                      SGE.L              \\\n",
       "           Revenue - Mean Price Close Revenue - Mean Price Close   \n",
       "Date                                                               \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-18           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-24    10199194160                 1921980430               \n",
       "2022-01-25                       2721                      762.4   \n",
       "2022-01-26    10220804680        2754     1925405860         713   \n",
       "2022-01-26    10220804680                       <NA>        <NA>   \n",
       "2022-01-26    10220804680                       <NA>        <NA>   \n",
       "2022-01-26    10220804680                       <NA>        <NA>   \n",
       "2022-01-26    10220804680                       <NA>        <NA>   \n",
       "2022-01-27           <NA>        <NA>     1924686140               \n",
       "2022-01-27           <NA>        <NA>     1924686140               \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27           <NA>        <NA>           <NA>        <NA>   \n",
       "2022-01-27                       2776     1924686140         701   \n",
       "2022-01-27           <NA>        <NA>     1924686140               \n",
       "2022-01-28                       2786                      711.2   \n",
       "2022-01-31                       2767                      720.8   \n",
       "2022-02-01                       2775                      718.6   \n",
       "\n",
       "                    SVT.L              \n",
       "           Revenue - Mean Price Close  \n",
       "Date                                   \n",
       "2022-01-18     1945522400              \n",
       "2022-01-18     1945522400              \n",
       "2022-01-18     1945522400              \n",
       "2022-01-18     1945522400              \n",
       "2022-01-18     1945522400              \n",
       "2022-01-18     1945522400              \n",
       "2022-01-24           <NA>        <NA>  \n",
       "2022-01-24           <NA>        <NA>  \n",
       "2022-01-24           <NA>        <NA>  \n",
       "2022-01-24           <NA>        <NA>  \n",
       "2022-01-24           <NA>        <NA>  \n",
       "2022-01-25                       2858  \n",
       "2022-01-26                       2871  \n",
       "2022-01-26           <NA>        <NA>  \n",
       "2022-01-26           <NA>        <NA>  \n",
       "2022-01-26           <NA>        <NA>  \n",
       "2022-01-26           <NA>        <NA>  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-27                       2914  \n",
       "2022-01-27           <NA>        <NA>  \n",
       "2022-01-28                       2893  \n",
       "2022-01-31                       2873  \n",
       "2022-02-01                       2903  "
      ]
     },
     "execution_count": 39,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "TimeSeriesDf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "35e6cb62-618c-4175-8ec0-281c3a83047e",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bc41fd78-b18c-4058-a9bc-f83b3ff9c35e",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c0bc6a92-85c1-4f7e-94f5-5d4b82358985",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fa7bced3-995c-4d07-a5c4-10a46ed435ef",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d6a7de46-1a7f-401d-a23b-d9e37463ff4d",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9ffd17e8-5675-4b21-bb83-c5524442b08c",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0d6a0ada-3e04-4948-8102-067fb85bcf24",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1757044c-7238-4b03-84a9-bb58e5ed2079",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "617b9d18-b2c6-4f45-a752-879eeee746f6",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "66b30048-8041-4a5d-8a21-b040fc86758b",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "01ef06a3-d8cf-4c3c-90af-ab24abde5121",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8917c09e-57d2-4f55-970e-988fc10b35c1",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "057e0cb1-8706-4ec1-993e-cf734a1a8721",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2c8a2f73-7098-4160-9d4f-162bbcc8c693",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9916aa9e-1e42-47ce-9919-4685c130f00d",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "520c32f2-ec83-46c2-9b59-4ab7fec17117",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0613ab71-ed98-4e18-84f7-5ff677a760c4",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2b83c63e-085a-44d2-8700-47b83dd77cdf",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2b836fe1-e228-4e1f-a420-6b9856182ff6",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "abe0e972-9fbd-43e1-bfc7-e74652603614",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "98825033-ac33-498e-8329-1d5efa70e530",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3410e3dc-4b67-44de-a585-66d6d4d67542",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5f005a06-b35f-4fb8-af67-9314a8ff6a15",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d500f19e-543d-4970-9ddb-a8f1a7bfd066",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3f0a79b6-e7b5-443b-9884-0afee16a272a",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "822363ea-a6d9-415e-b3e1-f8a050f40051",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "82d33dd2-05c3-4e36-82d7-3ae0c90857e6",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6dca08bb-26f8-4f90-8268-28a0d34acb58",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "817f5486-8a41-4c0e-a649-8604fd1a5aa4",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b5fec290-d773-40df-abe7-cb3b6f53255b",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5d0b1ae5-2198-4273-a5ad-c8ccebd2bd51",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "af83038b-f89d-4f20-a15e-01b77afc8c5f",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "dad6df07-2509-4467-942d-afeb88a803a9",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7ce1f85f-5a05-42d3-8f00-46d374dbdd82",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0a32dcfb-a636-464b-af81-3241712f3abe",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4e0e6c37-3d1d-4a47-9c8a-37b9e766ad46",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0cbd2840-3ad5-4153-bed8-aadbe7969645",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "75a88d9a-d8f8-462e-a13f-0cb4a78cd833",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "db06368a-2f2c-4ba1-88bd-d0eee20e0c9f",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9658daa0-76e4-4f3b-9d29-dc3bc5f23eed",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b28051a8-4406-43d1-86d3-1fbd1ca092be",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8db0ea20-8720-4353-a0e3-26bc3a1fe9e2",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "969e1c47-07c5-4a5b-aee1-954836657b99",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "id": "fc61e4f8-12e7-4bf2-9caf-112af6708627",
   "metadata": {
    "tags": []
   },
   "source": [
    "## AdxRtHistory - Intraday Time Series History\n",
    "\n",
    "### VBA\n",
    "\n",
    "Adfin RealTime History (AdxRtHistory) Intraday is similar:\n",
    "\n",
    "### <span style=\"color:blue\">I can't make this excel sheet work, it doesn't look like it can work at all, looking at the VBA...</span>\n",
    "\n",
    "Which had few VBA lines needed:\n",
    "\n",
    ">     Private Sub cmdGetInterday_Click()\n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         MsgBox \"AdxRtHistory cannot retrieve INTRA day data, use the RHistoryAPI instead\"\n",
    ">     End Sub\n",
    "\n",
    "\n",
    "### Python\n",
    "\n",
    "Intraday data is just as easy to get:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "id": "ba62af5f-6b8b-4f78-8e10-012305ce4471",
   "metadata": {},
   "outputs": [],
   "source": [
    "# rd.open_session(\"platform.rdp\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "127726c1-4637-4360-9a5b-c369deb09e9c",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "IntradayTimeSeriesDf = rd.get_history(\n",
    "    universe=FTSEConstituents,\n",
    "    fields=['TRDPRC_1'],\n",
    "    interval=\"1min\",  # The consolidation interval. Supported intervals are: tick, tas, taq, minute, 1min, 5min, 10min, 30min, 60min, hourly, 1h, daily, 1d, 1D, 7D, 7d, weekly, 1W, monthly, 1M, quarterly, 3M, 6M, yearly, 1Y.\n",
    "    start=\"2022-06-01T13:00:00\",\n",
    "    end=\"2022-06-01T16:00:00\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "id": "8532ce84-cb09-4f8a-8baf-36e03489329b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>TRDPRC_1</th>\n",
       "      <th>STAN.L</th>\n",
       "      <th>CRDA.L</th>\n",
       "      <th>ANTO.L</th>\n",
       "      <th>BNZL.L</th>\n",
       "      <th>SGE.L</th>\n",
       "      <th>SVT.L</th>\n",
       "      <th>BLND.L</th>\n",
       "      <th>ICAG.L</th>\n",
       "      <th>REL.L</th>\n",
       "      <th>SMIN.L</th>\n",
       "      <th>...</th>\n",
       "      <th>UTG.L</th>\n",
       "      <th>ICP.L</th>\n",
       "      <th>BAES.L</th>\n",
       "      <th>DCC.L</th>\n",
       "      <th>ULVR.L</th>\n",
       "      <th>EDV.L</th>\n",
       "      <th>OCDO.L</th>\n",
       "      <th>LSEG.L</th>\n",
       "      <th>TSCO.L</th>\n",
       "      <th>LGEN.L</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Timestamp</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:00:00</th>\n",
       "      <td>636.8</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>2785.0</td>\n",
       "      <td>652.2</td>\n",
       "      <td>2855.0</td>\n",
       "      <td>526.506</td>\n",
       "      <td>129.2256</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1570.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1135.0</td>\n",
       "      <td>1540.0</td>\n",
       "      <td>777.16</td>\n",
       "      <td>5606.0</td>\n",
       "      <td>3759.7</td>\n",
       "      <td>1794.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>7252.004</td>\n",
       "      <td>260.87</td>\n",
       "      <td>258.3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:01:00</th>\n",
       "      <td>636.8</td>\n",
       "      <td>6884.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>2784.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>2854.0</td>\n",
       "      <td>526.6</td>\n",
       "      <td>128.74</td>\n",
       "      <td>2242.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>1136.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>777.5818</td>\n",
       "      <td>5608.0</td>\n",
       "      <td>3760.4058</td>\n",
       "      <td>1793.0</td>\n",
       "      <td>920.0</td>\n",
       "      <td>7253.7679</td>\n",
       "      <td>260.8942</td>\n",
       "      <td>258.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:02:00</th>\n",
       "      <td>636.6</td>\n",
       "      <td>6882.0</td>\n",
       "      <td>1507.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>526.4</td>\n",
       "      <td>128.64</td>\n",
       "      <td>2242.0</td>\n",
       "      <td>1570.78</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1539.5</td>\n",
       "      <td>777.6</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>3760.0</td>\n",
       "      <td>1793.0</td>\n",
       "      <td>920.2</td>\n",
       "      <td>7252.0</td>\n",
       "      <td>260.8139</td>\n",
       "      <td>258.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:03:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>6890.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>2787.0</td>\n",
       "      <td>652.6</td>\n",
       "      <td>2854.0</td>\n",
       "      <td>526.8</td>\n",
       "      <td>128.68</td>\n",
       "      <td>2243.0</td>\n",
       "      <td>1570.5</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>1540.5</td>\n",
       "      <td>778.16</td>\n",
       "      <td>5610.0</td>\n",
       "      <td>3759.5</td>\n",
       "      <td>1794.0</td>\n",
       "      <td>922.6</td>\n",
       "      <td>7252.0</td>\n",
       "      <td>260.9699</td>\n",
       "      <td>258.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:04:00</th>\n",
       "      <td>636.4</td>\n",
       "      <td>6892.0</td>\n",
       "      <td>1509.0</td>\n",
       "      <td>2785.0</td>\n",
       "      <td>653.0</td>\n",
       "      <td>2853.0</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>128.74</td>\n",
       "      <td>2244.0</td>\n",
       "      <td>1572.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1134.0</td>\n",
       "      <td>1542.0</td>\n",
       "      <td>778.4</td>\n",
       "      <td>5614.0</td>\n",
       "      <td>3759.6</td>\n",
       "      <td>1795.0</td>\n",
       "      <td>923.6</td>\n",
       "      <td>7255.7678</td>\n",
       "      <td>261.0</td>\n",
       "      <td>258.4984</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:38:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:39:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>777.4748</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:40:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:43:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:58:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>163 rows × 100 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "TRDPRC_1             STAN.L  CRDA.L  ANTO.L  BNZL.L  SGE.L   SVT.L   BLND.L  \\\n",
       "Timestamp                                                                     \n",
       "2022-06-01 13:00:00   636.8    <NA>    <NA>  2785.0  652.2  2855.0  526.506   \n",
       "2022-06-01 13:01:00   636.8  6884.0    <NA>  2784.0   <NA>  2854.0    526.6   \n",
       "2022-06-01 13:02:00   636.6  6882.0  1507.0    <NA>   <NA>    <NA>    526.4   \n",
       "2022-06-01 13:03:00    <NA>  6890.0    <NA>  2787.0  652.6  2854.0    526.8   \n",
       "2022-06-01 13:04:00   636.4  6892.0  1509.0  2785.0  653.0  2853.0     <NA>   \n",
       "...                     ...     ...     ...     ...    ...     ...      ...   \n",
       "2022-06-01 15:38:00    <NA>    <NA>    <NA>    <NA>   <NA>    <NA>     <NA>   \n",
       "2022-06-01 15:39:00    <NA>    <NA>    <NA>    <NA>   <NA>    <NA>     <NA>   \n",
       "2022-06-01 15:40:00    <NA>    <NA>    <NA>    <NA>   <NA>    <NA>     <NA>   \n",
       "2022-06-01 15:43:00    <NA>    <NA>    <NA>    <NA>   <NA>    <NA>     <NA>   \n",
       "2022-06-01 15:58:00    <NA>    <NA>    <NA>    <NA>   <NA>    <NA>     <NA>   \n",
       "\n",
       "TRDPRC_1               ICAG.L   REL.L   SMIN.L  ...   UTG.L   ICP.L    BAES.L  \\\n",
       "Timestamp                                       ...                             \n",
       "2022-06-01 13:00:00  129.2256    <NA>   1570.0  ...  1135.0  1540.0    777.16   \n",
       "2022-06-01 13:01:00    128.74  2242.0     <NA>  ...  1136.0    <NA>  777.5818   \n",
       "2022-06-01 13:02:00    128.64  2242.0  1570.78  ...    <NA>  1539.5     777.6   \n",
       "2022-06-01 13:03:00    128.68  2243.0   1570.5  ...    <NA>  1540.5    778.16   \n",
       "2022-06-01 13:04:00    128.74  2244.0   1572.0  ...  1134.0  1542.0     778.4   \n",
       "...                       ...     ...      ...  ...     ...     ...       ...   \n",
       "2022-06-01 15:38:00      <NA>    <NA>     <NA>  ...    <NA>    <NA>      <NA>   \n",
       "2022-06-01 15:39:00      <NA>    <NA>     <NA>  ...    <NA>    <NA>  777.4748   \n",
       "2022-06-01 15:40:00      <NA>    <NA>     <NA>  ...    <NA>    <NA>      <NA>   \n",
       "2022-06-01 15:43:00      <NA>    <NA>     <NA>  ...    <NA>    <NA>      <NA>   \n",
       "2022-06-01 15:58:00      <NA>    <NA>     <NA>  ...    <NA>    <NA>      <NA>   \n",
       "\n",
       "TRDPRC_1              DCC.L     ULVR.L   EDV.L  OCDO.L     LSEG.L    TSCO.L  \\\n",
       "Timestamp                                                                     \n",
       "2022-06-01 13:00:00  5606.0     3759.7  1794.0    <NA>   7252.004    260.87   \n",
       "2022-06-01 13:01:00  5608.0  3760.4058  1793.0   920.0  7253.7679  260.8942   \n",
       "2022-06-01 13:02:00    <NA>     3760.0  1793.0   920.2     7252.0  260.8139   \n",
       "2022-06-01 13:03:00  5610.0     3759.5  1794.0   922.6     7252.0  260.9699   \n",
       "2022-06-01 13:04:00  5614.0     3759.6  1795.0   923.6  7255.7678     261.0   \n",
       "...                     ...        ...     ...     ...        ...       ...   \n",
       "2022-06-01 15:38:00    <NA>       <NA>    <NA>    <NA>       <NA>      <NA>   \n",
       "2022-06-01 15:39:00    <NA>       <NA>    <NA>    <NA>       <NA>      <NA>   \n",
       "2022-06-01 15:40:00    <NA>       <NA>    <NA>    <NA>       <NA>      <NA>   \n",
       "2022-06-01 15:43:00    <NA>       <NA>    <NA>    <NA>       <NA>      <NA>   \n",
       "2022-06-01 15:58:00    <NA>       <NA>    <NA>    <NA>       <NA>      <NA>   \n",
       "\n",
       "TRDPRC_1               LGEN.L  \n",
       "Timestamp                      \n",
       "2022-06-01 13:00:00     258.3  \n",
       "2022-06-01 13:01:00     258.4  \n",
       "2022-06-01 13:02:00     258.4  \n",
       "2022-06-01 13:03:00     258.4  \n",
       "2022-06-01 13:04:00  258.4984  \n",
       "...                       ...  \n",
       "2022-06-01 15:38:00      <NA>  \n",
       "2022-06-01 15:39:00      <NA>  \n",
       "2022-06-01 15:40:00      <NA>  \n",
       "2022-06-01 15:43:00      <NA>  \n",
       "2022-06-01 15:58:00      <NA>  \n",
       "\n",
       "[163 rows x 100 columns]"
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "IntradayTimeSeriesDf"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a43988e8-1309-4288-867d-79f19227b4ff",
   "metadata": {
    "tags": []
   },
   "source": [
    "## RHistory\n",
    "\n",
    "### What does this do?\n",
    "\n",
    "As per the [EIKON FOR DEVELOPERS](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/documentation/eikon_for_developers_09032016.pdf) documentation that you may find [here](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/documentation),\n",
    "\n",
    "    The RHistory API enables developers to access time series data in VBA inside Excel in the same way as the RHistory function. The RHistory function retrieves a list of time series data for one instrument or a list of instruments at regular intervals (for example, on a daily, weekly, monthly, and yearly basis) for a given time period or for a given number of records. It also provides time series data at non-regular intervals, for example, TAS (Time and Sales), TAQ (Trade and Quote), and TICK (tick by tick).\n",
    "    \n",
    "    \n",
    "This COM API is best exemplified in [Tutorial 9 - Time Series History - RHistoryAPI](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-9-time-series-history-r-history-api)'s [Excxel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/rhistoryapi.zip) in which you will find the following VBA:\n",
    "    \n",
    "### VBA\n",
    "\n",
    "In VBA, we declared `myRHistoryQuery` via `Private WithEvents myRHistoryQuery As RHistoryAPI.RHistoryQuery` before:\n",
    "\n",
    ">         ' Set the query parameters accordingly to your needs\n",
    ">         With myRHistoryQuery\n",
    ">             .InstrumentIdList = Range(\"G6\").Value\n",
    ">             .FieldList = Range(\"G7\").Value 'Or of the form  \"TRDPRC_1.TIMESTAMP;TRDPRC_1.VALUE;TRDPRC_1.VOLUME\"\n",
    ">             \n",
    ">             '.FieldList = \"TRDPRC_1.TIMESTAMP;TRDPRC_1.HIGH;TRDPRC_1.CLOSE;TRDPRC_1.LOW;TRDPRC_1.OPEN;TRDPRC_1.VOLUME;TRDPRC_1.COUNT\"\n",
    ">             .RequestParams = Range(\"G8\").Value\n",
    ">             .RefreshParams = Range(\"G9\").Value\n",
    ">             .DisplayParams = Range(\"G10\").Value\n",
    ">         \n",
    ">             .Subscribe\n",
    ">         End With\n",
    "\n",
    "This allowed us to run sheets such as:\n",
    "\n",
    "<img src=\"imgs/RHistory Eg.PNG\">\n",
    "\n",
    "\n",
    "### Python\n",
    "\n",
    "For this, we can (yet again) use the `get_history` function:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "id": "57b45e4b-36c9-4ebb-a362-b01d29ef5224",
   "metadata": {},
   "outputs": [],
   "source": [
    "IntradayTimeSeriesDf2 = rd.get_history(\n",
    "    universe=FTSEConstituents,\n",
    "    fields=['TRDPRC_1'],\n",
    "    interval=\"10min\", # The consolidation interval. Supported intervals are: tick, tas, taq, minute, 1min, 5min, 10min, 30min, 60min, hourly, 1h, daily, 1d, 1D, 7D, 7d, weekly, 1W, monthly, 1M, quarterly, 3M, 6M, yearly, 1Y.\n",
    "    start=\"2022-06-01T13:00:00\",\n",
    "    end=\"2022-06-01T16:00:00\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "id": "a1e8bdec-56a4-46d9-9fb5-e4ddfb443cae",
   "metadata": {
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>TRDPRC_1</th>\n",
       "      <th>STAN.L</th>\n",
       "      <th>CRDA.L</th>\n",
       "      <th>ANTO.L</th>\n",
       "      <th>BNZL.L</th>\n",
       "      <th>SGE.L</th>\n",
       "      <th>SVT.L</th>\n",
       "      <th>BLND.L</th>\n",
       "      <th>ICAG.L</th>\n",
       "      <th>REL.L</th>\n",
       "      <th>SMIN.L</th>\n",
       "      <th>...</th>\n",
       "      <th>UTG.L</th>\n",
       "      <th>ICP.L</th>\n",
       "      <th>BAES.L</th>\n",
       "      <th>DCC.L</th>\n",
       "      <th>ULVR.L</th>\n",
       "      <th>EDV.L</th>\n",
       "      <th>OCDO.L</th>\n",
       "      <th>LSEG.L</th>\n",
       "      <th>TSCO.L</th>\n",
       "      <th>LGEN.L</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Timestamp</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:00:00</th>\n",
       "      <td>637.6</td>\n",
       "      <td>6918</td>\n",
       "      <td>1509.5</td>\n",
       "      <td>2789</td>\n",
       "      <td>653.2</td>\n",
       "      <td>2856.0</td>\n",
       "      <td>526.8</td>\n",
       "      <td>128.86</td>\n",
       "      <td>2250.0</td>\n",
       "      <td>1572.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1132</td>\n",
       "      <td>1545.0</td>\n",
       "      <td>779.153</td>\n",
       "      <td>5614</td>\n",
       "      <td>3762.0</td>\n",
       "      <td>1793</td>\n",
       "      <td>925.4</td>\n",
       "      <td>7262.0</td>\n",
       "      <td>260.64</td>\n",
       "      <td>258.4002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:10:00</th>\n",
       "      <td>636.6</td>\n",
       "      <td>6936</td>\n",
       "      <td>1511.5</td>\n",
       "      <td>2807</td>\n",
       "      <td>654.4</td>\n",
       "      <td>2852.0</td>\n",
       "      <td>526.4</td>\n",
       "      <td>129.16</td>\n",
       "      <td>2257.0</td>\n",
       "      <td>1573.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1129</td>\n",
       "      <td>1545.0</td>\n",
       "      <td>777.2</td>\n",
       "      <td>5620</td>\n",
       "      <td>3754.5</td>\n",
       "      <td>1796</td>\n",
       "      <td>930.2</td>\n",
       "      <td>7258.0</td>\n",
       "      <td>260.1</td>\n",
       "      <td>257.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:20:00</th>\n",
       "      <td>636.0</td>\n",
       "      <td>6940</td>\n",
       "      <td>1511.5</td>\n",
       "      <td>2812</td>\n",
       "      <td>655.6</td>\n",
       "      <td>2855.65</td>\n",
       "      <td>526.0</td>\n",
       "      <td>129.02</td>\n",
       "      <td>2255.0</td>\n",
       "      <td>1574.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1136</td>\n",
       "      <td>1543.0</td>\n",
       "      <td>776.352</td>\n",
       "      <td>5616</td>\n",
       "      <td>3754.0</td>\n",
       "      <td>1798</td>\n",
       "      <td>935.0</td>\n",
       "      <td>7256.0</td>\n",
       "      <td>260.2</td>\n",
       "      <td>257.6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:30:00</th>\n",
       "      <td>635.2</td>\n",
       "      <td>6934</td>\n",
       "      <td>1513.0</td>\n",
       "      <td>2809</td>\n",
       "      <td>658.0</td>\n",
       "      <td>2854.0</td>\n",
       "      <td>524.6</td>\n",
       "      <td>128.54</td>\n",
       "      <td>2252.0</td>\n",
       "      <td>1574.5</td>\n",
       "      <td>...</td>\n",
       "      <td>1132</td>\n",
       "      <td>1551.0</td>\n",
       "      <td>775.2</td>\n",
       "      <td>5610</td>\n",
       "      <td>3765.5</td>\n",
       "      <td>1807</td>\n",
       "      <td>938.2</td>\n",
       "      <td>7266.0</td>\n",
       "      <td>260.2</td>\n",
       "      <td>257.1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:40:00</th>\n",
       "      <td>635.7</td>\n",
       "      <td>6936</td>\n",
       "      <td>1516.0</td>\n",
       "      <td>2810</td>\n",
       "      <td>658.0</td>\n",
       "      <td>2852.0</td>\n",
       "      <td>524.4</td>\n",
       "      <td>128.26</td>\n",
       "      <td>2251.0</td>\n",
       "      <td>1575.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1131</td>\n",
       "      <td>1555.5</td>\n",
       "      <td>776.64</td>\n",
       "      <td>5608</td>\n",
       "      <td>3747.0</td>\n",
       "      <td>1799</td>\n",
       "      <td>937.6</td>\n",
       "      <td>7282.0</td>\n",
       "      <td>260.235</td>\n",
       "      <td>257.452</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 13:50:00</th>\n",
       "      <td>635.4</td>\n",
       "      <td>6914</td>\n",
       "      <td>1511.5</td>\n",
       "      <td>2805</td>\n",
       "      <td>658.8</td>\n",
       "      <td>2852.0</td>\n",
       "      <td>524.2</td>\n",
       "      <td>128.36</td>\n",
       "      <td>2251.0</td>\n",
       "      <td>1573.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1130</td>\n",
       "      <td>1551.5</td>\n",
       "      <td>776.6</td>\n",
       "      <td>5612</td>\n",
       "      <td>3742.0</td>\n",
       "      <td>1795</td>\n",
       "      <td>932.2</td>\n",
       "      <td>7280.0</td>\n",
       "      <td>260.0</td>\n",
       "      <td>257.3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:00:00</th>\n",
       "      <td>634.4</td>\n",
       "      <td>6870</td>\n",
       "      <td>1509.5</td>\n",
       "      <td>2797</td>\n",
       "      <td>656.4</td>\n",
       "      <td>2852.0</td>\n",
       "      <td>524.6</td>\n",
       "      <td>128.08</td>\n",
       "      <td>2242.0</td>\n",
       "      <td>1566.8</td>\n",
       "      <td>...</td>\n",
       "      <td>1132</td>\n",
       "      <td>1540.5</td>\n",
       "      <td>778.0</td>\n",
       "      <td>5608</td>\n",
       "      <td>3730.5</td>\n",
       "      <td>1797</td>\n",
       "      <td>923.2</td>\n",
       "      <td>7254.0</td>\n",
       "      <td>258.7</td>\n",
       "      <td>256.3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:10:00</th>\n",
       "      <td>634.2</td>\n",
       "      <td>6866</td>\n",
       "      <td>1505.5</td>\n",
       "      <td>2797</td>\n",
       "      <td>655.6</td>\n",
       "      <td>2845.0</td>\n",
       "      <td>523.0</td>\n",
       "      <td>127.5</td>\n",
       "      <td>2238.0</td>\n",
       "      <td>1565.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1131</td>\n",
       "      <td>1543.0</td>\n",
       "      <td>776.0</td>\n",
       "      <td>5612</td>\n",
       "      <td>3725.0</td>\n",
       "      <td>1804</td>\n",
       "      <td>918.8</td>\n",
       "      <td>7248.0</td>\n",
       "      <td>258.6</td>\n",
       "      <td>256.2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:20:00</th>\n",
       "      <td>633.0</td>\n",
       "      <td>6852</td>\n",
       "      <td>1502.0415</td>\n",
       "      <td>2793</td>\n",
       "      <td>655.8</td>\n",
       "      <td>2848.0</td>\n",
       "      <td>525.2</td>\n",
       "      <td>127.04</td>\n",
       "      <td>2236.328</td>\n",
       "      <td>1563.5</td>\n",
       "      <td>...</td>\n",
       "      <td>1136</td>\n",
       "      <td>1544.0</td>\n",
       "      <td>777.4</td>\n",
       "      <td>5610</td>\n",
       "      <td>3714.3808</td>\n",
       "      <td>1807</td>\n",
       "      <td>924.8</td>\n",
       "      <td>7250.0</td>\n",
       "      <td>258.8112</td>\n",
       "      <td>256.1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:30:00</th>\n",
       "      <td>632.8</td>\n",
       "      <td>6832</td>\n",
       "      <td>1496.5</td>\n",
       "      <td>2793</td>\n",
       "      <td>654.6</td>\n",
       "      <td>2854.6495</td>\n",
       "      <td>524.6</td>\n",
       "      <td>127.12</td>\n",
       "      <td>2232.0</td>\n",
       "      <td>1562.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1131</td>\n",
       "      <td>1545.0</td>\n",
       "      <td>778.2</td>\n",
       "      <td>5608</td>\n",
       "      <td>3714.5</td>\n",
       "      <td>1807</td>\n",
       "      <td>917.8</td>\n",
       "      <td>7223.96</td>\n",
       "      <td>259.03</td>\n",
       "      <td>255.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:40:00</th>\n",
       "      <td>632.8</td>\n",
       "      <td>6822</td>\n",
       "      <td>1494.5</td>\n",
       "      <td>2783</td>\n",
       "      <td>654.4</td>\n",
       "      <td>2846.0</td>\n",
       "      <td>524.6</td>\n",
       "      <td>127.5</td>\n",
       "      <td>2223.0</td>\n",
       "      <td>1559.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1131</td>\n",
       "      <td>1548.0</td>\n",
       "      <td>777.4</td>\n",
       "      <td>5608</td>\n",
       "      <td>3710.0</td>\n",
       "      <td>1808</td>\n",
       "      <td>915.0</td>\n",
       "      <td>7222.0</td>\n",
       "      <td>259.1</td>\n",
       "      <td>255.3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 14:50:00</th>\n",
       "      <td>633.4</td>\n",
       "      <td>6820</td>\n",
       "      <td>1501.5</td>\n",
       "      <td>2790</td>\n",
       "      <td>655.402</td>\n",
       "      <td>2849.0</td>\n",
       "      <td>524.2</td>\n",
       "      <td>127.52</td>\n",
       "      <td>2227.0</td>\n",
       "      <td>1562.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1127</td>\n",
       "      <td>1550.5</td>\n",
       "      <td>777.4</td>\n",
       "      <td>5614</td>\n",
       "      <td>3707.0</td>\n",
       "      <td>1810</td>\n",
       "      <td>918.0</td>\n",
       "      <td>7234.0</td>\n",
       "      <td>259.4279</td>\n",
       "      <td>256.3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:00:00</th>\n",
       "      <td>632.0</td>\n",
       "      <td>6814</td>\n",
       "      <td>1495.5</td>\n",
       "      <td>2787</td>\n",
       "      <td>655.4</td>\n",
       "      <td>2842.65</td>\n",
       "      <td>522.4</td>\n",
       "      <td>127.12</td>\n",
       "      <td>2218.0</td>\n",
       "      <td>1561.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1124</td>\n",
       "      <td>1543.5</td>\n",
       "      <td>776.0</td>\n",
       "      <td>5606</td>\n",
       "      <td>3704.0</td>\n",
       "      <td>1810</td>\n",
       "      <td>911.2</td>\n",
       "      <td>7198.0</td>\n",
       "      <td>259.2</td>\n",
       "      <td>256.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:10:00</th>\n",
       "      <td>632.4</td>\n",
       "      <td>6796</td>\n",
       "      <td>1502.75</td>\n",
       "      <td>2786</td>\n",
       "      <td>653.6</td>\n",
       "      <td>2839.0</td>\n",
       "      <td>522.2</td>\n",
       "      <td>126.78</td>\n",
       "      <td>2210.0</td>\n",
       "      <td>1560.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1121</td>\n",
       "      <td>1549.5</td>\n",
       "      <td>777.0</td>\n",
       "      <td>5608</td>\n",
       "      <td>3702.5</td>\n",
       "      <td>1808</td>\n",
       "      <td>910.2</td>\n",
       "      <td>7180.0</td>\n",
       "      <td>259.3</td>\n",
       "      <td>256.12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:20:00</th>\n",
       "      <td>632.4</td>\n",
       "      <td>6782</td>\n",
       "      <td>1500.0</td>\n",
       "      <td>2793</td>\n",
       "      <td>652.4</td>\n",
       "      <td>2836.0</td>\n",
       "      <td>520.6</td>\n",
       "      <td>126.54</td>\n",
       "      <td>2206.0</td>\n",
       "      <td>1558.5</td>\n",
       "      <td>...</td>\n",
       "      <td>1116</td>\n",
       "      <td>1543.5</td>\n",
       "      <td>777.6</td>\n",
       "      <td>5600</td>\n",
       "      <td>3695.5</td>\n",
       "      <td>1805</td>\n",
       "      <td>910.4</td>\n",
       "      <td>7138.0</td>\n",
       "      <td>259.0</td>\n",
       "      <td>254.6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:30:00</th>\n",
       "      <td>632.8</td>\n",
       "      <td>6758</td>\n",
       "      <td>1495.0</td>\n",
       "      <td>2811</td>\n",
       "      <td>653.6</td>\n",
       "      <td>2833.0</td>\n",
       "      <td>521.2</td>\n",
       "      <td>125.92</td>\n",
       "      <td>2207.0</td>\n",
       "      <td>1561.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1125</td>\n",
       "      <td>1540.5</td>\n",
       "      <td>777.4748</td>\n",
       "      <td>5604</td>\n",
       "      <td>3705.0</td>\n",
       "      <td>1804</td>\n",
       "      <td>908.6</td>\n",
       "      <td>7144.0</td>\n",
       "      <td>258.9</td>\n",
       "      <td>255.6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:40:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-06-01 15:50:00</th>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>...</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>18 rows × 100 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "TRDPRC_1             STAN.L  CRDA.L     ANTO.L  BNZL.L    SGE.L      SVT.L  \\\n",
       "Timestamp                                                                    \n",
       "2022-06-01 13:00:00   637.6    6918     1509.5    2789    653.2     2856.0   \n",
       "2022-06-01 13:10:00   636.6    6936     1511.5    2807    654.4     2852.0   \n",
       "2022-06-01 13:20:00   636.0    6940     1511.5    2812    655.6    2855.65   \n",
       "2022-06-01 13:30:00   635.2    6934     1513.0    2809    658.0     2854.0   \n",
       "2022-06-01 13:40:00   635.7    6936     1516.0    2810    658.0     2852.0   \n",
       "2022-06-01 13:50:00   635.4    6914     1511.5    2805    658.8     2852.0   \n",
       "2022-06-01 14:00:00   634.4    6870     1509.5    2797    656.4     2852.0   \n",
       "2022-06-01 14:10:00   634.2    6866     1505.5    2797    655.6     2845.0   \n",
       "2022-06-01 14:20:00   633.0    6852  1502.0415    2793    655.8     2848.0   \n",
       "2022-06-01 14:30:00   632.8    6832     1496.5    2793    654.6  2854.6495   \n",
       "2022-06-01 14:40:00   632.8    6822     1494.5    2783    654.4     2846.0   \n",
       "2022-06-01 14:50:00   633.4    6820     1501.5    2790  655.402     2849.0   \n",
       "2022-06-01 15:00:00   632.0    6814     1495.5    2787    655.4    2842.65   \n",
       "2022-06-01 15:10:00   632.4    6796    1502.75    2786    653.6     2839.0   \n",
       "2022-06-01 15:20:00   632.4    6782     1500.0    2793    652.4     2836.0   \n",
       "2022-06-01 15:30:00   632.8    6758     1495.0    2811    653.6     2833.0   \n",
       "2022-06-01 15:40:00    <NA>    <NA>       <NA>    <NA>     <NA>       <NA>   \n",
       "2022-06-01 15:50:00    <NA>    <NA>       <NA>    <NA>     <NA>       <NA>   \n",
       "\n",
       "TRDPRC_1             BLND.L  ICAG.L     REL.L  SMIN.L  ...  UTG.L   ICP.L  \\\n",
       "Timestamp                                              ...                  \n",
       "2022-06-01 13:00:00   526.8  128.86    2250.0  1572.0  ...   1132  1545.0   \n",
       "2022-06-01 13:10:00   526.4  129.16    2257.0  1573.0  ...   1129  1545.0   \n",
       "2022-06-01 13:20:00   526.0  129.02    2255.0  1574.0  ...   1136  1543.0   \n",
       "2022-06-01 13:30:00   524.6  128.54    2252.0  1574.5  ...   1132  1551.0   \n",
       "2022-06-01 13:40:00   524.4  128.26    2251.0  1575.0  ...   1131  1555.5   \n",
       "2022-06-01 13:50:00   524.2  128.36    2251.0  1573.0  ...   1130  1551.5   \n",
       "2022-06-01 14:00:00   524.6  128.08    2242.0  1566.8  ...   1132  1540.5   \n",
       "2022-06-01 14:10:00   523.0   127.5    2238.0  1565.0  ...   1131  1543.0   \n",
       "2022-06-01 14:20:00   525.2  127.04  2236.328  1563.5  ...   1136  1544.0   \n",
       "2022-06-01 14:30:00   524.6  127.12    2232.0  1562.0  ...   1131  1545.0   \n",
       "2022-06-01 14:40:00   524.6   127.5    2223.0  1559.0  ...   1131  1548.0   \n",
       "2022-06-01 14:50:00   524.2  127.52    2227.0  1562.0  ...   1127  1550.5   \n",
       "2022-06-01 15:00:00   522.4  127.12    2218.0  1561.0  ...   1124  1543.5   \n",
       "2022-06-01 15:10:00   522.2  126.78    2210.0  1560.0  ...   1121  1549.5   \n",
       "2022-06-01 15:20:00   520.6  126.54    2206.0  1558.5  ...   1116  1543.5   \n",
       "2022-06-01 15:30:00   521.2  125.92    2207.0  1561.0  ...   1125  1540.5   \n",
       "2022-06-01 15:40:00    <NA>    <NA>      <NA>    <NA>  ...   <NA>    <NA>   \n",
       "2022-06-01 15:50:00    <NA>    <NA>      <NA>    <NA>  ...   <NA>    <NA>   \n",
       "\n",
       "TRDPRC_1               BAES.L  DCC.L     ULVR.L  EDV.L  OCDO.L   LSEG.L  \\\n",
       "Timestamp                                                                 \n",
       "2022-06-01 13:00:00   779.153   5614     3762.0   1793   925.4   7262.0   \n",
       "2022-06-01 13:10:00     777.2   5620     3754.5   1796   930.2   7258.0   \n",
       "2022-06-01 13:20:00   776.352   5616     3754.0   1798   935.0   7256.0   \n",
       "2022-06-01 13:30:00     775.2   5610     3765.5   1807   938.2   7266.0   \n",
       "2022-06-01 13:40:00    776.64   5608     3747.0   1799   937.6   7282.0   \n",
       "2022-06-01 13:50:00     776.6   5612     3742.0   1795   932.2   7280.0   \n",
       "2022-06-01 14:00:00     778.0   5608     3730.5   1797   923.2   7254.0   \n",
       "2022-06-01 14:10:00     776.0   5612     3725.0   1804   918.8   7248.0   \n",
       "2022-06-01 14:20:00     777.4   5610  3714.3808   1807   924.8   7250.0   \n",
       "2022-06-01 14:30:00     778.2   5608     3714.5   1807   917.8  7223.96   \n",
       "2022-06-01 14:40:00     777.4   5608     3710.0   1808   915.0   7222.0   \n",
       "2022-06-01 14:50:00     777.4   5614     3707.0   1810   918.0   7234.0   \n",
       "2022-06-01 15:00:00     776.0   5606     3704.0   1810   911.2   7198.0   \n",
       "2022-06-01 15:10:00     777.0   5608     3702.5   1808   910.2   7180.0   \n",
       "2022-06-01 15:20:00     777.6   5600     3695.5   1805   910.4   7138.0   \n",
       "2022-06-01 15:30:00  777.4748   5604     3705.0   1804   908.6   7144.0   \n",
       "2022-06-01 15:40:00      <NA>   <NA>       <NA>   <NA>    <NA>     <NA>   \n",
       "2022-06-01 15:50:00      <NA>   <NA>       <NA>   <NA>    <NA>     <NA>   \n",
       "\n",
       "TRDPRC_1               TSCO.L    LGEN.L  \n",
       "Timestamp                                \n",
       "2022-06-01 13:00:00    260.64  258.4002  \n",
       "2022-06-01 13:10:00     260.1     257.7  \n",
       "2022-06-01 13:20:00     260.2     257.6  \n",
       "2022-06-01 13:30:00     260.2     257.1  \n",
       "2022-06-01 13:40:00   260.235   257.452  \n",
       "2022-06-01 13:50:00     260.0     257.3  \n",
       "2022-06-01 14:00:00     258.7     256.3  \n",
       "2022-06-01 14:10:00     258.6     256.2  \n",
       "2022-06-01 14:20:00  258.8112     256.1  \n",
       "2022-06-01 14:30:00    259.03     255.7  \n",
       "2022-06-01 14:40:00     259.1     255.3  \n",
       "2022-06-01 14:50:00  259.4279     256.3  \n",
       "2022-06-01 15:00:00     259.2     256.0  \n",
       "2022-06-01 15:10:00     259.3    256.12  \n",
       "2022-06-01 15:20:00     259.0     254.6  \n",
       "2022-06-01 15:30:00     258.9     255.6  \n",
       "2022-06-01 15:40:00      <NA>      <NA>  \n",
       "2022-06-01 15:50:00      <NA>      <NA>  \n",
       "\n",
       "[18 rows x 100 columns]"
      ]
     },
     "execution_count": 42,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "IntradayTimeSeriesDf2"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a205444c-2b48-4b3e-9382-3e9a2c6b8ef7",
   "metadata": {},
   "source": [
    "## PLSynchronization Manager\n",
    "\n",
    "This synchronisation manager was an old method whereby the COM API managed connections to Refinitiv Datasets. It is no longer required in python."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "96dc4f02-90af-464f-8be7-454366b1084b",
   "metadata": {
    "tags": []
   },
   "source": [
    "## DEX2\n",
    "\n",
    "### What does this do?\n",
    "\n",
    "The DEX2 interface provided a broad range of content and functionality such Fundamental and Reference as well as timeseries histories of such fields. The DEX2 interface also provided interday timeseries histories for both realtime and non-realtime data. In addition you could use it for symbology conversion. \n",
    "\n",
    "### DEX2 ID to RIC (Symbology Conversion)\n",
    "\n",
    "### <span style=\"color:blue\">I can't make this excel sheet work</span>\n",
    "\n",
    "As shown in [Tutorial 6 - Data Engine - Dex2](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-6-data-engine-dex-2)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/dex2.zip), we can convert symbols using the COM API.\n",
    "\n",
    "#### VBA\n",
    "\n",
    "After setting `MyDex2Mgr = CreateReutersObject(\"Dex2.Dex2Mgr\")`, for ISINs, we can then go ahead with\n",
    "\n",
    ">     ' Must call Initialise() at once\n",
    ">     m_cookie = MyDex2Mgr.Initialize()\n",
    ">     ' We can then create an RData object\n",
    ">     Set myRData1 = MyDex2Mgr.CreateRData(m_cookie)\n",
    ">     \n",
    ">     With MyDex2Mgr\n",
    ">         .SetErrorHandling m_cookie, DE_EH_STRING ' Could also use DE_EH_ERROR_CODES\n",
    ">     End With\n",
    ">     \n",
    ">     ' Set the properties & methods for the DEX2Lib.RData object\n",
    ">     With myRData1\n",
    ">         .InstrumentIDList = Range(\"B7\").Value ' Could use \"TRI.N\", \"TRI.N; GOOG.O; MSFT.O\" or array, e.g. arrInstrList.\n",
    ">         .FieldList = Range(\"D7\").Value & \"; \" & Range(\"D8\").Value  '\"RI.ID.RIC; RI.ID.ISIN\" ' Could use \"RI.ID.RIC\", \"RI.ID.RIC; RI.ID.WERT\" or array, e.g. arrFldList.\n",
    ">         .DisplayParam = \"Transpose:Y\"\n",
    ">         'N.B. Could use .SetParameter \"TRI.N; MSFT.O\",\"RF.G.COMPNAME; RF.G.NUMEMPLOY; RF.G.CNTEMAIL\", _\n",
    ">             \"\", \"RH:In CH:Fd Transpose:Y\"\n",
    ">         'Hence .SetParameter [InstrumentIDList].Value, [FieldList].Value, [RequestParam].Value, [DisplayParam].Value\n",
    ">         \n",
    ">         'Ignore cache; get data directly from the Snapshot Server\n",
    ">         '.Subscribe False\n",
    ">         'Or use cache by default\n",
    ">         .Subscribe\n",
    ">     End With\n",
    ">     Exit Sub\n",
    "\n",
    "For SEDOL, we can use:\n",
    "\n",
    ">     ' Must call Initialise() at once\n",
    ">     m_cookie = MyDex2Mgr.Initialize()\n",
    ">     ' We can then create an RData object\n",
    ">     Set myRData2 = MyDex2Mgr.CreateRData(m_cookie)\n",
    ">     \n",
    ">     With MyDex2Mgr\n",
    ">         .SetErrorHandling m_cookie, DE_EH_STRING ' Could also use DE_EH_ERROR_CODES\n",
    ">     End With\n",
    ">     \n",
    ">     ' Set the properties & methods for the DEX2Lib.RData object\n",
    ">     With myRData2\n",
    ">         .InstrumentIDList = [B10].Value ' Could use \"TRI.N\", \"TRI.N; GOOG.O; MSFT.O\" or array, e.g. arrInstrList.\n",
    ">         .FieldList = Range(\"D10\").Value & \"; \" & Range(\"D11\").Value  '\"RI.ID.RIC; RI.ID.SEDOL\" ' Could use \"RI.ID.RIC\", \"RI.ID.RIC; RI.ID.WERT\" or array, e.g. arrFldList.\n",
    ">         .DisplayParam = \"Transpose:Y\"\n",
    ">         'N.B. Could use .SetParameter \"TRI.N; MSFT.O\",\"RF.G.COMPNAME; RF.G.NUMEMPLOY; RF.G.CNTEMAIL\", _\n",
    ">             \"\", \"RH:In CH:Fd Transpose:Y\"\n",
    ">         'Hence .SetParameter [InstrumentIDList].Value, [FieldList].Value, [RequestParam].Value, [DisplayParam].Value\n",
    ">         \n",
    ">         'Ignore cache; get data directly from the Snapshot Server\n",
    ">         '.Subscribe False\n",
    ">         'Or use cache by default\n",
    ">         .Subscribe\n",
    ">     End With\n",
    ">     Exit Sub\n",
    "\n",
    "#### Python\n",
    "\n",
    "Symbology conversions in python are a lot more powerful than in Excel using the COM API. The extent of the use-cases for symbology conversions are best explained in our [GitHub Repository](https://github.com/Refinitiv-API-Samples/Example.DataLibrary.Python/blob/main/Examples/2-Content/2.05-Symbology/EX-2.05.01-Symbology.ipynb), but for the sake of completeness, you can see an example use in the 2 cells directly below:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "6b285710-37cf-4340-a163-4146f3305319",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>DocumentTitle</th>\n",
       "      <th>RIC</th>\n",
       "      <th>IssueISIN</th>\n",
       "      <th>CUSIP</th>\n",
       "      <th>SEDOL</th>\n",
       "      <th>TickerSymbol</th>\n",
       "      <th>IssuerOAPermID</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>MSFT.O</th>\n",
       "      <td>Microsoft Corp, Ordinary Share, NASDAQ Global ...</td>\n",
       "      <td>MSFT.O</td>\n",
       "      <td>US5949181045</td>\n",
       "      <td>594918104</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>MSFT</td>\n",
       "      <td>4295907168</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AAPL.O</th>\n",
       "      <td>Apple Inc, Ordinary Share, NASDAQ Global Selec...</td>\n",
       "      <td>AAPL.O</td>\n",
       "      <td>US0378331005</td>\n",
       "      <td>037833100</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>AAPL</td>\n",
       "      <td>4295905573</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>GOOG.O</th>\n",
       "      <td>Alphabet Inc, Ordinary Share, Class C, NASDAQ ...</td>\n",
       "      <td>GOOG.O</td>\n",
       "      <td>US02079K1079</td>\n",
       "      <td>02079K107</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>GOOG</td>\n",
       "      <td>5030853586</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>IBM.N</th>\n",
       "      <td>International Business Machines Corp, Ordinary...</td>\n",
       "      <td>IBM.N</td>\n",
       "      <td>US4592001014</td>\n",
       "      <td>459200101</td>\n",
       "      <td>2005973</td>\n",
       "      <td>IBM</td>\n",
       "      <td>4295904307</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            DocumentTitle     RIC  \\\n",
       "MSFT.O  Microsoft Corp, Ordinary Share, NASDAQ Global ...  MSFT.O   \n",
       "AAPL.O  Apple Inc, Ordinary Share, NASDAQ Global Selec...  AAPL.O   \n",
       "GOOG.O  Alphabet Inc, Ordinary Share, Class C, NASDAQ ...  GOOG.O   \n",
       "IBM.N   International Business Machines Corp, Ordinary...   IBM.N   \n",
       "\n",
       "           IssueISIN      CUSIP    SEDOL TickerSymbol IssuerOAPermID  \n",
       "MSFT.O  US5949181045  594918104     <NA>         MSFT     4295907168  \n",
       "AAPL.O  US0378331005  037833100     <NA>         AAPL     4295905573  \n",
       "GOOG.O  US02079K1079  02079K107     <NA>         GOOG     5030853586  \n",
       "IBM.N   US4592001014  459200101  2005973          IBM     4295904307  "
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# # Get generic table of many symbols for 4 companies of choice:\n",
    "response = rd.content.symbol_conversion.Definition(symbols=[\"MSFT.O\", \"AAPL.O\", \"GOOG.O\", \"IBM.N\"]).get_data()\n",
    "response.data.df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "1d110ff6-8cb5-4a99-bfc6-a717473d4267",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>DocumentTitle</th>\n",
       "      <th>RIC</th>\n",
       "      <th>IssuerOAPermID</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>US5949181045</th>\n",
       "      <td>Microsoft Corp, Ordinary Share, NASDAQ Global ...</td>\n",
       "      <td>MSFT.O</td>\n",
       "      <td>4295907168</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>US02079K1079</th>\n",
       "      <td>Alphabet Inc, Ordinary Share, Class C, NASDAQ ...</td>\n",
       "      <td>GOOG.O</td>\n",
       "      <td>5030853586</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                  DocumentTitle     RIC  \\\n",
       "US5949181045  Microsoft Corp, Ordinary Share, NASDAQ Global ...  MSFT.O   \n",
       "US02079K1079  Alphabet Inc, Ordinary Share, Class C, NASDAQ ...  GOOG.O   \n",
       "\n",
       "             IssuerOAPermID  \n",
       "US5949181045     4295907168  \n",
       "US02079K1079     5030853586  "
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# # Convert specific symbols:\n",
    "response = rd.content.symbol_conversion.Definition(\n",
    "    symbols=[\"US5949181045\", \"US02079K1079\"],\n",
    "    from_symbol_type=rd.content.symbol_conversion.SymbolTypes.ISIN, # Symbol types: RIC => RIC; ISIN => IssueISIN; CUSIP => CUSIP; SEDOL => SEDOL; TICKER_SYMBOL => TickerSymbol; OA_PERM_ID => IssuerOAPermID; LIPPER_ID => FundClassLipperID\n",
    "    to_symbol_types=[rd.content.symbol_conversion.SymbolTypes.RIC,\n",
    "                     rd.content.symbol_conversion.SymbolTypes.OA_PERM_ID],\n",
    ").get_data()\n",
    "\n",
    "response.data.df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5ccb34ef-a4ac-4868-8764-30171f158d5b",
   "metadata": {},
   "source": [
    "### DEX2 RData Equity Data\n",
    "\n",
    "As best exemplified in [Tutorial 6 - Data Engine - Dex2](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-6-data-engine-dex-2)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/dex2.zip), the DEX2 RData Equity Data allows us to access historical [Market Capital](https://www.investopedia.com/terms/m/marketcapitalization.asp):\n",
    "\n",
    "<img src=\"imgs/Dex2Equity.PNG\">\n",
    "# take this generic stuff down into appendix and make sure all components are referenced\n",
    "\n",
    "#### VBA\n",
    "\n",
    "DEX2 replicates RData() and TR() functions for real time data retrieval in Eikon for Excel / Eikon - Microsoft Office. The DEX2 methods differ slightly in the initialisation and use of the Dex2Mgr object depending upon whether RData() or the TR() function is being replicated. The examples below explain this. The TR() function can be used to retrieve data from ADC (the Analytics Data Cloud) and this is contained in Tutorial 11 - Dex2 TR function Analytics Data Cloud ADC data here.\n",
    "\n",
    "NOTE - Eikon for Excel or Eikon - Microsoft Office should be logged in otherwise the sample VBA code will generate an error \"ERROR #360c - AdxRtx : No connection to the platform\".\n",
    "\n",
    "##### Prerequisites\n",
    "1. Open a new single sheet Excel workbook. Save As with an appropriate name (e.g. DEX2.xls or DEX2.xlsm in Office 2007 or higher).\n",
    "2. Go to the VBE (Visual Basic Editor), ensure the Project Explorer is visible and select the project for the workbook above. \\<ALT\\>\\<F11\\> or Tools, Macro, Visual Basic Editor in Excel 2003 or  Developer, Visual Basic in Excel 2007 and above, View, Project Explorer If the Developer header is not visible in Excel 2007 and above, go to the Excel Office Button, select Excel Options (lower right), Popular, and check the 'Show Developer tab in the Ribbon' box.\n",
    "3. In the VBE, click on File, Import File and import PLVbaApis.bas. The .bas location is C:\\Program Files (x86)\\Thomson Reuters\\Eikon\\Z\\Bin (Z may be X or Y, depending on the last Eikon update). The .bas is loaded as a new VB project module, PLVbaApis.\n",
    "4. In the PLVbaAPis module, comment out the sections which aren't required. As this example is dealing with DEX2, part of the library DEX2Lib, the DEX2 section can remain uncommented.\n",
    "5. In the VBE, go Tools, References and ensure that the DEX2 Library is checked. If it is not in the list the library is called DEX2.dll and its location for Eikon 4 is;\n",
    "\n",
    "    \"C:\\Program Files (x86)\\Thomson Reuters\\Eikon\\Z\\Bin\" (Z may be X or Y, depending on the last Eikon update).\n",
    "\n",
    "    Note that for the latest versions of Eikon the default path is;\n",
    "\n",
    "    \"C:\\Program Files (x86)\\Thomson Reuters\\Eikon\\Z\\Bin\\Apps\\TR.OFFICE.CORE\\0.0.0.0\\Bin\" (Z may be X or Y, depending on the last Eikon update).\n",
    "\n",
    "##### DEX2\n",
    "\n",
    "6. Create an instance of an DEX2Mgr object using the PLVbaApis function CreateDex2Mgr().\n",
    "\n",
    "    Set myDEX2Mgr = CreateDex2Mgr()\n",
    " \n",
    "7. To replicate RData(), create the Dex2Mgr object (myDex2Mgr) and initialise it. Use the return value from the initialisation to create an instance of the Dex2Lib.RData Class (myDex2RData) using the CreateRData method.\n",
    "\n",
    "8. Now go ahead with `cmdMktCapHist_Click` creation:\n",
    "\n",
    ">    Private Sub cmdMktCapHist_Click()\n",
    ">        On Error GoTo errHandler\n",
    ">        \n",
    ">        ActiveCell.Select\n",
    ">        \n",
    ">        Range(\"F20:G100\").ClearContents\n",
    ">        If MyDex2Mgr Is Nothing Then Set MyDex2Mgr = CreateReutersObject(\"Dex2.Dex2Mgr\")\n",
    ">        \n",
    ">        ' Must call Initialise() at once\n",
    ">        m_cookie = MyDex2Mgr.Initialize()\n",
    ">        ' We can then create an RData object\n",
    ">        Set myRData2 = MyDex2Mgr.CreateRData(m_cookie)\n",
    ">        \n",
    ">        With MyDex2Mgr\n",
    ">            .SetErrorHandling m_cookie, DE_EH_STRING ' Could also use DE_EH_ERROR_CODES\n",
    ">        End With\n",
    ">        \n",
    ">        ' Set the properties & methods for the DEX2Lib.RData object.\n",
    ">        With myRData2\n",
    ">            .InstrumentIDList = [C15].Value\n",
    ">            .FieldList = [C16].Value '\"RII.A.INDEX_MKT_CAP_RTRS\" '\"RII.A.INDEX_MKT_CAP_RTRS; RII.A.INDEX_MKT_CAP_USD_RTRS\"\n",
    ">            ' Could use single \"RI.ID.RIC\", multiple \"RI.ID.RIC; RI.ID.WERT\" or array, e.g. arrFldList.\n",
    ">            .RequestParam = [C17].Value\n",
    ">            .DisplayParam = \"RH:D CH:Fd SORT:DESC\"\n",
    ">            'N.B. Could use .SetParameter \"TRI.N; MSFT.O\",\"RF.G.COMPNAME; RF.G.NUMEMPLOY; RF.G.CNTEMAIL\", _\n",
    ">                \"\", \"RH:In CH:Fd Transpose:Y\"\n",
    ">            'Hence .SetParameter [InstrumentIDList].Value, [FieldList].Value, [RequestParam].Value, [DisplayParam].Value\n",
    ">            \n",
    ">            'Ignore cache; get data directly from the Snapshot Server\n",
    ">            '.Subscribe False\n",
    ">            'Or use cache by default\n",
    ">            .Subscribe\n",
    ">        End With\n",
    ">        Exit Sub\n",
    ">        \n",
    ">    errHandler:\n",
    ">        MsgBox MyDex2Mgr.GetErrorString(Err.Number)\n",
    ">    End Sub\n",
    ">    \n",
    ">    ' OnUpdate event callback for myRData1\n",
    ">    Private Sub myRData2_OnUpdate(ByVal DataStatus As Dex2Lib.DEX2_DataStatus, ByVal Error As Variant)\n",
    ">        Dim C As Integer, r As Integer\n",
    ">        Dim res2 As Variant\n",
    ">        \n",
    ">        If Error <> 0 Then [F21].Value = Error: Exit Sub\n",
    ">    \n",
    ">        res2 = myRData2.Data\n",
    ">        \n",
    ">        If IsEmpty(res2) Then [F21].Value = \"No data\": Exit Sub\n",
    ">        \n",
    ">        ' r for the rows\n",
    ">        For r = LBound(res2, 1) To UBound(res2, 1)\n",
    ">            ' c for the columns\n",
    ">            For C = LBound(res2, 2) To UBound(res2, 2)\n",
    ">                [F21].Offset(r, C).Value = res2(r, C)\n",
    ">            Next C\n",
    ">        Next r\n",
    ">    End Sub"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0d6c83b9-994e-4903-a6a9-5d5163d011d9",
   "metadata": {},
   "source": [
    "#### Python\n",
    "\n",
    "Couldn't be easier in Python:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "97ef906b-7746-4e76-b1a9-e16befbdfe45",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>PEUP.PA</th>\n",
       "      <th>Market Capitalisation</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "Empty DataFrame\n",
       "Columns: [Market Capitalisation]\n",
       "Index: []"
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "MarketCapDf = rd.get_history(\n",
    "    universe=['PEUP.PA'],\n",
    "    fields=['TR.MARKETCAPITALISATION'],\n",
    "    interval=\"1d\", # The consolidation interval. Supported intervals are: tick, tas, taq, minute, 1min, 5min, 10min, 30min, 60min, hourly, 1h, daily, 1d, 1D, 7D, 7d, weekly, 1W, monthly, 1M, quarterly, 3M, 6M, yearly, 1Y.\n",
    "    start=\"2022-08-10\",\n",
    "    end=\"2022-09-13\")\n",
    "MarketCapDf"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0e06520b-1f47-4ef1-9e86-b043224b47d4",
   "metadata": {
    "tags": []
   },
   "source": [
    "### DEX2 Time Series\n",
    "\n",
    "DEX2 returns reference and fundamental data for instruments. Data includes identifiers such as ISIN and Cusip codes for an instrument, market capitalisation history, business sector information, ratings information and time series data. This was best exemplified in [Tutorial 6 - Data Engine - Dex2](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-6-data-engine-dex-2)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/dex2.zip):\n",
    "\n",
    "<img src=\"imgs/DEX2 TR Data.PNG\">\n",
    "\n",
    "#### VBA\n",
    "\n",
    "You'd have to Initialize Dex2 session under the sub `cmdInitialize_Click()`:\n",
    "\n",
    ">    ' Initialize Dex2 session when the data request is first started.\n",
    ">    Private Sub cmdInitialize_Click()\n",
    ">        On Error GoTo ErrorHandle\n",
    ">    \n",
    ">        ActiveCell.Select\n",
    ">    \n",
    ">        ' Clear the output of logger\n",
    ">        lbLog.Clear\n",
    ">    \n",
    ">        ClearAllOutput\n",
    ">    \n",
    ">        ' Clear the Cookie and old query\n",
    ">        If Not MyDex2Cookie = 0 Then\n",
    ">            MyDex2Mgr.Finalize (MyDex2Cookie)\n",
    ">            MyDex2Cookie = 0\n",
    ">            Set MyDex2Mgr = Nothing\n",
    ">            Set MyDex2RData = Nothing\n",
    ">        End If\n",
    ">        \n",
    ">        ' Instantiate the Dex2 manager\n",
    ">        Set MyDex2Mgr = CreateDex2Mgr()\n",
    ">        Set MyDex2MgrADC = MyDex2Mgr\n",
    ">        ' Instantiate the RSearch logger\n",
    ">        Set MyDex2Logger = New CLogger\n",
    ">        \n",
    ">        ' Initialize Dex2 session\n",
    ">        MyDex2Cookie = MyDex2MgrADC.Initialize(DE_MC_ADC_POWERLINK, MyDex2Logger)\n",
    ">            \n",
    ">        ' We can choose to display error code\n",
    ">        MyDex2Mgr.SetErrorHandling MyDex2Cookie, DE_EH_ERROR_CODES\n",
    ">        ' Or display error description\n",
    ">        ' MyDex2Mgr.SetErrorHandling MyDex2Cookie, DE_EH_STRING\n",
    ">            \n",
    ">        ' Create a Dex2 query using the session cookie\n",
    ">        Set MyDex2RData = MyDex2Mgr.CreateRData(MyDex2Cookie)\n",
    ">        \n",
    ">        ' Create a Dex2 query manager using the session cookie\n",
    ">        Set MyDex2RDataMgr = MyDex2Mgr.CreateRDataMgr(MyDex2Cookie)\n",
    ">        \n",
    ">        Exit Sub\n",
    "\n",
    "#### Python\n",
    "\n",
    "In Python, things are a little simpler:\n",
    "\n",
    "# put total return instead market cap rubbish"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "id": "3ec8b33a-a76f-4926-9e91-c49db1b6f70d",
   "metadata": {},
   "outputs": [],
   "source": [
    "DEX2Df = rd.get_history(\n",
    "    universe=['.FCHI', 'BARC.L', 'TRI.N'],\n",
    "    fields=['TR.Index_MKT_CAP_RTRS', 'TR.Close'],\n",
    "    interval=\"1D\",\n",
    "    start=\"2021-10-01\",\n",
    "    end=\"2021-10-11\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "ce46ddd5-791f-4c9a-8ce1-5b662a63472f",
   "metadata": {},
   "outputs": [],
   "source": [
    "pd.set_option('display.max_columns', None)  # This allows us to see all the columsn of the returned data-frame"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "id": "634a53df-9f51-4292-a79f-083ce60a68ba",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th colspan=\"2\" halign=\"left\">.FCHI</th>\n",
       "      <th colspan=\"2\" halign=\"left\">BARC.L</th>\n",
       "      <th colspan=\"2\" halign=\"left\">TRI.N</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>Calculated Index Market Capitalisation</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Calculated Index Market Capitalisation</th>\n",
       "      <th>Price Close</th>\n",
       "      <th>Calculated Index Market Capitalisation</th>\n",
       "      <th>Price Close</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-10-11</th>\n",
       "      <td>2151503955966.97998</td>\n",
       "      <td>6570.54</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>197.68</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>114.37</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-08</th>\n",
       "      <td>2147288455787.27002</td>\n",
       "      <td>6559.99</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>195.16</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>113.9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-07</th>\n",
       "      <td>2163302565808.26001</td>\n",
       "      <td>6600.19</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>193.74</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>113.64</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-06</th>\n",
       "      <td>2125950361258.949951</td>\n",
       "      <td>6493.12</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>191.9</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>111.77</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-05</th>\n",
       "      <td>2152681246974.689941</td>\n",
       "      <td>6576.28</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>194.6</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>110.43</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-04</th>\n",
       "      <td>2121481119196.330078</td>\n",
       "      <td>6477.66</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>187.28</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>109.42</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021-10-01</th>\n",
       "      <td>2135779340507.139893</td>\n",
       "      <td>6517.69</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>187.88</td>\n",
       "      <td>&lt;NA&gt;</td>\n",
       "      <td>110.16</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            .FCHI              \\\n",
       "           Calculated Index Market Capitalisation Price Close   \n",
       "Date                                                            \n",
       "2021-10-11                    2151503955966.97998     6570.54   \n",
       "2021-10-08                    2147288455787.27002     6559.99   \n",
       "2021-10-07                    2163302565808.26001     6600.19   \n",
       "2021-10-06                   2125950361258.949951     6493.12   \n",
       "2021-10-05                   2152681246974.689941     6576.28   \n",
       "2021-10-04                   2121481119196.330078     6477.66   \n",
       "2021-10-01                   2135779340507.139893     6517.69   \n",
       "\n",
       "                                           BARC.L              \\\n",
       "           Calculated Index Market Capitalisation Price Close   \n",
       "Date                                                            \n",
       "2021-10-11                                   <NA>      197.68   \n",
       "2021-10-08                                   <NA>      195.16   \n",
       "2021-10-07                                   <NA>      193.74   \n",
       "2021-10-06                                   <NA>       191.9   \n",
       "2021-10-05                                   <NA>       194.6   \n",
       "2021-10-04                                   <NA>      187.28   \n",
       "2021-10-01                                   <NA>      187.88   \n",
       "\n",
       "                                            TRI.N              \n",
       "           Calculated Index Market Capitalisation Price Close  \n",
       "Date                                                           \n",
       "2021-10-11                                   <NA>      114.37  \n",
       "2021-10-08                                   <NA>       113.9  \n",
       "2021-10-07                                   <NA>      113.64  \n",
       "2021-10-06                                   <NA>      111.77  \n",
       "2021-10-05                                   <NA>      110.43  \n",
       "2021-10-04                                   <NA>      109.42  \n",
       "2021-10-01                                   <NA>      110.16  "
      ]
     },
     "execution_count": 48,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "DEX2Df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b2cbfeba-f5a7-4d29-ae03-589619b65ff1",
   "metadata": {
    "tags": []
   },
   "source": [
    "### DEX2 RData Treasury Data\n",
    "\n",
    "This functionality was best shown in [Tutorial 6 - DEX2 Treasury](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-6-data-engine-dex-2) where Treasury Ratings and their Source Descriptions were discoverable:\n",
    "\n",
    "<img src=\"imgs/DEX2 RData Treasury Data.PNG\">\n",
    "\n",
    "#### VBA\n",
    "\n",
    ">     Private Sub cmdClearAll_Click()\n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         Range(\"G10\").Value = \"\"\n",
    ">         Range(\"G21:J100\").Value = \"\"\n",
    ">         \n",
    ">         If Not myRData1 Is Nothing Then Set myRData1 = Nothing\n",
    ">         If Not myRData2 Is Nothing Then Set myRData2 = Nothing\n",
    ">         If Not MyDex2Mgr Is Nothing Then Set MyDex2Mgr = Nothing\n",
    ">     End Sub\n",
    ">     \n",
    ">     Private Sub cmdGetRating_Click()\n",
    ">         On Error GoTo errHandler\n",
    ">         \n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         [G7].Value = \"\"\n",
    ">         ' Note the use of CreateReutersObject - function in the PLVbaApis module.\n",
    ">         If MyDex2Mgr Is Nothing Then Set MyDex2Mgr = CreateReutersObject(\"Dex2.Dex2Mgr\")\n",
    ">         \n",
    ">         ' Must call Initialise() at once\n",
    ">         m_cookie = MyDex2Mgr.Initialize()\n",
    ">         ' We can then create an RData object\n",
    ">         Set myRData1 = MyDex2Mgr.CreateRData(m_cookie)\n",
    ">         \n",
    ">         With MyDex2Mgr\n",
    ">             .SetErrorHandling m_cookie, DE_EH_STRING ' Could also use DE_EH_ERROR_CODES\n",
    ">         End With\n",
    ">         \n",
    ">         ' Set the properties & methods for the DEX2Lib.RData object\n",
    ">         With myRData1\n",
    ">             .InstrumentIdList = [C6].Value ' Could use \"TRI.N\", \"TRI.N; GOOG.O; MSFT.O\" or array, e.g. arrInstrList.\n",
    ">             .FieldList = [C7].Value '\"EJV.GR.Rating\" ' Could use \"RI.ID.RIC\", \"RI.ID.RIC; RI.ID.WERT\" or array, e.g. arrFldList.\n",
    ">             .RequestParam = [C8].Value '\"RTSRC:S&P\"\n",
    ">             'N.B. Could use .SetParameter \"TRI.N; MSFT.O\",\"RF.G.COMPNAME; RF.G.NUMEMPLOY; RF.G.CNTEMAIL\", _\n",
    ">                 \"\", \"RH:In CH:Fd Transpose:Y\"\n",
    ">             'Hence .SetParameter [InstrumentIDList].Value, [FieldList].Value, [RequestParam].Value, [DisplayParam].Value\n",
    ">             \n",
    ">             'Ignore cache; get data directly from the Snapshot Server\n",
    ">             '.Subscribe False\n",
    ">             'Or use cache by default\n",
    ">             .Subscribe\n",
    ">         End With\n",
    ">         Exit Sub\n",
    ">         \n",
    ">     errHandler:\n",
    ">         MsgBox MyDex2Mgr.GetErrorString(Err.Number)\n",
    ">     End Sub\n",
    ">     \n",
    ">     ' OnUpdate event callback for myRData1\n",
    ">     Private Sub myRData1_OnUpdate(ByVal DataStatus As Dex2Lib.DEX2_DataStatus, ByVal Error As Variant)\n",
    ">         Dim res As Variant\n",
    ">     \n",
    ">         'Debug.Print DataStatus\n",
    ">     \n",
    ">         If Error <> 0 Then [G10].Value = Error: Exit Sub\n",
    ">     \n",
    ">         ' get the data retrieved from the database\n",
    ">         res = myRData1.Data\n",
    ">     \n",
    ">         ' Display the result.\n",
    ">         [G10].Value = res\n",
    ">     End Sub\n",
    ">     \n",
    ">     Private Sub cmdGetHistoryOfRating_Click()\n",
    ">         On Error GoTo errHandler\n",
    ">         \n",
    ">         ActiveCell.Select\n",
    ">         \n",
    ">         Range(\"G21:J100\").ClearContents\n",
    ">         If MyDex2Mgr Is Nothing Then Set MyDex2Mgr = CreateReutersObject(\"Dex2.Dex2Mgr\")\n",
    ">         \n",
    ">         ' Must call Initialise() at once\n",
    ">         m_cookie = MyDex2Mgr.Initialize()\n",
    ">         ' We can then create an RData object\n",
    ">         Set myRData2 = MyDex2Mgr.CreateRData(m_cookie)\n",
    ">         \n",
    ">         With MyDex2Mgr\n",
    ">             .SetErrorHandling m_cookie, DE_EH_STRING ' Could also use DE_EH_ERROR_CODES\n",
    ">         End With\n",
    ">         \n",
    ">         ' Set the properties & methods for the DEX2Lib.RData object\n",
    ">         With myRData2\n",
    ">             .InstrumentIdList = [C15].Value\n",
    ">             .FieldList = [C16].Value\n",
    ">             .RequestParam = [C17].Value\n",
    ">             .DisplayParam = [C18].Value\n",
    ">             \n",
    ">             'N.B. Could use .SetParameter \"TRI.N; MSFT.O\",\"RF.G.COMPNAME; RF.G.NUMEMPLOY; RF.G.CNTEMAIL\", _\n",
    ">                 \"\", \"RH:In CH:Fd Transpose:Y\"\n",
    ">             'Hence .SetParameter [InstrumentIDList].Value, [FieldList].Value, [RequestParam].Value, [DisplayParam].Value\n",
    ">             \n",
    ">             'Ignore cache; get data directly from the Snapshot Server\n",
    ">             '.Subscribe False\n",
    ">             'Or use cache by default\n",
    ">             .Subscribe\n",
    ">         End With\n",
    ">         Exit Sub\n",
    ">         \n",
    ">     errHandler:\n",
    ">         MsgBox MyDex2Mgr.GetErrorString(Err.Number)\n",
    ">     End Sub\n",
    "\n",
    "\n",
    "#### Python\n",
    "\n",
    "Things are much simpler in Python:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "id": "a95e69d1-459e-4150-aabc-e47f6ae827cb",
   "metadata": {},
   "outputs": [],
   "source": [
    "DEX2TrDf = rd.get_data(\n",
    "    ['BARC.L', 'TRI.N', 'GB047986974='],  # PSKc1, '92857WAZ3=1M'\n",
    "    fields=[\n",
    "        'TR.IR.RatingSourceDescription', 'TR.IR.RatingSourceType', 'TR.IR.Rating',\n",
    "        'TR.TRBCEconomicSector', 'TR.TRBCEconSectorCode', 'TR.TRBCBusinessSector',\n",
    "        'TR.TRBCBusinessSectorCode', 'TR.TRBCIndustryGroup', 'TR.TRBCIndustryGroupCode',\n",
    "        'TR.TRBCIndustry', 'TR.TRBCIndustryCode', 'TR.IR.RatingSourceDescription.date'],\n",
    "    parameters={'SDate': 0, 'EDate': -3, 'FRQ': 'FY'})  # This will look for a data-point every Fianancial Year for the past 3 Financial Years"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "id": "582bc220-6df8-4b45-9599-6f44e9658dd0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Instrument</th>\n",
       "      <th>Rating Source Description</th>\n",
       "      <th>Rating Source Type</th>\n",
       "      <th>Issuer Rating</th>\n",
       "      <th>TRBC Economic Sector Name</th>\n",
       "      <th>TRBC Economic Sector Code</th>\n",
       "      <th>TRBC Business Sector Name</th>\n",
       "      <th>TRBC Business Sector Code</th>\n",
       "      <th>TRBC Industry Group Name</th>\n",
       "      <th>TRBC Industry Group Code</th>\n",
       "      <th>TRBC Industry Name</th>\n",
       "      <th>TRBC Industry Code</th>\n",
       "      <th>Date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2021-11-26</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2020-11-18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2019-11-27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>BARC.L</td>\n",
       "      <td>R&amp;I Long-term Issuer Rating</td>\n",
       "      <td>RII</td>\n",
       "      <td>A-</td>\n",
       "      <td>Financials</td>\n",
       "      <td>55</td>\n",
       "      <td>Banking &amp; Investment Services</td>\n",
       "      <td>5510</td>\n",
       "      <td>Banking Services</td>\n",
       "      <td>551010</td>\n",
       "      <td>Banks</td>\n",
       "      <td>55101010</td>\n",
       "      <td>2019-11-27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>GB047986974=</td>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>F2</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "      <td>2021-07-29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>GB047986974=</td>\n",
       "      <td>Fitch Commercial Paper</td>\n",
       "      <td>FCP</td>\n",
       "      <td>F2</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "      <td>2021-07-29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>GB047986974=</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "      <td>2019-11-26</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>GB047986974=</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Technology</td>\n",
       "      <td>57</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>5740</td>\n",
       "      <td>Telecommunications Services</td>\n",
       "      <td>574010</td>\n",
       "      <td>Wireless Telecommunications Services</td>\n",
       "      <td>57401020</td>\n",
       "      <td>2019-11-26</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>NaT</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Moody's Senior Unsecured</td>\n",
       "      <td>MSU</td>\n",
       "      <td>Baa2</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2020-05-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2019-12-02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>TRI.N</td>\n",
       "      <td>Egan-Jones Senior Unsecured</td>\n",
       "      <td>EJU</td>\n",
       "      <td>BBB-</td>\n",
       "      <td>Industrials</td>\n",
       "      <td>52</td>\n",
       "      <td>Industrial &amp; Commercial Services</td>\n",
       "      <td>5220</td>\n",
       "      <td>Professional &amp; Commercial Services</td>\n",
       "      <td>522030</td>\n",
       "      <td>Professional Information Services</td>\n",
       "      <td>52203070</td>\n",
       "      <td>2019-12-02</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      Instrument    Rating Source Description Rating Source Type  \\\n",
       "0         BARC.L  R&I Long-term Issuer Rating                RII   \n",
       "1         BARC.L  R&I Long-term Issuer Rating                RII   \n",
       "2         BARC.L  R&I Long-term Issuer Rating                RII   \n",
       "3         BARC.L  R&I Long-term Issuer Rating                RII   \n",
       "8   GB047986974=       Fitch Commercial Paper                FCP   \n",
       "9   GB047986974=       Fitch Commercial Paper                FCP   \n",
       "10  GB047986974=  Egan-Jones Senior Unsecured                EJU   \n",
       "11  GB047986974=  Egan-Jones Senior Unsecured                EJU   \n",
       "4          TRI.N                          NaN                NaN   \n",
       "5          TRI.N     Moody's Senior Unsecured                MSU   \n",
       "6          TRI.N  Egan-Jones Senior Unsecured                EJU   \n",
       "7          TRI.N  Egan-Jones Senior Unsecured                EJU   \n",
       "\n",
       "   Issuer Rating TRBC Economic Sector Name TRBC Economic Sector Code  \\\n",
       "0              A                Financials                        55   \n",
       "1             A-                Financials                        55   \n",
       "2             A-                Financials                        55   \n",
       "3             A-                Financials                        55   \n",
       "8             F2                Technology                        57   \n",
       "9             F2                Technology                        57   \n",
       "10          BBB-                Technology                        57   \n",
       "11          BBB-                Technology                        57   \n",
       "4            NaN               Industrials                        52   \n",
       "5           Baa2               Industrials                        52   \n",
       "6           BBB-               Industrials                        52   \n",
       "7           BBB-               Industrials                        52   \n",
       "\n",
       "           TRBC Business Sector Name TRBC Business Sector Code  \\\n",
       "0      Banking & Investment Services                      5510   \n",
       "1      Banking & Investment Services                      5510   \n",
       "2      Banking & Investment Services                      5510   \n",
       "3      Banking & Investment Services                      5510   \n",
       "8        Telecommunications Services                      5740   \n",
       "9        Telecommunications Services                      5740   \n",
       "10       Telecommunications Services                      5740   \n",
       "11       Telecommunications Services                      5740   \n",
       "4   Industrial & Commercial Services                      5220   \n",
       "5   Industrial & Commercial Services                      5220   \n",
       "6   Industrial & Commercial Services                      5220   \n",
       "7   Industrial & Commercial Services                      5220   \n",
       "\n",
       "              TRBC Industry Group Name TRBC Industry Group Code  \\\n",
       "0                     Banking Services                   551010   \n",
       "1                     Banking Services                   551010   \n",
       "2                     Banking Services                   551010   \n",
       "3                     Banking Services                   551010   \n",
       "8          Telecommunications Services                   574010   \n",
       "9          Telecommunications Services                   574010   \n",
       "10         Telecommunications Services                   574010   \n",
       "11         Telecommunications Services                   574010   \n",
       "4   Professional & Commercial Services                   522030   \n",
       "5   Professional & Commercial Services                   522030   \n",
       "6   Professional & Commercial Services                   522030   \n",
       "7   Professional & Commercial Services                   522030   \n",
       "\n",
       "                      TRBC Industry Name TRBC Industry Code       Date  \n",
       "0                                  Banks           55101010 2021-11-26  \n",
       "1                                  Banks           55101010 2020-11-18  \n",
       "2                                  Banks           55101010 2019-11-27  \n",
       "3                                  Banks           55101010 2019-11-27  \n",
       "8   Wireless Telecommunications Services           57401020 2021-07-29  \n",
       "9   Wireless Telecommunications Services           57401020 2021-07-29  \n",
       "10  Wireless Telecommunications Services           57401020 2019-11-26  \n",
       "11  Wireless Telecommunications Services           57401020 2019-11-26  \n",
       "4      Professional Information Services           52203070        NaT  \n",
       "5      Professional Information Services           52203070 2020-05-11  \n",
       "6      Professional Information Services           52203070 2019-12-02  \n",
       "7      Professional Information Services           52203070 2019-12-02  "
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# The below in this cell is needed to forward fill our dataframe correctly:\n",
    "DEX2TrDf.replace({'': np.nan}, inplace=True)\n",
    "DEX2TrDf.where(pd.notnull(DEX2TrDf), np.nan, inplace=True)\n",
    "\n",
    "for i in DEX2TrDf.groupby(by=[\"Instrument\"]):\n",
    "    if i[0] == DEX2TrDf[\"Instrument\"][0]: _DEX2TrDf = i[1].ffill()\n",
    "    else: _DEX2TrDf = _DEX2TrDf.append(i[1].ffill())\n",
    "_DEX2TrDf"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "20b51d18-6add-4989-a4ef-c422b22e7f8a",
   "metadata": {
    "jp-MarkdownHeadingCollapsed": true,
    "tags": []
   },
   "source": [
    "### DEX2 Fundamental and Reference\n",
    "\n",
    "<img src=\"imgs/Dex2 RData Fundamental Data.PNG\">\n",
    "\n",
    "Time Series data as the name suggests changes with time. Reference data, on the other hand, does not primarily change with time; when it does, it usually accounts for a structural change in the instrument at play (e.g.: a company changes from banking to tech operation industries or is acquired and changes name etc). Fundamental data is released temporally say quarterly or half-yearly or annually and is usually looked at across time eg Revenue or Sales. DEX2 provides access to all of our TR fields - which allow you to specify begin dates and end dates amongst other parameters. Access to these is unchanged in our new APIs - only its a lot simpler.\n",
    "\n",
    "#### VBA\n",
    "\n",
    "In VBA, after creating '`Private MyDex2Mgr As Dex2Lib.Dex2Mgr`':\n",
    "\n",
    ">     Private MyDex2Mgr As Dex2Lib.Dex2Mgr\n",
    ">     Private MyDex2MgrADC As Dex2Lib.IDex2Mgr2\n",
    ">     Private MyDex2Cookie As Long\n",
    ">     ' Private variable that holds the Dex2 RData, able to obtain TR fields.\n",
    ">     Private WithEvents MyDex2RData As Dex2Lib.RData\n",
    "\n",
    "to complete the Tutorial 6 example, one could go through the following to collect DEX2 Fundamental and Reference data:\n",
    "\n",
    ">         ' Now create the Dex2 and IDex2 objects.\n",
    ">         Set MyDex2Mgr = CreateDex2Mgr()\n",
    ">         Set MyDex2MgrADC = MyDex2Mgr\n",
    ">         \n",
    ">         ' Initialise using the DE_MC_ADC_POWERLINK enumeration\n",
    ">         MyDex2Cookie = MyDex2MgrADC.Initialize(DE_MC_ADC_POWERLINK)\n",
    ">         ' And create an RData object.\n",
    ">         Set MyDex2RData = MyDex2Mgr.CreateRData(MyDex2Cookie)\n",
    ">         \n",
    ">         With MyDex2RData\n",
    ">             .InstrumentIDList = Range(\"G6\").Value ' Or for multiple isntruments \"TRI.N;MSFT.O;GOOG.O\"\n",
    ">             .FieldList = strInstrList '  Or single field \"TR.CLOSE\"\n",
    ">             .RequestParam = \"\" ' Or of the form \"edate:-20d sdate:-9d\"\n",
    ">             .DisplayParam = \"CH:Fd\" ' Or of the form \"RH:In CH:Fd\"\n",
    ">             \n",
    ">             '' OR can use .SetParameter\n",
    ">             '.SetParameter Range(\"G6\").Value, strInstrList, \"\", \"CH:Fd\"\n",
    ">             \n",
    ">             ' Send the query without using cache\n",
    ">             .Subscribe False  ' Or use cache by default - myDex2RData.Subscribe\n",
    ">             \n",
    ">             ' When the data is returned, the myDex2RData_OnUpdate event and Sub are 'fired'.\n",
    "\n",
    "#### Python\n",
    "\n",
    "Fundamental data was covered above under 'RData Fundamentals'; such data can be found in Python with [RD](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python) (and `rd.get_data`, `rd.get_history` or `rd.content.fundamental_and_reference.Definition`) or [EDAPI](https://developers.refinitiv.com/en/api-catalog/eikon/eikon-data-api).\n",
    "\n",
    "#### Fundamental and Reference Timeseries\n",
    "\n",
    "##### VBA\n",
    "\n",
    "DEX2 Fundamental and Reference Timeseries data could be fetched similarly to simple time series data:\n",
    "\n",
    "Start with \n",
    "\n",
    ">     ' Private Variable that holds the instance of the Dex2 manager singleton\n",
    ">     Private MyDex2Mgr As Dex2Lib.Dex2Mgr\n",
    ">     Private MyDex2MgrADC As Dex2Lib.IDex2Mgr2\n",
    ">     \n",
    ">     ' Private variable that holds the cookie that identifies the Dex2 session\n",
    ">     Private MyDex2Cookie As Long\n",
    ">     ' Private variable that holds the Dex2 RData\n",
    ">     Private WithEvents MyDex2RData As Dex2Lib.RData\n",
    ">     ' Private variable that holds the Dex2 RDataMgr\n",
    ">     Private MyDex2RDataMgr As Dex2Lib.RDataMgr\n",
    ">     \n",
    ">     ' Private variable that holds the Dex2 logger\n",
    ">     Private MyDex2Logger As CLogger\n",
    "\n",
    "Then initialise clicks:\n",
    "\n",
    ">         ' Instantiate the Dex2 manager\n",
    ">         Set MyDex2Mgr = CreateDex2Mgr()\n",
    ">         Set MyDex2MgrADC = MyDex2Mgr\n",
    ">         ' Instantiate the RSearch logger\n",
    ">         Set MyDex2Logger = New CLogger\n",
    ">         \n",
    ">         ' Initialize Dex2 session\n",
    ">         MyDex2Cookie = MyDex2MgrADC.Initialize(DE_MC_ADC_POWERLINK, MyDex2Logger)\n",
    ">             \n",
    ">         ' We can choose to display error code\n",
    ">         MyDex2Mgr.SetErrorHandling MyDex2Cookie, DE_EH_ERROR_CODES\n",
    ">         ' Or display error description\n",
    ">         ' MyDex2Mgr.SetErrorHandling MyDex2Cookie, DE_EH_STRING\n",
    ">             \n",
    ">         ' Create a Dex2 query using the session cookie\n",
    ">         Set MyDex2RData = MyDex2Mgr.CreateRData(MyDex2Cookie)\n",
    ">         \n",
    ">         ' Create a Dex2 query manager using the session cookie\n",
    ">         Set MyDex2RDataMgr = MyDex2Mgr.CreateRDataMgr(MyDex2Cookie)\n",
    "   \n",
    "Then, after some error & event handling:\n",
    "\n",
    ">         ' Set input values\n",
    ">                 MyDex2RData.SetParameter _\n",
    ">                     Range(\"Dex2Item\").Value, _\n",
    ">                     Range(\"Dex2Fields\").Value, _\n",
    ">                     Range(\"Dex2RequestParameters\").Value, _\n",
    ">                     Range(\"Dex2DisplayParameters\").Value\n",
    ">                     ' Or using the following individual properties\n",
    ">                     ' MyDex2RData.InstrumentIDList = Range(\"Dex2Item\").Value\n",
    ">                     ' MyDex2RData.FieldList = Range(\"Dex2Fields\").Value\n",
    ">                     ' MyDex2RData.requestParam = Range(\"Dex2RequestParameters\").Value\n",
    ">                     ' MyDex2RData.displayParam = Range(\"Dex2DisplayParameters\").Value\n",
    ">     \n",
    ">                 ' Send the query without using cache\n",
    ">                 MyDex2RData.Subscribe (False)\n",
    ">                 ' Or use cache by default\n",
    ">                 ' MyDex2RData.Subscribe\n",
    "\n",
    "Before creating 'OnUpdate' code.\n",
    "\n",
    "This is all quite heavy in VBA, while it could hardly be simpler in Python:\n",
    "\n",
    "\n",
    "##### Python\n",
    "\n",
    "This was covered above, in the section 'RData Fundamentals' using [RD](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python)'s `rd.get_history` function."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c44ab7a7-e55b-4373-a415-650fe088622a",
   "metadata": {
    "tags": []
   },
   "source": [
    "## RSearch\n",
    "\n",
    "RSearch is a COM API function for instrument level search - designed for building instrument lists conforming to various search criteria. See the example below:\n",
    "\n",
    "\n",
    "<img src=\"imgs/RSearch.PNG\">\n",
    "\n",
    "[RSearch is a powerful COM API function](https://my.refinitiv.com/content/mytr/en/policies/training-portal/videoarticle.v11535.html). It was best exemplified in [Tutorial 7 - Instrument Search - RSearch\n",
    "](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office/tutorials#tutorial-7-instrument-search-r-search)'s [Excel Workbook](https://developers.refinitiv.com/content/dam/devportal/api-families/eikon/com-apis-for-use-in-microsoft-office/tutorials/rsearch.zip).\n",
    "\n",
    "### VBA\n",
    "\n",
    "Creating the sub `cmdRSearch_Click`:\n",
    "\n",
    ">         ' Instantiate the RSearch manager\n",
    ">         Set myRSrchMgr = CreateRSearchMgr()\n",
    ">         \n",
    ">         If Not myRSrchMgr Is Nothing Then\n",
    ">             ' Initialize RSearch session (we do not provide any logger here)\n",
    ">             ' NOTE - This will error if Eikon for Excel is not logged in.\n",
    ">             myRSrchCookie = myRSrchMgr.Initialize(RS_CT_EIKON)\n",
    ">             ' Create a RSearch query using the session cookie\n",
    ">             Set myRSrchQry = myRSrchMgr.CreateRSearchQuery(myRSrchCookie)\n",
    ">             \n",
    ">             If Not myRSrchMgr Is Nothing Then\n",
    ">                 With myRSrchQry\n",
    ">                     'Initialize the RSearch query with the criteria to use for the search\n",
    ">                     .AssetClass = [AssetClass].Value\n",
    ">                     .SearchCriteria = [SearchCriteria].Value '\"EPS:>5 RCSIssuerCountryLeaf:Canada\"\n",
    ">                     .SearchParameters = [SearchParameters].Value '\"NBROWS:50 SORT:EPS:A\"\n",
    ">                     \n",
    ">                     ' Send the query\n",
    ">                     .Send\n",
    ">                 End With\n",
    ">             End If\n",
    ">         End If\n",
    "\n",
    "Then you can check the status of the query with '`myRSrchQry_OnUpdate`'.\n",
    "\n",
    "### Python\n",
    "\n",
    "[RSearch is a powerful COM API function](https://my.refinitiv.com/content/mytr/en/policies/training-portal/videoarticle.v11535.html), and we're happy to announce that the Python equivalent - Search API - is even more powerful. For the full works on it, please do read Nick Zicone's article '[Building Search into your Application Workflow](https://developers.refinitiv.com/en/article-catalog/article/building-search-into-your-application-workflow)'.\n",
    "\n",
    "\n",
    "The code below is a simple example of how one may use the Search API in Python. It requests M&A data using the filters specified above and orders the data by the announcement date in descending order. More on how you can use search, including guidance, examples, and tips to determine the possible approaches, from simple discovery through experimentation to more advanced techniques, are presented in [this article](https://developers.refinitiv.com/en/article-catalog/article/building-search-into-your-application-workflow)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "id": "448e28f8-18c5-484c-9d8a-af76f88af6ce",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "from refinitiv.data.content import search"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "id": "7d427344-4fcd-4500-a987-ef1d465e3daa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CommonName</th>\n",
       "      <th>IssuerCommonName</th>\n",
       "      <th>IssueCouponRate</th>\n",
       "      <th>Currency</th>\n",
       "      <th>IssuerCountryName</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TTN    2.375 11/16/24 '24</td>\n",
       "      <td>Titan Global Finance PLC</td>\n",
       "      <td>2.375</td>\n",
       "      <td>EUR</td>\n",
       "      <td>United Kingdom</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ACB    2.500 02/05/23</td>\n",
       "      <td>Alpha Bank SA</td>\n",
       "      <td>2.5</td>\n",
       "      <td>EUR</td>\n",
       "      <td>Greece</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>BNP    4.000 10/21/23</td>\n",
       "      <td>Banca Nazionale del Lavoro SpA</td>\n",
       "      <td>4.0</td>\n",
       "      <td>EUR</td>\n",
       "      <td>Italy</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  CommonName                IssuerCommonName  IssueCouponRate  \\\n",
       "0  TTN    2.375 11/16/24 '24        Titan Global Finance PLC            2.375   \n",
       "1      ACB    2.500 02/05/23                   Alpha Bank SA              2.5   \n",
       "2      BNP    4.000 10/21/23  Banca Nazionale del Lavoro SpA              4.0   \n",
       "\n",
       "  Currency IssuerCountryName  \n",
       "0      EUR    United Kingdom  \n",
       "1      EUR            Greece  \n",
       "2      EUR             Italy  "
      ]
     },
     "execution_count": 52,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bondsSerarch = search.Definition(\n",
    "    view=search.Views.BOND_FUT_OPT_QUOTES,  # for info on `SearchViews`, you can use `help(search.Views)`\n",
    "    # specify filtering properties\n",
    "    filter=\"IssueCouponRate ge 2\",\n",
    "    # select only the required fields\n",
    "    select='CommonName, IssuerCommonName, IssueCouponRate, Currency, IssuerCountryName',\n",
    "    # then specify number of items to be 10000, which is the max; default value is 100\n",
    "    top=10000\n",
    ").get_data().data.df\n",
    "\n",
    "bondsSerarch.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "82c0dc8a-6dca-4bf3-9e53-197c133d4f5b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CommonName</th>\n",
       "      <th>PriceCloseUsd</th>\n",
       "      <th>MktCapCompanyUsd</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>APPLE ORD</td>\n",
       "      <td>145.03</td>\n",
       "      <td>2307154353540</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>MICROSOFT ORD</td>\n",
       "      <td>220.1</td>\n",
       "      <td>1640729538994</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ALPHABET CL A ORD</td>\n",
       "      <td>86.97</td>\n",
       "      <td>1126261309999</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>SAUDI ARABIAN OIL ORD</td>\n",
       "      <td>9.155023</td>\n",
       "      <td>2014105123087</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>ALPHABET CL C ORD</td>\n",
       "      <td>87.07</td>\n",
       "      <td>1126261309999</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              CommonName  PriceCloseUsd  MktCapCompanyUsd\n",
       "0              APPLE ORD         145.03     2307154353540\n",
       "1          MICROSOFT ORD          220.1     1640729538994\n",
       "2      ALPHABET CL A ORD          86.97     1126261309999\n",
       "3  SAUDI ARABIAN OIL ORD       9.155023     2014105123087\n",
       "4      ALPHABET CL C ORD          87.07     1126261309999"
      ]
     },
     "execution_count": 53,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "equitySerarch = search.Definition(\n",
    "    view=search.Views.EQUITY_QUOTES,  # for info on `SearchViews`, you can use `help(search.Views)`\n",
    "    filter=\"MktCapCompanyUsd ge 1000000000000\",\n",
    "    # select only the required fields\n",
    "    select='CommonName, PriceCloseUsd, MktCapCompanyUsd',\n",
    "    # then specify number of items to be 10000, which is the max; default value is 100\n",
    "    top=100\n",
    ").get_data().data.df\n",
    "\n",
    "equitySerarch.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "edd60a46-6776-4891-ab09-012fd05ffd68",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of M&A deals for the specified period is 324\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>TransactionAnnouncementDate</th>\n",
       "      <th>TargetCompanyName</th>\n",
       "      <th>TargetRIC</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2021-11-15</td>\n",
       "      <td>CyrusOne Inc</td>\n",
       "      <td>[CONE.O^C22]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2021-11-15</td>\n",
       "      <td>CoreSite Realty Corp</td>\n",
       "      <td>[COR^L21]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2021-11-15</td>\n",
       "      <td>LAACO Ltd</td>\n",
       "      <td>[LAACZ.PK^L21]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2021-11-15</td>\n",
       "      <td>Casper Sleep Inc</td>\n",
       "      <td>[CSPR.K^A22]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2021-11-08</td>\n",
       "      <td>McAfee Corp</td>\n",
       "      <td>[MCFE.O^C22]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  TransactionAnnouncementDate     TargetCompanyName       TargetRIC\n",
       "0                  2021-11-15          CyrusOne Inc    [CONE.O^C22]\n",
       "1                  2021-11-15  CoreSite Realty Corp       [COR^L21]\n",
       "2                  2021-11-15             LAACO Ltd  [LAACZ.PK^L21]\n",
       "3                  2021-11-15      Casper Sleep Inc    [CSPR.K^A22]\n",
       "4                  2021-11-08           McAfee Corp    [MCFE.O^C22]"
      ]
     },
     "execution_count": 54,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "MnA = search.Definition(\n",
    "    view=search.Views.DEALS_MERGERS_AND_ACQUISITIONS,  # for info on `SearchViews`, you can use `help(search.Views)`\n",
    "\n",
    "    # specify filtering properties\n",
    "    filter=\"((AcquirerCompanyName ne 'Creditors' and AcquirerCompanyName ne 'Shareholder') and (TargetCountry eq 'US' or TargetCountry eq 'UK')\"\n",
    "    + \"and TransactionValueIncludingNetDebtOfTarget ge 100 and TargetPublicStatus eq 'Public')\"\n",
    "    + \"and (TransactionStatus eq 'Completed' or TransactionStatus eq 'Pending' or TransactionStatus eq 'Withdrawn')\"\n",
    "    + \"and (FormOfTransactionName xeq 'Merger' or FormOfTransactionName xeq 'Acquisition') and (TransactionAnnouncementDate le 2021-11-15 and TransactionAnnouncementDate ge 2020-09-15)\",\n",
    "\n",
    "    # select only the required fields and order them based on announcement date\n",
    "    # then specify number of items to be 10000, which is the max; default value is 100\n",
    "    select='TransactionAnnouncementDate, TargetCompanyName, TargetRIC',\n",
    "    order_by='TransactionAnnouncementDate desc',\n",
    "    top=10000\n",
    ").get_data()\n",
    "MnA = MnA.data.df\n",
    "\n",
    "#remove companies which doesn't have RIC\n",
    "MnA = MnA.dropna(subset = ['TargetRIC']).reset_index(drop = True)\n",
    "\n",
    "print(f'Number of M&A deals for the specified period is {len(MnA)}')\n",
    "MnA.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fc8c3949-f2a8-4f08-8f9d-c2bd5634f015",
   "metadata": {},
   "source": [
    "A more complex method may be to create a function that incorporates that search function, outputing an excel file. [This](https://gist.github.com/johnukfr/241c2b360a30f96371f430005c8d7738) is a real-life use case replicating RSearch functionality's in looking for Government and Corporate Debt Instruments; the function is rather large, so we put it online for you to access."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b04f5391-b807-4c43-9418-97ef8aed8658",
   "metadata": {
    "tags": []
   },
   "source": [
    "## News\n",
    "\n",
    "### Streaming News\n",
    "\n",
    "### <span style=\"color:blue\">Was there a tutorial for this?</span>\n",
    "\n",
    "The Office COM API allowed for streaming real time news. This was rather inconvenient because one would have to (i) record news flowing through on their own environment, (ii) be recording with an open streaming session when the news they're looking for is published, (iii) deal with the memory management involved with such streaming data. The Python code below recreated this, but takes a snapshot at the time the code is run:\n",
    "\n",
    "(N.B: The Accessing News data with the RD or EDAPI Python libraries will only allow you access to news data up to three months ago. For news data predating that, look into [this article](https://developers.refinitiv.com/en/article-catalog/article/news-sentiments---gleaning-insights).)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "id": "b548d90f-1cb5-400d-bfb5-eb86505ed168",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Define functions ro be used later:\n",
    "def display_data(data, instrument, stream):\n",
    "    clear_output(wait=True)\n",
    "    current_time = datetime.datetime.now().time()\n",
    "    print(current_time, \"- Data received for\", instrument)\n",
    "    display(data)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dramatic-advertising",
   "metadata": {},
   "source": [
    "# Change to NFCP_UBMS"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "id": "304b4b28-f02b-4a7e-8d4d-0cb7a40886a5",
   "metadata": {
    "tags": []
   },
   "outputs": [],
   "source": [
    "# This will trigger the stream:\n",
    "stream = rd.open_pricing_stream(\n",
    "    universe=['N2_UBMS'], # N2_NFCP, NFCP_UBMS\n",
    "    on_data=display_data)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f3308e89-448c-465a-87dc-3f2f888b2ad7",
   "metadata": {},
   "source": [
    "You could recreate the streeming news too:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "id": "fc9c064e-0694-4689-8d30-12b943f71a88",
   "metadata": {},
   "outputs": [],
   "source": [
    "def display_news_headline(streaming_prices, instrument_name, fields):\n",
    "    clear_output(wait=True)\n",
    "    print(fields['HEADLINE1'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "0c8513a4-4871-4815-bad9-83d47acdeaaf",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<refinitiv.data.content.pricing.Stream object at 0x28da9e68 {name='['NFCP_UBMS']'}>"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream = rd.content.pricing.Definition(universe=['NFCP_UBMS']).get_stream()\n",
    "stream.on_update(display_news_headline)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "bed441a2-9ecd-4c88-91ea-5145c7f54f68",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<OpenState.Opened: 'Opened'>"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.open()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "f07d3504-95e3-4f0e-88ee-fff101224761",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<OpenState.Closed: 'Closed'>"
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stream.close()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b3ed71c1-b1e6-4575-ae25-82352c240970",
   "metadata": {
    "tags": []
   },
   "source": [
    "#### NEW FUNCTIONALITY: Get News headlines\n",
    "\n",
    "We added this functionality to find the headlines of news which was not a functionality in the old COM API:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "id": "a4e05c3a-c92c-45a1-9f9c-3c9054fbc9f4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>versionCreated</th>\n",
       "      <th>text</th>\n",
       "      <th>storyId</th>\n",
       "      <th>sourceCode</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2022-03-24 18:27:20.000</th>\n",
       "      <td>2022-03-24T18:27:20.000Z</td>\n",
       "      <td>BRIEF-London Stock Exchange Secondary ABO Book...</td>\n",
       "      <td>urn:newsml:reuters.com:20220324:nFWN2VR122:1</td>\n",
       "      <td>NS:RTRS</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-24 18:09:06.000</th>\n",
       "      <td>2022-03-24T18:09:06.000Z</td>\n",
       "      <td>BRIEF-London Stock Exchange Secondary ABO Book...</td>\n",
       "      <td>urn:newsml:reuters.com:20220324:nFWN2VR17K:1</td>\n",
       "      <td>NS:RTRS</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-24 17:56:19.357</th>\n",
       "      <td>2022-03-24T17:56:21.654Z</td>\n",
       "      <td>BLOCKTRADE:  LONDON STOCK EXCHANGE SECONDARY A...</td>\n",
       "      <td>urn:newsml:reuters.com:20220324:nFWN2VR17K:2</td>\n",
       "      <td>NS:RTRS</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                   versionCreated  \\\n",
       "2022-03-24 18:27:20.000  2022-03-24T18:27:20.000Z   \n",
       "2022-03-24 18:09:06.000  2022-03-24T18:09:06.000Z   \n",
       "2022-03-24 17:56:19.357  2022-03-24T17:56:21.654Z   \n",
       "\n",
       "                                                                      text  \\\n",
       "2022-03-24 18:27:20.000  BRIEF-London Stock Exchange Secondary ABO Book...   \n",
       "2022-03-24 18:09:06.000  BRIEF-London Stock Exchange Secondary ABO Book...   \n",
       "2022-03-24 17:56:19.357  BLOCKTRADE:  LONDON STOCK EXCHANGE SECONDARY A...   \n",
       "\n",
       "                                                              storyId  \\\n",
       "2022-03-24 18:27:20.000  urn:newsml:reuters.com:20220324:nFWN2VR122:1   \n",
       "2022-03-24 18:09:06.000  urn:newsml:reuters.com:20220324:nFWN2VR17K:1   \n",
       "2022-03-24 17:56:19.357  urn:newsml:reuters.com:20220324:nFWN2VR17K:2   \n",
       "\n",
       "                        sourceCode  \n",
       "2022-03-24 18:27:20.000    NS:RTRS  \n",
       "2022-03-24 18:09:06.000    NS:RTRS  \n",
       "2022-03-24 17:56:19.357    NS:RTRS  "
      ]
     },
     "execution_count": 61,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "newsResponse = rd.content.news.headlines.Definition(\n",
    "    query=\"LSEG\",\n",
    "    date_from=\"20.03.2022\",\n",
    "    date_to=\"25.03.2022\",\n",
    "    count=3\n",
    ").get_data()  # Something simmilar can be made with EDAPI with, for e.g.`ek.get_news_headlines(query = 'AAPL.O', count=10)`.\n",
    "newsResponse.data.df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a566f313-ee8f-4df4-bcc7-0e5292f06e03",
   "metadata": {},
   "source": [
    "### Historical News\n",
    "\n",
    "Thankfully, the `ek` library News API is much more powerful and simple to use. Again, most of it is better shown and explained on [GitHub](https://github.com/Refinitiv-API-Samples/Example.DataLibrary.Python/tree/main/Examples), but the below is a great starting point of how to collect News data (that is 15 months old or older):"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "id": "552c343a-901a-4830-8505-5d0f318aed03",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'urn:newsml:reuters.com:20220324:nFWN2VR122:1'"
      ]
     },
     "execution_count": 62,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "story_id = newsResponse.data.df.iat[0,2]\n",
    "story_id"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "id": "eb5ccc33-ed8b-464c-99f3-ab7532764efe",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div class=\"storyContent\" lang=\"en\"><style type=\"text/css\">.storyContent * {border-color:inherit !important;outline-color:inherit !important;}</style><p class=\"tr-story-p1\"><span class=\"tr-dateline\">March 24 (Reuters)</span><span class=\"tr-dl-sep\"> - </span>London Stock Exchange Secondary ABO Bookrunner:</p><ul class=\"bulleted-list arrowlist\"><li><p>BLOCKTRADE: LONDON STOCK EXCHANGE SECONDARY ABO TOTAL OFFERING SIZE: C. 5.8 MM SHARES / C. GBP 453 MM / C. USD 597 MM / C. 1.1% TSO - BOOKRUNNER</p></li><li><p>LONDON STOCK EXCHANGE GROUP SECONDARY ABO LAUNCH: SELLING SHAREHOLDERS INCLUDE BCP YORK AND CERTAIN OTHER CO-INVESTORS - BOOKRUNNER</p></li></ul><p>Further company coverage: <a href=\"reuters://REALTIME/verb=Headlines/ric=LSEG.L\" data-type=\"newsExpression\" data-expression=\"LSEG.L\" translate=\"no\" dir=\"ltr\">LSEG.L</a></p><p><br/></p><p class=\"tr-contactinfo\">(( <a href=\"mailto:Reuters.Briefs@thomsonreuters.com\" data-type=\"email\" translate=\"no\">Reuters.Briefs@thomsonreuters.com</a> ;))</p><p class=\"line-break\"><br/></p><p class=\"tr-copyright\">(c) Copyright Thomson Reuters 2022. Click For Restrictions - https://agency.reuters.com/en/copyright.html</p></div>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 63,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from IPython.display import HTML\n",
    "story = ek.get_news_story(story_id)\n",
    "HTML(story)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "id": "c5d94baa-3d97-4782-96b5-88778f05d30b",
   "metadata": {},
   "outputs": [],
   "source": [
    "rd.close_session()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f7ddd83c-61b8-4a7c-b1ca-8213bd82b751",
   "metadata": {},
   "source": [
    "## Conclusion\n",
    "\n",
    "In conclusion, we can see that the [Office COM API](https://developers.refinitiv.com/en/api-catalog/eikon/com-apis-for-use-in-microsoft-office) had many great uses, but limitations too. This was without mentioning its reliability on [DLL](https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/dynamic-link-library)s that can be heavy to run on a personal machine. But the Refinitiv Python Libraries ([RD](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python), [RDP](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-platform-apis) and [EDAPI](https://developers.refinitiv.com/en/api-catalog/eikon/eikon-data-api)) can not only replicate these COM functionalities but enhance them in many instances, the simplest example being the Historical News functionality shown above.\n",
    "\n",
    "Several COM API functionalities relying on a technology called Adfin was not replicated in Python in this article, but we will investigate them in another article - so stay tuned!"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9bc90236-5e00-42dc-9357-1c20124287b2",
   "metadata": {},
   "source": [
    "# Index"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b3414fee-5faf-4c16-b59b-c95553b06985",
   "metadata": {},
   "source": [
    "## COM Prerequisits\n",
    "\n",
    "\n",
    "1. Open a new single sheet Excel workbook.\n",
    "\n",
    "    Save As with an appropriate name (e.g. AdxRtSourceList.xls or AdxRtSourceList.xlsm in Office 2007 or higher).\n",
    "    \n",
    "2. Go to the VBE (Visual Basic Editor), ensure the Project Explorer is visible and select the project for the workbook.\n",
    "\n",
    "    \\<ALT\\>\\<F11\\> or Tools, Macro, Visual Basic Editor in Excel 2003 or  Developer, Visual Basic in Excel 2007 and above, View, Project Explorer If the Developer header is not visible in Excel 2007 and above, go to the Excel Office Button, select Excel Options (lower right), Popular, and check the 'Show Developer tab in the Ribbon' box.\n",
    "    \n",
    "3. In the VBE, click on File, Import File and import PLVbaApis.bas.\n",
    "    \n",
    "    The .bas location is C:\\Program Files (x86)\\Thomson Reuters\\Eikon\\Z\\Bin (Z may be X or Y, depending on the last Eikon update). The .bas is loaded as a new VB project module, PLVbaApis.\n",
    "    \n",
    "4. In the PLVbaAPis module, comment out the sections which aren't required.\n",
    "    \n",
    "    E.G.: when dealing with AdxRtSourceList, part of the real time library AdfinXRtLib, the AdfinX Real Time section can remain uncommented.\n",
    "\n",
    "5. In the VBE, go Tools, References and ensure that AdfinX Real Time Library is checked.\n",
    "    \n",
    "    If it is not in the list the library is called rtx.dll and its location for Eikon 4 is \">C:\\Program Files (x86)\\Thomson Reuters\\Eikon\\Z\\Bin (Z may be X or Y, depending on the last Eikon update)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "029c9a53-5b2b-4e06-9b25-b05fd1a0645f",
   "metadata": {},
   "source": [
    "## Refinitiv Data Library\n",
    "\n",
    "The [RD Python library](https://developers.refinitiv.com/en/api-catalog/refinitiv-data-platform/refinitiv-data-library-for-python) works in layers:\n",
    "\n",
    "<img src=\"imgs/RDLibraryAndLayers.PNG\">\n",
    "\n",
    "The RD Python library is actually a wrapper that allows both (i) access to data in the Refinitiv Data Platform (RDP) and (ii) functions applied to that data (e.g.: `rd.content.fundamental_and_reference`). These functions are applied at different layers of the data as it is sent to you; these stages range from 'Session Layer' to 'Access Layer'.\n",
    "\n",
    "### Fundamental and Reference with `rd.content.fundamental_and_reference.Definition`\n",
    "You could get [Fundamental and Reference](https://github.com/Refinitiv-API-Samples/Example.DataLibrary.Python/blob/main/Examples/2-Content/2.09-FundamentalAndReference/EX-2.09.01-FundamentalAndReference.ipynb) data, found in Office with the COM's RData Function, with  with `ek.get_data` and `rd.get_history`, but you could also use the built in `content.fundamental_and_reference.Definition` function:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1c67abd1-0197-4e54-a28b-5c127f40efb4",
   "metadata": {},
   "outputs": [
    {
     "ename": "ValueError",
     "evalue": "Session is not opened. Can't send any request",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mValueError\u001b[0m                                Traceback (most recent call last)",
      "Input \u001b[1;32mIn [65]\u001b[0m, in \u001b[0;36m<cell line: 1>\u001b[1;34m()\u001b[0m\n\u001b[1;32m----> 1\u001b[0m df4 \u001b[38;5;241m=\u001b[39m \u001b[43mrd\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mcontent\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mfundamental_and_reference\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mDefinition\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m      2\u001b[0m \u001b[43m    \u001b[49m\u001b[43muniverse\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mGB047986974=\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mBARC.L\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTRI.N\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m      3\u001b[0m \u001b[43m    \u001b[49m\u001b[43mfields\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.IR.RatingSourceDescription\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.IR.RatingSourceType\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.GR.Rating\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[0;32m      4\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCEconomicSector\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCEconSectorCode\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCBusinessSector\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[0;32m      5\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCBusinessSectorCode\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCIndustryGroup\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCIndustryGroupCode\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[0;32m      6\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCIndustry\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[38;5;124;43mTR.TRBCIndustryCode\u001b[39;49m\u001b[38;5;124;43m'\u001b[39;49m\u001b[43m]\u001b[49m\n\u001b[0;32m      7\u001b[0m \u001b[43m)\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_data\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[38;5;241m.\u001b[39mdata\u001b[38;5;241m.\u001b[39mdf\n\u001b[0;32m      9\u001b[0m df4\n",
      "File \u001b[1;32mc:\\users\\u6082174.ten\\appdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\refinitiv\\data\\content\\fundamental_and_reference\\_definition.py:244\u001b[0m, in \u001b[0;36mDefinition.get_data\u001b[1;34m(self, session, on_response, **kwargs)\u001b[0m\n\u001b[0;32m    242\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_content_type \u001b[38;5;241m==\u001b[39m ContentType\u001b[38;5;241m.\u001b[39mDATA_GRID_UDF:\n\u001b[0;32m    243\u001b[0m     on_response_filter \u001b[38;5;241m=\u001b[39m on_response \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mmake_on_response(on_response)\n\u001b[1;32m--> 244\u001b[0m     response \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43msuper\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_data\u001b[49m\u001b[43m(\u001b[49m\u001b[43msession\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mon_response_filter\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    246\u001b[0m     \u001b[38;5;28;01mwhile\u001b[39;00m response\u001b[38;5;241m.\u001b[39mdata:\n\u001b[0;32m    247\u001b[0m         ticket \u001b[38;5;241m=\u001b[39m response\u001b[38;5;241m.\u001b[39mdata\u001b[38;5;241m.\u001b[39mraw\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mticket\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[1;32mc:\\users\\u6082174.ten\\appdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\refinitiv\\data\\content\\_content_provider.py:182\u001b[0m, in \u001b[0;36mContentUsageLoggerMixin.get_data\u001b[1;34m(self, session, on_response, **kwargs)\u001b[0m\n\u001b[0;32m    173\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mget_data\u001b[39m(\u001b[38;5;28mself\u001b[39m, session\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m, on_response\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs) \u001b[38;5;241m-\u001b[39m\u001b[38;5;241m>\u001b[39m T:\n\u001b[0;32m    174\u001b[0m     \u001b[38;5;66;03m# Library usage logging\u001b[39;00m\n\u001b[0;32m    175\u001b[0m     get_usage_logger()\u001b[38;5;241m.\u001b[39mlog_func(\n\u001b[0;32m    176\u001b[0m         name\u001b[38;5;241m=\u001b[39m\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__class__\u001b[39m\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__module__\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m.\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    177\u001b[0m         \u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__class__\u001b[39m\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__qualname__\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m.\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    180\u001b[0m         desc\u001b[38;5;241m=\u001b[39m{FilterType\u001b[38;5;241m.\u001b[39mSYNC, FilterType\u001b[38;5;241m.\u001b[39mLAYER_CONTENT},\n\u001b[0;32m    181\u001b[0m     )\n\u001b[1;32m--> 182\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43msuper\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_data\u001b[49m\u001b[43m(\u001b[49m\u001b[43msession\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mon_response\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[1;32mc:\\users\\u6082174.ten\\appdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\refinitiv\\data\\delivery\\_data\\_data_provider.py:765\u001b[0m, in \u001b[0;36mDataProviderLayer.get_data\u001b[1;34m(self, session, on_response, **kwargs)\u001b[0m\n\u001b[0;32m    759\u001b[0m \u001b[38;5;66;03m# Library usage logging\u001b[39;00m\n\u001b[0;32m    760\u001b[0m get_usage_logger()\u001b[38;5;241m.\u001b[39mlog_func(\n\u001b[0;32m    761\u001b[0m     name\u001b[38;5;241m=\u001b[39m\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mDataProviderLayer\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__module__\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m.\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mDataProviderLayer\u001b[38;5;241m.\u001b[39m\u001b[38;5;18m__qualname__\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m.get_data\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[0;32m    762\u001b[0m     kwargs\u001b[38;5;241m=\u001b[39m{\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124murl\u001b[39m\u001b[38;5;124m\"\u001b[39m: url, \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mauto_retry\u001b[39m\u001b[38;5;124m\"\u001b[39m: auto_retry, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_kwargs},\n\u001b[0;32m    763\u001b[0m     desc\u001b[38;5;241m=\u001b[39m{FilterType\u001b[38;5;241m.\u001b[39mSYNC, FilterType\u001b[38;5;241m.\u001b[39mLAYER_DELIVERY},\n\u001b[0;32m    764\u001b[0m )\n\u001b[1;32m--> 765\u001b[0m response \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_provider\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_data\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    766\u001b[0m \u001b[43m    \u001b[49m\u001b[43msession\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mauto_retry\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mauto_retry\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_kwargs\u001b[49m\n\u001b[0;32m    767\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    768\u001b[0m on_response \u001b[38;5;129;01mand\u001b[39;00m emit_event(on_response, response, \u001b[38;5;28mself\u001b[39m, session)\n\u001b[0;32m    769\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_check_response(response, config)\n",
      "File \u001b[1;32mc:\\users\\u6082174.ten\\appdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\refinitiv\\data\\delivery\\_data\\_data_provider.py:689\u001b[0m, in \u001b[0;36mDataProvider.get_data\u001b[1;34m(self, *args, **kwargs)\u001b[0m\n\u001b[0;32m    687\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21mget_data\u001b[39m(\u001b[38;5;28mself\u001b[39m, \u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs) \u001b[38;5;241m-\u001b[39m\u001b[38;5;241m>\u001b[39m BaseResponse:\n\u001b[0;32m    688\u001b[0m     request \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrequest\u001b[38;5;241m.\u001b[39mcreate(\u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\n\u001b[1;32m--> 689\u001b[0m     raw_response \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mconnection\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msend\u001b[49m\u001b[43m(\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    690\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_process_response(raw_response, \u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\n",
      "File \u001b[1;32mc:\\users\\u6082174.ten\\appdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\refinitiv\\data\\delivery\\_data\\_data_provider.py:401\u001b[0m, in \u001b[0;36mHttpSessionConnection.send\u001b[1;34m(self, request, session, *args, **kwargs)\u001b[0m\n\u001b[0;32m    399\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m \u001b[38;5;21msend\u001b[39m(\u001b[38;5;28mself\u001b[39m, request, session, \u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs):\n\u001b[0;32m    400\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m is_open(session):\n\u001b[1;32m--> 401\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mSession is not opened. Can\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mt send any request\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m    403\u001b[0m     method \u001b[38;5;241m=\u001b[39m request\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mmethod\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m    404\u001b[0m     url \u001b[38;5;241m=\u001b[39m request\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124murl\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "\u001b[1;31mValueError\u001b[0m: Session is not opened. Can't send any request"
     ]
    }
   ],
   "source": [
    "df4 = rd.content.fundamental_and_reference.Definition(\n",
    "    universe=['GB047986974=', 'BARC.L', 'TRI.N'],\n",
    "    fields=['TR.IR.RatingSourceDescription', 'TR.IR.RatingSourceType', 'TR.GR.Rating',\n",
    "        'TR.TRBCEconomicSector', 'TR.TRBCEconSectorCode', 'TR.TRBCBusinessSector',\n",
    "        'TR.TRBCBusinessSectorCode', 'TR.TRBCIndustryGroup', 'TR.TRBCIndustryGroupCode',\n",
    "        'TR.TRBCIndustry', 'TR.TRBCIndustryCode']\n",
    ").get_data().data.df\n",
    "\n",
    "df4"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "af0f35f8-1d58-4fb3-ba2b-50c88ecdda84",
   "metadata": {},
   "outputs": [],
   "source": [
    "FTSEFunAndRef = rd.content.fundamental_and_reference.Definition(\n",
    "    [\"0#.FTSE\"],\n",
    "    [\"TR.TURNOVER.date\", \"TR.TURNOVER\", \"TR.NetIncome.date\", \"TR.NetIncome\",\n",
    "     \"TR.F.ReturnAvgTotAssetsPctTTM(Period=FI0)\", \"TR.F.NetIncAfterTax(Period=FY0)\"]\n",
    ").get_data()\n",
    "\n",
    "FTSEFunAndRef.data.df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6342d85b-8072-431a-ac6d-d730cf318a84",
   "metadata": {
    "jupyter": {
     "outputs_hidden": true
    },
    "tags": []
   },
   "source": [
    "Note how the fields that are inappropriate for the instrument asked (e.g.: `TRBC Economic Sector Code` for `BARC.L`) show up as `<NA>`, allowing you to mix and match fields and instruments even if they are not all complementary to each other, and collect all the information you are after, for all instruments you may me interested in, in one call."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "792e3ff1-695f-4e91-ad6a-e133d281b969",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
